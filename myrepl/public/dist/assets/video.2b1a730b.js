import{ce as Ie,b as Me,W as De,Q as fe,au as Pe,cc as xe,cT as Le,aw as Fe,bO as ke,bP as Be,ay as Ue,o as je,d as Ne,h as Se,Y as We,a6 as Ge}from"./index.a6b3a216.js";import{O as Ke,A as Ve}from"./icon.db9cef19.js";import{A as ze,V as He}from"./video_box.a3f962bc.js";import{H as Ye,a as Xe}from"./hls.15d82762.js";import"./index.e7b386d3.js";import"./index.e391513c.js";import"./Layout.3a51487c.js";import"./index.777bd141.js";import"./FolderTree.c9974b3e.js";var Ae={exports:{}};(function(re,ne){var X=function(N){var K=!1;try{if(typeof WebAssembly=="object"&&typeof WebAssembly.instantiate=="function"){const t=new WebAssembly.Module(Uint8Array.of(0,97,115,109,1,0,0,0));t instanceof WebAssembly.Module&&(K=new WebAssembly.Instance(t)instanceof WebAssembly.Instance)}}catch{}console.log("WebAssembly support detected: "+(K?"yes":"no"));var h=this;h.canvas=N.canvas,h.renderMode=N.renderMode||(N.lossyRender?"lossy":"wasm-blend"),h.libassMemoryLimit=N.libassMemoryLimit||0,h.libassGlyphLimit=N.libassGlyphLimit||0,h.targetFps=N.targetFps||24,h.prescaleFactor=N.prescaleFactor||1,h.prescaleHeightLimit=N.prescaleHeightLimit||1080,h.maxRenderHeight=N.maxRenderHeight||0,h.dropAllAnimations=N.dropAllAnimations||!1,h.isOurCanvas=!1,h.video=N.video,h.canvasParent=null,h.fonts=N.fonts||[],h.availableFonts=N.availableFonts||[],h.fallbackFont=N.fallbackFont||"default.woff2",h.lazyFileLoading=N.lazyFileLoading||!1,h.onReadyEvent=N.onReady,K?h.workerUrl=N.workerUrl||"subtitles-octopus-worker.js":h.workerUrl=N.legacyWorkerUrl||"subtitles-octopus-worker-legacy.js",h.subUrl=N.subUrl,h.subContent=N.subContent||null,h.onErrorEvent=N.onError,h.debug=N.debug||!1,h.lastRenderTime=0,h.pixelRatio=window.devicePixelRatio||1,h.timeOffset=N.timeOffset||0,h.hasAlphaBug=!1,function(){if(typeof ImageData.prototype.constructor=="function")try{new window.ImageData(new Uint8ClampedArray([0,0,0,0]),1,1);return}catch{console.log("detected that ImageData is not constructable despite browser saying so")}var t=document.createElement("canvas"),e=t.getContext("2d");window.ImageData=function(){var n=0;if(arguments[0]instanceof Uint8ClampedArray)var i=arguments[n++];var r=arguments[n++],u=arguments[n],_=e.createImageData(r,u);return i&&_.data.set(i),_}}(),h.workerError=function(t){if(console.error("Worker error: ",t),h.onErrorEvent&&h.onErrorEvent(t),!h.debug)throw h.dispose(),new Error("Worker error: "+t)},h.init=function(){if(!window.Worker){h.workerError("worker not supported");return}h.worker||(h.worker=new Worker(h.workerUrl),h.worker.addEventListener("message",h.onWorkerMessage),h.worker.addEventListener("error",h.workerError)),h.workerActive=!1,h.createCanvas(),h.setVideo(N.video),h.setSubUrl(N.subUrl),h.worker.postMessage({target:"worker-init",width:h.canvas.width,height:h.canvas.height,URL:document.URL,currentScript:h.workerUrl,preMain:!0,renderMode:h.renderMode,subUrl:h.subUrl,subContent:h.subContent,fonts:h.fonts,availableFonts:h.availableFonts,fallbackFont:h.fallbackFont,lazyFileLoading:h.lazyFileLoading,debug:h.debug,targetFps:h.targetFps,libassMemoryLimit:h.libassMemoryLimit,libassGlyphLimit:h.libassGlyphLimit,dropAllAnimations:h.dropAllAnimations})},h.createCanvas=function(){h.canvas||(h.video?(h.isOurCanvas=!0,h.canvas=document.createElement("canvas"),h.canvas.className="libassjs-canvas",h.canvas.style.display="none",h.canvasParent=document.createElement("div"),h.canvasParent.className="libassjs-canvas-parent",h.canvasParent.appendChild(h.canvas),h.video.nextSibling?h.video.parentNode.insertBefore(h.canvasParent,h.video.nextSibling):h.video.parentNode.appendChild(h.canvasParent)):h.canvas||h.workerError("Don't know where to render: you should give video or canvas in options.")),h.ctx=h.canvas.getContext("2d"),h.bufferCanvas=document.createElement("canvas"),h.bufferCanvasCtx=h.bufferCanvas.getContext("2d"),h.bufferCanvas.width=1,h.bufferCanvas.height=1;var t=new Uint8ClampedArray([0,255,0,0]),e=new ImageData(t,1,1);h.bufferCanvasCtx.clearRect(0,0,1,1),h.ctx.clearRect(0,0,1,1);var n=h.ctx.getImageData(0,0,1,1).data;h.bufferCanvasCtx.putImageData(e,0,0),h.ctx.drawImage(h.bufferCanvas,0,0);var i=h.ctx.getImageData(0,0,1,1).data;h.hasAlphaBug=n[1]!=i[1],h.hasAlphaBug&&console.log("Detected a browser having issue with transparent pixels, applying workaround")};function T(){h.setCurrentTime(h.video.currentTime+h.timeOffset)}function S(){h.setIsPaused(!1,h.video.currentTime+h.timeOffset)}function m(){h.setIsPaused(!0,h.video.currentTime+h.timeOffset)}function y(){h.video.removeEventListener("timeupdate",T,!1)}function c(){h.video.addEventListener("timeupdate",T,!1);var t=h.video.currentTime+h.timeOffset;h.setCurrentTime(t)}function l(){h.setRate(h.video.playbackRate)}function a(){h.setIsPaused(!0,h.video.currentTime+h.timeOffset)}function f(t){t.target.removeEventListener(t.type,f,!1),h.resize()}h.setVideo=function(t){h.video=t,h.video&&(h.video.addEventListener("timeupdate",T,!1),h.video.addEventListener("playing",S,!1),h.video.addEventListener("pause",m,!1),h.video.addEventListener("seeking",y,!1),h.video.addEventListener("seeked",c,!1),h.video.addEventListener("ratechange",l,!1),h.video.addEventListener("waiting",a,!1),document.addEventListener("fullscreenchange",h.resizeWithTimeout,!1),document.addEventListener("mozfullscreenchange",h.resizeWithTimeout,!1),document.addEventListener("webkitfullscreenchange",h.resizeWithTimeout,!1),document.addEventListener("msfullscreenchange",h.resizeWithTimeout,!1),window.addEventListener("resize",h.resizeWithTimeout,!1),typeof ResizeObserver<"u"&&(h.ro=new ResizeObserver(h.resizeWithTimeout),h.ro.observe(h.video)),h.video.videoWidth>0?h.resize():h.video.addEventListener("loadedmetadata",f,!1))},h.getVideoPosition=function(){var t=h.video.videoWidth/h.video.videoHeight,e=h.video.offsetWidth,n=h.video.offsetHeight,i=e/n,r=e,u=n;i>t?r=Math.floor(n*t):u=Math.floor(e/t);var _=(e-r)/2,p=(n-u)/2;return{width:r,height:u,x:_,y:p}},h.setSubUrl=function(t){h.subUrl=t},h.renderFrameData=null;function s(){var t=h.renderFramesData,e=performance.now();h.ctx.clearRect(0,0,h.canvas.width,h.canvas.height);for(var n=0;n<t.canvases.length;n++){var i=t.canvases[n];h.bufferCanvas.width=i.w,h.bufferCanvas.height=i.h;var r=new Uint8ClampedArray(i.buffer);if(h.hasAlphaBug)for(var u=3;u<r.length;u=u+4)r[u]=r[u]>=1?r[u]:1;var _=new ImageData(r,i.w,i.h);h.bufferCanvasCtx.putImageData(_,0,0),h.ctx.drawImage(h.bufferCanvas,i.x,i.y)}if(h.debug){var p=Math.round(performance.now()-e),g=t.blendTime;console.log(typeof g<"u"?"render: "+Math.round(t.spentTime-g)+" ms, blend: "+Math.round(g)+" ms, draw: "+p+" ms; TOTAL="+Math.round(t.spentTime+p)+" ms":Math.round(t.spentTime)+" ms (+ "+p+" ms draw)"),h.renderStart=performance.now()}}function o(){var t=h.renderFramesData,e=performance.now();h.ctx.clearRect(0,0,h.canvas.width,h.canvas.height);for(var n=0;n<t.bitmaps.length;n++){var i=t.bitmaps[n];h.ctx.drawImage(i.bitmap,i.x,i.y)}if(h.debug){var r=Math.round(performance.now()-e);console.log(t.bitmaps.length+" bitmaps, libass: "+Math.round(t.libassTime)+"ms, decode: "+Math.round(t.decodeTime)+"ms, draw: "+r+"ms"),h.renderStart=performance.now()}}h.workerActive=!1,h.frameId=0,h.onWorkerMessage=function(t){h.workerActive||(h.workerActive=!0,h.onReadyEvent&&h.onReadyEvent());var e=t.data;switch(e.target){case"stdout":{console.log(e.content);break}case"console-log":{console.log.apply(console,JSON.parse(e.content));break}case"console-debug":{console.debug.apply(console,JSON.parse(e.content));break}case"console-info":{console.info.apply(console,JSON.parse(e.content));break}case"console-warn":{console.warn.apply(console,JSON.parse(e.content));break}case"console-error":{console.error.apply(console,JSON.parse(e.content));break}case"stderr":{console.error(e.content);break}case"window":{window[e.method]();break}case"canvas":{switch(e.op){case"getContext":{h.ctx=h.canvas.getContext(e.type,e.attributes);break}case"resize":{h.resize(e.width,e.height);break}case"renderCanvas":{h.lastRenderTime<e.time&&(h.lastRenderTime=e.time,h.renderFramesData=e,window.requestAnimationFrame(s));break}case"renderFastCanvas":{h.lastRenderTime<e.time&&(h.lastRenderTime=e.time,h.renderFramesData=e,window.requestAnimationFrame(o));break}case"setObjectProperty":{h.canvas[e.object][e.property]=e.value;break}default:throw"eh?"}break}case"tick":{h.frameId=e.id,h.worker.postMessage({target:"tock",id:h.frameId});break}case"custom":{if(h.onCustomMessage)h.onCustomMessage(t);else throw"Custom message received but client onCustomMessage not implemented.";break}case"setimmediate":{h.worker.postMessage({target:"setimmediate"});break}case"get-events":break;case"get-styles":break;case"ready":break;default:throw"what? "+e.target}};function d(t,e){var n=h.prescaleFactor<=0?1:h.prescaleFactor;if(e<=0||t<=0)t=0,e=0;else{var i=n<1?-1:1,r=e;i*r*n<=i*h.prescaleHeightLimit?r*=n:i*r<i*h.prescaleHeightLimit&&(r=h.prescaleHeightLimit),h.maxRenderHeight>0&&r>h.maxRenderHeight&&(r=h.maxRenderHeight),t*=r/e,e=r}return{width:t,height:e}}h.resize=function(t,e,n,i){var r=null;if(n=n||0,i=i||0,(!t||!e)&&h.video){r=h.getVideoPosition();var u=d(r.width*h.pixelRatio,r.height*h.pixelRatio);t=u.width,e=u.height;var _=h.canvasParent.getBoundingClientRect().top-h.video.getBoundingClientRect().top;n=r.y-_,i=r.x}if(!t||!e){h.video||console.error("width or height is 0. You should specify width & height for resize.");return}(h.canvas.width!=t||h.canvas.height!=e||h.canvas.style.top!=n||h.canvas.style.left!=i)&&(h.canvas.width=t,h.canvas.height=e,r!=null&&(h.canvasParent.style.position="relative",h.canvas.style.display="block",h.canvas.style.position="absolute",h.canvas.style.width=r.width+"px",h.canvas.style.height=r.height+"px",h.canvas.style.top=n+"px",h.canvas.style.left=i+"px",h.canvas.style.pointerEvents="none"),h.worker.postMessage({target:"canvas",width:h.canvas.width,height:h.canvas.height}))},h.resizeWithTimeout=function(){h.resize(),setTimeout(h.resize,100)},h.runBenchmark=function(){h.worker.postMessage({target:"runBenchmark"})},h.customMessage=function(t,e){e=e||{},h.worker.postMessage({target:"custom",userData:t,preMain:e.preMain})},h.setCurrentTime=function(t){h.worker.postMessage({target:"video",currentTime:t})},h.setTrackByUrl=function(t){h.worker.postMessage({target:"set-track-by-url",url:t})},h.setTrack=function(t){h.worker.postMessage({target:"set-track",content:t})},h.freeTrack=function(t){h.worker.postMessage({target:"free-track"})},h.render=h.setCurrentTime,h.setIsPaused=function(t,e){h.worker.postMessage({target:"video",isPaused:t,currentTime:e})},h.setRate=function(t){h.worker.postMessage({target:"video",rate:t})},h.dispose=function(){h.worker.postMessage({target:"destroy"}),h.worker.terminate(),h.worker.removeEventListener("message",h.onWorkerMessage),h.worker.removeEventListener("error",h.workerError),h.workerActive=!1,h.worker=null,h.video&&(h.video.removeEventListener("timeupdate",T,!1),h.video.removeEventListener("playing",S,!1),h.video.removeEventListener("pause",m,!1),h.video.removeEventListener("seeking",y,!1),h.video.removeEventListener("seeked",c,!1),h.video.removeEventListener("ratechange",l,!1),h.video.removeEventListener("waiting",a,!1),h.video.removeEventListener("loadedmetadata",f,!1),document.removeEventListener("fullscreenchange",h.resizeWithTimeout,!1),document.removeEventListener("mozfullscreenchange",h.resizeWithTimeout,!1),document.removeEventListener("webkitfullscreenchange",h.resizeWithTimeout,!1),document.removeEventListener("msfullscreenchange",h.resizeWithTimeout,!1),window.removeEventListener("resize",h.resizeWithTimeout,!1),h.video.parentNode.removeChild(h.canvasParent),h.video=null),h.ro&&(h.ro.disconnect(),h.ro=null),h.onCustomMessage=null,h.onErrorEvent=null,h.onReadyEvent=null},h.fetchFromWorker=function(t,e,n){try{var i=t.target,r=setTimeout(function(){_(Error("Error: Timeout while try to fetch "+i))},5e3),u=function(p){p.data.target==i&&(e(p.data),h.worker.removeEventListener("message",u),h.worker.removeEventListener("error",_),clearTimeout(r))},_=function(p){n(p),h.worker.removeEventListener("message",u),h.worker.removeEventListener("error",_),clearTimeout(r)};h.worker.addEventListener("message",u),h.worker.addEventListener("error",_),h.worker.postMessage(t)}catch(p){n(p)}},h.createEvent=function(t){h.worker.postMessage({target:"create-event",event:t})},h.getEvents=function(t,e){h.fetchFromWorker({target:"get-events"},function(n){t(n.events)},e)},h.setEvent=function(t,e){h.worker.postMessage({target:"set-event",event:t,index:e})},h.removeEvent=function(t){h.worker.postMessage({target:"remove-event",index:t})},h.createStyle=function(t){h.worker.postMessage({target:"create-style",style:t})},h.getStyles=function(t,e){h.fetchFromWorker({target:"get-styles"},function(n){t(n.styles)},e)},h.setStyle=function(t,e){h.worker.postMessage({target:"set-style",style:t,index:e})},h.removeStyle=function(t){h.worker.postMessage({target:"remove-style",index:t})},h.init()};typeof SubtitlesOctopusOnLoad=="function"&&SubtitlesOctopusOnLoad(),re.exports&&(re.exports=X)})(Ae);const Je=Ae.exports,Qe= window.__dynamic_base__+"/assets/subtitles-octopus-worker-legacy.b6ac3ec1.js",Ze= window.__dynamic_base__+"/assets/subtitles-octopus-worker.f95f2186.js",$e= window.__dynamic_base__+"/assets/TimesNewRoman.d9fb32eb.ttf",qe= window.__dynamic_base__+"/assets/SourceHanSansCN-Bold.b5627435.woff2";let oe=null;function be(re){oe.canvasParent&&(oe.canvasParent.style.display=re?"block":"none")}function et(re){return ne=>(oe=new Je({availableFonts:{"times new roman":$e},fallbackFont:qe,legacyWorkerUrl:Qe,workerUrl:Ze,video:ne.template.$video,...re}),oe.canvasParent.className="artplayer-plugin-ass",oe.canvasParent.style.cssText=`
      position: absolute;
      width: 100%;
      height: 100%;
      user-select: none;
      pointer-events: none;
      z-index: 20;
    `,ne.on("artplayer-plugin-ass:switch",X=>{oe.freeTrack(),oe.setTrackByUrl(X),be(!0)}),ne.on("subtitle",X=>be(X)),ne.on("artplayer-plugin-ass:visible",X=>be(X)),ne.on("subtitleOffset",X=>oe.timeOffset=X),ne.on("destroy",()=>oe.dispose()),{name:"artplayerPluginAss",instance:oe})}var Re={exports:{}};(function(re,ne){(function(N,K){re.exports=K()})(self,function(){return function(){var X={"./node_modules/es6-promise/dist/es6-promise.js":function(T,S,m){/*!
 * @overview es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
 * @version   v4.2.8+1e68dce6
 */(function(y,c){T.exports=c()})(this,function(){function y(A){var w=typeof A;return A!==null&&(w==="object"||w==="function")}function c(A){return typeof A=="function"}var l=void 0;Array.isArray?l=Array.isArray:l=function(A){return Object.prototype.toString.call(A)==="[object Array]"};var a=l,f=0,s=void 0,o=void 0,d=function(w,C){x[f]=w,x[f+1]=C,f+=2,f===2&&(o?o(L):R())};function t(A){o=A}function e(A){d=A}var n=typeof window<"u"?window:void 0,i=n||{},r=i.MutationObserver||i.WebKitMutationObserver,u=typeof self>"u"&&typeof process<"u"&&{}.toString.call(process)==="[object process]",_=typeof Uint8ClampedArray<"u"&&typeof importScripts<"u"&&typeof MessageChannel<"u";function p(){return function(){return process.nextTick(L)}}function g(){return typeof s<"u"?function(){s(L)}:v()}function b(){var A=0,w=new r(L),C=document.createTextNode("");return w.observe(C,{characterData:!0}),function(){C.data=A=++A%2}}function E(){var A=new MessageChannel;return A.port1.onmessage=L,function(){return A.port2.postMessage(0)}}function v(){var A=setTimeout;return function(){return A(L,1)}}var x=new Array(1e3);function L(){for(var A=0;A<f;A+=2){var w=x[A],C=x[A+1];w(C),x[A]=void 0,x[A+1]=void 0}f=0}function O(){try{var A=Function("return this")().require("vertx");return s=A.runOnLoop||A.runOnContext,g()}catch{return v()}}var R=void 0;u?R=p():r?R=b():_?R=E():n===void 0?R=O():R=v();function I(A,w){var C=this,M=new this.constructor(F);M[U]===void 0&&_e(M);var k=C._state;if(k){var j=arguments[k-1];d(function(){return he(k,M,j,C._result)})}else q(C,M,A,w);return M}function B(A){var w=this;if(A&&typeof A=="object"&&A.constructor===w)return A;var C=new w(F);return $(C,A),C}var U=Math.random().toString(36).substring(2);function F(){}var W=void 0,z=1,P=2;function G(){return new TypeError("You cannot resolve a promise with itself")}function ie(){return new TypeError("A promises callback cannot return that same promise.")}function V(A,w,C,M){try{A.call(w,C,M)}catch(k){return k}}function H(A,w,C){d(function(M){var k=!1,j=V(C,w,function(J){k||(k=!0,w!==J?$(M,J):Y(M,J))},function(J){k||(k=!0,D(M,J))},"Settle: "+(M._label||" unknown promise"));!k&&j&&(k=!0,D(M,j))},A)}function ee(A,w){w._state===z?Y(A,w._result):w._state===P?D(A,w._result):q(w,void 0,function(C){return $(A,C)},function(C){return D(A,C)})}function Q(A,w,C){w.constructor===A.constructor&&C===I&&w.constructor.resolve===B?ee(A,w):C===void 0?Y(A,w):c(C)?H(A,w,C):Y(A,w)}function $(A,w){if(A===w)D(A,G());else if(y(w)){var C=void 0;try{C=w.then}catch(M){D(A,M);return}Q(A,w,C)}else Y(A,w)}function ue(A){A._onerror&&A._onerror(A._result),se(A)}function Y(A,w){A._state===W&&(A._result=w,A._state=z,A._subscribers.length!==0&&d(se,A))}function D(A,w){A._state===W&&(A._state=P,A._result=w,d(ue,A))}function q(A,w,C,M){var k=A._subscribers,j=k.length;A._onerror=null,k[j]=w,k[j+z]=C,k[j+P]=M,j===0&&A._state&&d(se,A)}function se(A){var w=A._subscribers,C=A._state;if(w.length!==0){for(var M=void 0,k=void 0,j=A._result,J=0;J<w.length;J+=3)M=w[J],k=w[J+C],M?he(C,M,k,j):k(j);A._subscribers.length=0}}function he(A,w,C,M){var k=c(C),j=void 0,J=void 0,pe=!0;if(k){try{j=C(M)}catch(ge){pe=!1,J=ge}if(w===j){D(w,ie());return}}else j=M;w._state!==W||(k&&pe?$(w,j):pe===!1?D(w,J):A===z?Y(w,j):A===P&&D(w,j))}function le(A,w){try{w(function(M){$(A,M)},function(M){D(A,M)})}catch(C){D(A,C)}}var de=0;function ce(){return de++}function _e(A){A[U]=de++,A._state=void 0,A._result=void 0,A._subscribers=[]}function ae(){return new Error("Array Methods must be provided an Array")}var te=function(){function A(w,C){this._instanceConstructor=w,this.promise=new w(F),this.promise[U]||_e(this.promise),a(C)?(this.length=C.length,this._remaining=C.length,this._result=new Array(this.length),this.length===0?Y(this.promise,this._result):(this.length=this.length||0,this._enumerate(C),this._remaining===0&&Y(this.promise,this._result))):D(this.promise,ae())}return A.prototype._enumerate=function(C){for(var M=0;this._state===W&&M<C.length;M++)this._eachEntry(C[M],M)},A.prototype._eachEntry=function(C,M){var k=this._instanceConstructor,j=k.resolve;if(j===B){var J=void 0,pe=void 0,ge=!1;try{J=C.then}catch(ye){ge=!0,pe=ye}if(J===I&&C._state!==W)this._settledAt(C._state,M,C._result);else if(typeof J!="function")this._remaining--,this._result[M]=C;else if(k===Z){var Ee=new k(F);ge?D(Ee,pe):Q(Ee,C,J),this._willSettleAt(Ee,M)}else this._willSettleAt(new k(function(ye){return ye(C)}),M)}else this._willSettleAt(j(C),M)},A.prototype._settledAt=function(C,M,k){var j=this.promise;j._state===W&&(this._remaining--,C===P?D(j,k):this._result[M]=k),this._remaining===0&&Y(j,this._result)},A.prototype._willSettleAt=function(C,M){var k=this;q(C,void 0,function(j){return k._settledAt(z,M,j)},function(j){return k._settledAt(P,M,j)})},A}();function me(A){return new te(this,A).promise}function ve(A){var w=this;return a(A)?new w(function(C,M){for(var k=A.length,j=0;j<k;j++)w.resolve(A[j]).then(C,M)}):new w(function(C,M){return M(new TypeError("You must pass an array to race."))})}function Oe(A){var w=this,C=new w(F);return D(C,A),C}function we(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function Ce(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}var Z=function(){function A(w){this[U]=ce(),this._result=this._state=void 0,this._subscribers=[],F!==w&&(typeof w!="function"&&we(),this instanceof A?le(this,w):Ce())}return A.prototype.catch=function(C){return this.then(null,C)},A.prototype.finally=function(C){var M=this,k=M.constructor;return c(C)?M.then(function(j){return k.resolve(C()).then(function(){return j})},function(j){return k.resolve(C()).then(function(){throw j})}):M.then(C,C)},A}();Z.prototype.then=I,Z.all=me,Z.race=ve,Z.resolve=B,Z.reject=Oe,Z._setScheduler=t,Z._setAsap=e,Z._asap=d;function Te(){var A=void 0;if(typeof m.g<"u")A=m.g;else if(typeof self<"u")A=self;else try{A=Function("return this")()}catch{throw new Error("polyfill failed because global object is unavailable in this environment")}var w=A.Promise;if(w){var C=null;try{C=Object.prototype.toString.call(w.resolve())}catch{}if(C==="[object Promise]"&&!w.cast)return}A.Promise=Z}return Z.polyfill=Te,Z.Promise=Z,Z})},"./node_modules/events/events.js":function(T){var S=typeof Reflect=="object"?Reflect:null,m=S&&typeof S.apply=="function"?S.apply:function(v,x,L){return Function.prototype.apply.call(v,x,L)},y;S&&typeof S.ownKeys=="function"?y=S.ownKeys:Object.getOwnPropertySymbols?y=function(v){return Object.getOwnPropertyNames(v).concat(Object.getOwnPropertySymbols(v))}:y=function(v){return Object.getOwnPropertyNames(v)};function c(E){console&&console.warn&&console.warn(E)}var l=Number.isNaN||function(v){return v!==v};function a(){a.init.call(this)}T.exports=a,T.exports.once=p,a.EventEmitter=a,a.prototype._events=void 0,a.prototype._eventsCount=0,a.prototype._maxListeners=void 0;var f=10;function s(E){if(typeof E!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof E)}Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return f},set:function(E){if(typeof E!="number"||E<0||l(E))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+E+".");f=E}}),a.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},a.prototype.setMaxListeners=function(v){if(typeof v!="number"||v<0||l(v))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+v+".");return this._maxListeners=v,this};function o(E){return E._maxListeners===void 0?a.defaultMaxListeners:E._maxListeners}a.prototype.getMaxListeners=function(){return o(this)},a.prototype.emit=function(v){for(var x=[],L=1;L<arguments.length;L++)x.push(arguments[L]);var O=v==="error",R=this._events;if(R!==void 0)O=O&&R.error===void 0;else if(!O)return!1;if(O){var I;if(x.length>0&&(I=x[0]),I instanceof Error)throw I;var B=new Error("Unhandled error."+(I?" ("+I.message+")":""));throw B.context=I,B}var U=R[v];if(U===void 0)return!1;if(typeof U=="function")m(U,this,x);else for(var F=U.length,W=r(U,F),L=0;L<F;++L)m(W[L],this,x);return!0};function d(E,v,x,L){var O,R,I;if(s(x),R=E._events,R===void 0?(R=E._events=Object.create(null),E._eventsCount=0):(R.newListener!==void 0&&(E.emit("newListener",v,x.listener?x.listener:x),R=E._events),I=R[v]),I===void 0)I=R[v]=x,++E._eventsCount;else if(typeof I=="function"?I=R[v]=L?[x,I]:[I,x]:L?I.unshift(x):I.push(x),O=o(E),O>0&&I.length>O&&!I.warned){I.warned=!0;var B=new Error("Possible EventEmitter memory leak detected. "+I.length+" "+String(v)+" listeners added. Use emitter.setMaxListeners() to increase limit");B.name="MaxListenersExceededWarning",B.emitter=E,B.type=v,B.count=I.length,c(B)}return E}a.prototype.addListener=function(v,x){return d(this,v,x,!1)},a.prototype.on=a.prototype.addListener,a.prototype.prependListener=function(v,x){return d(this,v,x,!0)};function t(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function e(E,v,x){var L={fired:!1,wrapFn:void 0,target:E,type:v,listener:x},O=t.bind(L);return O.listener=x,L.wrapFn=O,O}a.prototype.once=function(v,x){return s(x),this.on(v,e(this,v,x)),this},a.prototype.prependOnceListener=function(v,x){return s(x),this.prependListener(v,e(this,v,x)),this},a.prototype.removeListener=function(v,x){var L,O,R,I,B;if(s(x),O=this._events,O===void 0)return this;if(L=O[v],L===void 0)return this;if(L===x||L.listener===x)--this._eventsCount===0?this._events=Object.create(null):(delete O[v],O.removeListener&&this.emit("removeListener",v,L.listener||x));else if(typeof L!="function"){for(R=-1,I=L.length-1;I>=0;I--)if(L[I]===x||L[I].listener===x){B=L[I].listener,R=I;break}if(R<0)return this;R===0?L.shift():u(L,R),L.length===1&&(O[v]=L[0]),O.removeListener!==void 0&&this.emit("removeListener",v,B||x)}return this},a.prototype.off=a.prototype.removeListener,a.prototype.removeAllListeners=function(v){var x,L,O;if(L=this._events,L===void 0)return this;if(L.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):L[v]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete L[v]),this;if(arguments.length===0){var R=Object.keys(L),I;for(O=0;O<R.length;++O)I=R[O],I!=="removeListener"&&this.removeAllListeners(I);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(x=L[v],typeof x=="function")this.removeListener(v,x);else if(x!==void 0)for(O=x.length-1;O>=0;O--)this.removeListener(v,x[O]);return this};function n(E,v,x){var L=E._events;if(L===void 0)return[];var O=L[v];return O===void 0?[]:typeof O=="function"?x?[O.listener||O]:[O]:x?_(O):r(O,O.length)}a.prototype.listeners=function(v){return n(this,v,!0)},a.prototype.rawListeners=function(v){return n(this,v,!1)},a.listenerCount=function(E,v){return typeof E.listenerCount=="function"?E.listenerCount(v):i.call(E,v)},a.prototype.listenerCount=i;function i(E){var v=this._events;if(v!==void 0){var x=v[E];if(typeof x=="function")return 1;if(x!==void 0)return x.length}return 0}a.prototype.eventNames=function(){return this._eventsCount>0?y(this._events):[]};function r(E,v){for(var x=new Array(v),L=0;L<v;++L)x[L]=E[L];return x}function u(E,v){for(;v+1<E.length;v++)E[v]=E[v+1];E.pop()}function _(E){for(var v=new Array(E.length),x=0;x<v.length;++x)v[x]=E[x].listener||E[x];return v}function p(E,v){return new Promise(function(x,L){function O(I){E.removeListener(v,R),L(I)}function R(){typeof E.removeListener=="function"&&E.removeListener("error",O),x([].slice.call(arguments))}b(E,v,R,{once:!0}),v!=="error"&&g(E,O,{once:!0})})}function g(E,v,x){typeof E.on=="function"&&b(E,"error",v,x)}function b(E,v,x,L){if(typeof E.on=="function")L.once?E.once(v,x):E.on(v,x);else if(typeof E.addEventListener=="function")E.addEventListener(v,function O(R){L.once&&E.removeEventListener(v,O),x(R)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof E)}},"./node_modules/webworkify-webpack/index.js":function(T,S,m){function y(t){var e={};function n(r){if(e[r])return e[r].exports;var u=e[r]={i:r,l:!1,exports:{}};return t[r].call(u.exports,u,u.exports,n),u.l=!0,u.exports}n.m=t,n.c=e,n.i=function(r){return r},n.d=function(r,u,_){n.o(r,u)||Object.defineProperty(r,u,{configurable:!1,enumerable:!0,get:_})},n.r=function(r){Object.defineProperty(r,"__esModule",{value:!0})},n.n=function(r){var u=r&&r.__esModule?function(){return r.default}:function(){return r};return n.d(u,"a",u),u},n.o=function(r,u){return Object.prototype.hasOwnProperty.call(r,u)},n.p="/",n.oe=function(r){throw console.error(r),r};var i=n(n.s=ENTRY_MODULE);return i.default||i}var c="[\\.|\\-|\\+|\\w|/|@]+",l="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+c+").*?\\)";function a(t){return(t+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function f(t){return!isNaN(1*t)}function s(t,e,n){var i={};i[n]=[];var r=e.toString(),u=r.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!u)return i;for(var _=u[1],p=new RegExp("(\\\\n|\\W)"+a(_)+l,"g"),g;g=p.exec(r);)g[3]!=="dll-reference"&&i[n].push(g[3]);for(p=new RegExp("\\("+a(_)+'\\("(dll-reference\\s('+c+'))"\\)\\)'+l,"g");g=p.exec(r);)t[g[2]]||(i[n].push(g[1]),t[g[2]]=m(g[1]).m),i[g[2]]=i[g[2]]||[],i[g[2]].push(g[4]);for(var b=Object.keys(i),E=0;E<b.length;E++)for(var v=0;v<i[b[E]].length;v++)f(i[b[E]][v])&&(i[b[E]][v]=1*i[b[E]][v]);return i}function o(t){var e=Object.keys(t);return e.reduce(function(n,i){return n||t[i].length>0},!1)}function d(t,e){for(var n={main:[e]},i={main:[]},r={main:{}};o(n);)for(var u=Object.keys(n),_=0;_<u.length;_++){var p=u[_],g=n[p],b=g.pop();if(r[p]=r[p]||{},!(r[p][b]||!t[p][b])){r[p][b]=!0,i[p]=i[p]||[],i[p].push(b);for(var E=s(t,t[p][b],p),v=Object.keys(E),x=0;x<v.length;x++)n[v[x]]=n[v[x]]||[],n[v[x]]=n[v[x]].concat(E[v[x]])}}return i}T.exports=function(t,e){e=e||{};var n={main:m.m},i=e.all?{main:Object.keys(n.main)}:d(n,t),r="";Object.keys(i).filter(function(b){return b!=="main"}).forEach(function(b){for(var E=0;i[b][E];)E++;i[b].push(E),n[b][E]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",r=r+"var "+b+" = ("+y.toString().replace("ENTRY_MODULE",JSON.stringify(E))+")({"+i[b].map(function(v){return""+JSON.stringify(v)+": "+n[b][v].toString()}).join(",")+`});
`}),r=r+"new (("+y.toString().replace("ENTRY_MODULE",JSON.stringify(t))+")({"+i.main.map(function(b){return""+JSON.stringify(b)+": "+n.main[b].toString()}).join(",")+"}))(self);";var u=new window.Blob([r],{type:"text/javascript"});if(e.bare)return u;var _=window.URL||window.webkitURL||window.mozURL||window.msURL,p=_.createObjectURL(u),g=new window.Worker(p);return g.objectURL=p,g}},"./src/config.js":function(T,S,m){m.r(S),m.d(S,{defaultConfig:function(){return y},createDefaultConfig:function(){return c}});var y={enableWorker:!1,enableStashBuffer:!0,stashInitialSize:void 0,isLive:!1,lazyLoad:!0,lazyLoadMaxDuration:3*60,lazyLoadRecoverDuration:30,deferLoadAfterSourceOpen:!0,autoCleanupMaxBackwardDuration:3*60,autoCleanupMinBackwardDuration:2*60,statisticsInfoReportInterval:600,fixAudioTimestampGap:!0,accurateSeek:!1,seekType:"range",seekParamStart:"bstart",seekParamEnd:"bend",rangeLoadZeroStart:!1,customSeekHandler:void 0,reuseRedirectedURL:!1,headers:void 0,customLoader:void 0};function c(){return Object.assign({},y)}},"./src/core/features.js":function(T,S,m){m.r(S);var y=m("./src/io/io-controller.js"),c=m("./src/config.js"),l=function(){function a(){}return a.supportMSEH264Playback=function(){return window.MediaSource&&window.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"')},a.supportNetworkStreamIO=function(){var f=new y.default({},(0,c.createDefaultConfig)()),s=f.loaderType;return f.destroy(),s=="fetch-stream-loader"||s=="xhr-moz-chunked-loader"},a.getNetworkLoaderTypeName=function(){var f=new y.default({},(0,c.createDefaultConfig)()),s=f.loaderType;return f.destroy(),s},a.supportNativeMediaPlayback=function(f){a.videoElement==null&&(a.videoElement=window.document.createElement("video"));var s=a.videoElement.canPlayType(f);return s==="probably"||s=="maybe"},a.getFeatureList=function(){var f={mseFlvPlayback:!1,mseLiveFlvPlayback:!1,networkStreamIO:!1,networkLoaderName:"",nativeMP4H264Playback:!1,nativeWebmVP8Playback:!1,nativeWebmVP9Playback:!1};return f.mseFlvPlayback=a.supportMSEH264Playback(),f.networkStreamIO=a.supportNetworkStreamIO(),f.networkLoaderName=a.getNetworkLoaderTypeName(),f.mseLiveFlvPlayback=f.mseFlvPlayback&&f.networkStreamIO,f.nativeMP4H264Playback=a.supportNativeMediaPlayback('video/mp4; codecs="avc1.42001E, mp4a.40.2"'),f.nativeWebmVP8Playback=a.supportNativeMediaPlayback('video/webm; codecs="vp8.0, vorbis"'),f.nativeWebmVP9Playback=a.supportNativeMediaPlayback('video/webm; codecs="vp9"'),f},a}();S.default=l},"./src/core/media-info.js":function(T,S,m){m.r(S);var y=function(){function c(){this.mimeType=null,this.duration=null,this.hasAudio=null,this.hasVideo=null,this.audioCodec=null,this.videoCodec=null,this.audioDataRate=null,this.videoDataRate=null,this.audioSampleRate=null,this.audioChannelCount=null,this.width=null,this.height=null,this.fps=null,this.profile=null,this.level=null,this.refFrames=null,this.chromaFormat=null,this.sarNum=null,this.sarDen=null,this.metadata=null,this.segments=null,this.segmentCount=null,this.hasKeyframesIndex=null,this.keyframesIndex=null}return c.prototype.isComplete=function(){var l=this.hasAudio===!1||this.hasAudio===!0&&this.audioCodec!=null&&this.audioSampleRate!=null&&this.audioChannelCount!=null,a=this.hasVideo===!1||this.hasVideo===!0&&this.videoCodec!=null&&this.width!=null&&this.height!=null&&this.fps!=null&&this.profile!=null&&this.level!=null&&this.refFrames!=null&&this.chromaFormat!=null&&this.sarNum!=null&&this.sarDen!=null;return this.mimeType!=null&&this.duration!=null&&this.metadata!=null&&this.hasKeyframesIndex!=null&&l&&a},c.prototype.isSeekable=function(){return this.hasKeyframesIndex===!0},c.prototype.getNearestKeyframe=function(l){if(this.keyframesIndex==null)return null;var a=this.keyframesIndex,f=this._search(a.times,l);return{index:f,milliseconds:a.times[f],fileposition:a.filepositions[f]}},c.prototype._search=function(l,a){var f=0,s=l.length-1,o=0,d=0,t=s;for(a<l[0]&&(f=0,d=t+1);d<=t;)if(o=d+Math.floor((t-d)/2),o===s||a>=l[o]&&a<l[o+1]){f=o;break}else l[o]<a?d=o+1:t=o-1;return f},c}();S.default=y},"./src/core/media-segment-info.js":function(T,S,m){m.r(S),m.d(S,{SampleInfo:function(){return y},MediaSegmentInfo:function(){return c},IDRSampleList:function(){return l},MediaSegmentInfoList:function(){return a}});var y=function(){function f(s,o,d,t,e){this.dts=s,this.pts=o,this.duration=d,this.originalDts=t,this.isSyncPoint=e,this.fileposition=null}return f}(),c=function(){function f(){this.beginDts=0,this.endDts=0,this.beginPts=0,this.endPts=0,this.originalBeginDts=0,this.originalEndDts=0,this.syncPoints=[],this.firstSample=null,this.lastSample=null}return f.prototype.appendSyncPoint=function(s){s.isSyncPoint=!0,this.syncPoints.push(s)},f}(),l=function(){function f(){this._list=[]}return f.prototype.clear=function(){this._list=[]},f.prototype.appendArray=function(s){var o=this._list;s.length!==0&&(o.length>0&&s[0].originalDts<o[o.length-1].originalDts&&this.clear(),Array.prototype.push.apply(o,s))},f.prototype.getLastSyncPointBeforeDts=function(s){if(this._list.length==0)return null;var o=this._list,d=0,t=o.length-1,e=0,n=0,i=t;for(s<o[0].dts&&(d=0,n=i+1);n<=i;)if(e=n+Math.floor((i-n)/2),e===t||s>=o[e].dts&&s<o[e+1].dts){d=e;break}else o[e].dts<s?n=e+1:i=e-1;return this._list[d]},f}(),a=function(){function f(s){this._type=s,this._list=[],this._lastAppendLocation=-1}return Object.defineProperty(f.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"length",{get:function(){return this._list.length},enumerable:!1,configurable:!0}),f.prototype.isEmpty=function(){return this._list.length===0},f.prototype.clear=function(){this._list=[],this._lastAppendLocation=-1},f.prototype._searchNearestSegmentBefore=function(s){var o=this._list;if(o.length===0)return-2;var d=o.length-1,t=0,e=0,n=d,i=0;if(s<o[0].originalBeginDts)return i=-1,i;for(;e<=n;)if(t=e+Math.floor((n-e)/2),t===d||s>o[t].lastSample.originalDts&&s<o[t+1].originalBeginDts){i=t;break}else o[t].originalBeginDts<s?e=t+1:n=t-1;return i},f.prototype._searchNearestSegmentAfter=function(s){return this._searchNearestSegmentBefore(s)+1},f.prototype.append=function(s){var o=this._list,d=s,t=this._lastAppendLocation,e=0;t!==-1&&t<o.length&&d.originalBeginDts>=o[t].lastSample.originalDts&&(t===o.length-1||t<o.length-1&&d.originalBeginDts<o[t+1].originalBeginDts)?e=t+1:o.length>0&&(e=this._searchNearestSegmentBefore(d.originalBeginDts)+1),this._lastAppendLocation=e,this._list.splice(e,0,d)},f.prototype.getLastSegmentBefore=function(s){var o=this._searchNearestSegmentBefore(s);return o>=0?this._list[o]:null},f.prototype.getLastSampleBefore=function(s){var o=this.getLastSegmentBefore(s);return o!=null?o.lastSample:null},f.prototype.getLastSyncPointBefore=function(s){for(var o=this._searchNearestSegmentBefore(s),d=this._list[o].syncPoints;d.length===0&&o>0;)o--,d=this._list[o].syncPoints;return d.length>0?d[d.length-1]:null},f}()},"./src/core/mse-controller.js":function(T,S,m){m.r(S);var y=m("./node_modules/events/events.js"),c=m.n(y),l=m("./src/utils/logger.js"),a=m("./src/utils/browser.js"),f=m("./src/core/mse-events.js"),s=m("./src/core/media-segment-info.js"),o=m("./src/utils/exception.js"),d=function(){function t(e){this.TAG="MSEController",this._config=e,this._emitter=new(c()),this._config.isLive&&this._config.autoCleanupSourceBuffer==null&&(this._config.autoCleanupSourceBuffer=!0),this.e={onSourceOpen:this._onSourceOpen.bind(this),onSourceEnded:this._onSourceEnded.bind(this),onSourceClose:this._onSourceClose.bind(this),onSourceBufferError:this._onSourceBufferError.bind(this),onSourceBufferUpdateEnd:this._onSourceBufferUpdateEnd.bind(this)},this._mediaSource=null,this._mediaSourceObjectURL=null,this._mediaElement=null,this._isBufferFull=!1,this._hasPendingEos=!1,this._requireSetMediaDuration=!1,this._pendingMediaDuration=0,this._pendingSourceBufferInit=[],this._mimeTypes={video:null,audio:null},this._sourceBuffers={video:null,audio:null},this._lastInitSegments={video:null,audio:null},this._pendingSegments={video:[],audio:[]},this._pendingRemoveRanges={video:[],audio:[]},this._idrList=new s.IDRSampleList}return t.prototype.destroy=function(){(this._mediaElement||this._mediaSource)&&this.detachMediaElement(),this.e=null,this._emitter.removeAllListeners(),this._emitter=null},t.prototype.on=function(e,n){this._emitter.addListener(e,n)},t.prototype.off=function(e,n){this._emitter.removeListener(e,n)},t.prototype.attachMediaElement=function(e){if(this._mediaSource)throw new o.IllegalStateException("MediaSource has been attached to an HTMLMediaElement!");var n=this._mediaSource=new window.MediaSource;n.addEventListener("sourceopen",this.e.onSourceOpen),n.addEventListener("sourceended",this.e.onSourceEnded),n.addEventListener("sourceclose",this.e.onSourceClose),this._mediaElement=e,this._mediaSourceObjectURL=window.URL.createObjectURL(this._mediaSource),e.src=this._mediaSourceObjectURL},t.prototype.detachMediaElement=function(){if(this._mediaSource){var e=this._mediaSource;for(var n in this._sourceBuffers){var i=this._pendingSegments[n];i.splice(0,i.length),this._pendingSegments[n]=null,this._pendingRemoveRanges[n]=null,this._lastInitSegments[n]=null;var r=this._sourceBuffers[n];if(r){if(e.readyState!=="closed"){try{e.removeSourceBuffer(r)}catch(u){l.default.e(this.TAG,u.message)}r.removeEventListener("error",this.e.onSourceBufferError),r.removeEventListener("updateend",this.e.onSourceBufferUpdateEnd)}this._mimeTypes[n]=null,this._sourceBuffers[n]=null}}if(e.readyState==="open")try{e.endOfStream()}catch(u){l.default.e(this.TAG,u.message)}e.removeEventListener("sourceopen",this.e.onSourceOpen),e.removeEventListener("sourceended",this.e.onSourceEnded),e.removeEventListener("sourceclose",this.e.onSourceClose),this._pendingSourceBufferInit=[],this._isBufferFull=!1,this._idrList.clear(),this._mediaSource=null}this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src"),this._mediaElement=null),this._mediaSourceObjectURL&&(window.URL.revokeObjectURL(this._mediaSourceObjectURL),this._mediaSourceObjectURL=null)},t.prototype.appendInitSegment=function(e,n){if(!this._mediaSource||this._mediaSource.readyState!=="open"){this._pendingSourceBufferInit.push(e),this._pendingSegments[e.type].push(e);return}var i=e,r=""+i.container;i.codec&&i.codec.length>0&&(r+=";codecs="+i.codec);var u=!1;if(l.default.v(this.TAG,"Received Initialization Segment, mimeType: "+r),this._lastInitSegments[i.type]=i,r!==this._mimeTypes[i.type]){if(this._mimeTypes[i.type])l.default.v(this.TAG,"Notice: "+i.type+" mimeType changed, origin: "+this._mimeTypes[i.type]+", target: "+r);else{u=!0;try{var _=this._sourceBuffers[i.type]=this._mediaSource.addSourceBuffer(r);_.addEventListener("error",this.e.onSourceBufferError),_.addEventListener("updateend",this.e.onSourceBufferUpdateEnd)}catch(p){l.default.e(this.TAG,p.message),this._emitter.emit(f.default.ERROR,{code:p.code,msg:p.message});return}}this._mimeTypes[i.type]=r}n||this._pendingSegments[i.type].push(i),u||this._sourceBuffers[i.type]&&!this._sourceBuffers[i.type].updating&&this._doAppendSegments(),a.default.safari&&i.container==="audio/mpeg"&&i.mediaDuration>0&&(this._requireSetMediaDuration=!0,this._pendingMediaDuration=i.mediaDuration/1e3,this._updateMediaSourceDuration())},t.prototype.appendMediaSegment=function(e){var n=e;this._pendingSegments[n.type].push(n),this._config.autoCleanupSourceBuffer&&this._needCleanupSourceBuffer()&&this._doCleanupSourceBuffer();var i=this._sourceBuffers[n.type];i&&!i.updating&&!this._hasPendingRemoveRanges()&&this._doAppendSegments()},t.prototype.seek=function(e){for(var n in this._sourceBuffers)if(!!this._sourceBuffers[n]){var i=this._sourceBuffers[n];if(this._mediaSource.readyState==="open")try{i.abort()}catch(b){l.default.e(this.TAG,b.message)}this._idrList.clear();var r=this._pendingSegments[n];if(r.splice(0,r.length),this._mediaSource.readyState!=="closed"){for(var u=0;u<i.buffered.length;u++){var _=i.buffered.start(u),p=i.buffered.end(u);this._pendingRemoveRanges[n].push({start:_,end:p})}if(i.updating||this._doRemoveRanges(),a.default.safari){var g=this._lastInitSegments[n];g&&(this._pendingSegments[n].push(g),i.updating||this._doAppendSegments())}}}},t.prototype.endOfStream=function(){var e=this._mediaSource,n=this._sourceBuffers;if(!e||e.readyState!=="open"){e&&e.readyState==="closed"&&this._hasPendingSegments()&&(this._hasPendingEos=!0);return}n.video&&n.video.updating||n.audio&&n.audio.updating?this._hasPendingEos=!0:(this._hasPendingEos=!1,e.endOfStream())},t.prototype.getNearestKeyframe=function(e){return this._idrList.getLastSyncPointBeforeDts(e)},t.prototype._needCleanupSourceBuffer=function(){if(!this._config.autoCleanupSourceBuffer)return!1;var e=this._mediaElement.currentTime;for(var n in this._sourceBuffers){var i=this._sourceBuffers[n];if(i){var r=i.buffered;if(r.length>=1&&e-r.start(0)>=this._config.autoCleanupMaxBackwardDuration)return!0}}return!1},t.prototype._doCleanupSourceBuffer=function(){var e=this._mediaElement.currentTime;for(var n in this._sourceBuffers){var i=this._sourceBuffers[n];if(i){for(var r=i.buffered,u=!1,_=0;_<r.length;_++){var p=r.start(_),g=r.end(_);if(p<=e&&e<g+3){if(e-p>=this._config.autoCleanupMaxBackwardDuration){u=!0;var b=e-this._config.autoCleanupMinBackwardDuration;this._pendingRemoveRanges[n].push({start:p,end:b})}}else g<e&&(u=!0,this._pendingRemoveRanges[n].push({start:p,end:g}))}u&&!i.updating&&this._doRemoveRanges()}}},t.prototype._updateMediaSourceDuration=function(){var e=this._sourceBuffers;if(!(this._mediaElement.readyState===0||this._mediaSource.readyState!=="open")&&!(e.video&&e.video.updating||e.audio&&e.audio.updating)){var n=this._mediaSource.duration,i=this._pendingMediaDuration;i>0&&(isNaN(n)||i>n)&&(l.default.v(this.TAG,"Update MediaSource duration from "+n+" to "+i),this._mediaSource.duration=i),this._requireSetMediaDuration=!1,this._pendingMediaDuration=0}},t.prototype._doRemoveRanges=function(){for(var e in this._pendingRemoveRanges)if(!(!this._sourceBuffers[e]||this._sourceBuffers[e].updating))for(var n=this._sourceBuffers[e],i=this._pendingRemoveRanges[e];i.length&&!n.updating;){var r=i.shift();n.remove(r.start,r.end)}},t.prototype._doAppendSegments=function(){var e=this._pendingSegments;for(var n in e)if(!(!this._sourceBuffers[n]||this._sourceBuffers[n].updating)&&e[n].length>0){var i=e[n].shift();if(i.timestampOffset){var r=this._sourceBuffers[n].timestampOffset,u=i.timestampOffset/1e3,_=Math.abs(r-u);_>.1&&(l.default.v(this.TAG,"Update MPEG audio timestampOffset from "+r+" to "+u),this._sourceBuffers[n].timestampOffset=u),delete i.timestampOffset}if(!i.data||i.data.byteLength===0)continue;try{this._sourceBuffers[n].appendBuffer(i.data),this._isBufferFull=!1,n==="video"&&i.hasOwnProperty("info")&&this._idrList.appendArray(i.info.syncPoints)}catch(p){this._pendingSegments[n].unshift(i),p.code===22?(this._isBufferFull||this._emitter.emit(f.default.BUFFER_FULL),this._isBufferFull=!0):(l.default.e(this.TAG,p.message),this._emitter.emit(f.default.ERROR,{code:p.code,msg:p.message}))}}},t.prototype._onSourceOpen=function(){if(l.default.v(this.TAG,"MediaSource onSourceOpen"),this._mediaSource.removeEventListener("sourceopen",this.e.onSourceOpen),this._pendingSourceBufferInit.length>0)for(var e=this._pendingSourceBufferInit;e.length;){var n=e.shift();this.appendInitSegment(n,!0)}this._hasPendingSegments()&&this._doAppendSegments(),this._emitter.emit(f.default.SOURCE_OPEN)},t.prototype._onSourceEnded=function(){l.default.v(this.TAG,"MediaSource onSourceEnded")},t.prototype._onSourceClose=function(){l.default.v(this.TAG,"MediaSource onSourceClose"),this._mediaSource&&this.e!=null&&(this._mediaSource.removeEventListener("sourceopen",this.e.onSourceOpen),this._mediaSource.removeEventListener("sourceended",this.e.onSourceEnded),this._mediaSource.removeEventListener("sourceclose",this.e.onSourceClose))},t.prototype._hasPendingSegments=function(){var e=this._pendingSegments;return e.video.length>0||e.audio.length>0},t.prototype._hasPendingRemoveRanges=function(){var e=this._pendingRemoveRanges;return e.video.length>0||e.audio.length>0},t.prototype._onSourceBufferUpdateEnd=function(){this._requireSetMediaDuration?this._updateMediaSourceDuration():this._hasPendingRemoveRanges()?this._doRemoveRanges():this._hasPendingSegments()?this._doAppendSegments():this._hasPendingEos&&this.endOfStream(),this._emitter.emit(f.default.UPDATE_END)},t.prototype._onSourceBufferError=function(e){l.default.e(this.TAG,"SourceBuffer Error: "+e)},t}();S.default=d},"./src/core/mse-events.js":function(T,S,m){m.r(S);var y={ERROR:"error",SOURCE_OPEN:"source_open",UPDATE_END:"update_end",BUFFER_FULL:"buffer_full"};S.default=y},"./src/core/transmuxer.js":function(T,S,m){m.r(S);var y=m("./node_modules/events/events.js"),c=m.n(y),l=m("./node_modules/webworkify-webpack/index.js"),a=m.n(l),f=m("./src/utils/logger.js"),s=m("./src/utils/logging-control.js"),o=m("./src/core/transmuxing-controller.js"),d=m("./src/core/transmuxing-events.js"),t=m("./src/core/media-info.js"),e=function(){function n(i,r){if(this.TAG="Transmuxer",this._emitter=new(c()),r.enableWorker&&typeof Worker<"u")try{this._worker=a()("./src/core/transmuxing-worker.js"),this._workerDestroying=!1,this._worker.addEventListener("message",this._onWorkerMessage.bind(this)),this._worker.postMessage({cmd:"init",param:[i,r]}),this.e={onLoggingConfigChanged:this._onLoggingConfigChanged.bind(this)},s.default.registerListener(this.e.onLoggingConfigChanged),this._worker.postMessage({cmd:"logging_config",param:s.default.getConfig()})}catch{f.default.e(this.TAG,"Error while initialize transmuxing worker, fallback to inline transmuxing"),this._worker=null,this._controller=new o.default(i,r)}else this._controller=new o.default(i,r);if(this._controller){var u=this._controller;u.on(d.default.IO_ERROR,this._onIOError.bind(this)),u.on(d.default.DEMUX_ERROR,this._onDemuxError.bind(this)),u.on(d.default.INIT_SEGMENT,this._onInitSegment.bind(this)),u.on(d.default.MEDIA_SEGMENT,this._onMediaSegment.bind(this)),u.on(d.default.LOADING_COMPLETE,this._onLoadingComplete.bind(this)),u.on(d.default.RECOVERED_EARLY_EOF,this._onRecoveredEarlyEof.bind(this)),u.on(d.default.MEDIA_INFO,this._onMediaInfo.bind(this)),u.on(d.default.METADATA_ARRIVED,this._onMetaDataArrived.bind(this)),u.on(d.default.SCRIPTDATA_ARRIVED,this._onScriptDataArrived.bind(this)),u.on(d.default.STATISTICS_INFO,this._onStatisticsInfo.bind(this)),u.on(d.default.RECOMMEND_SEEKPOINT,this._onRecommendSeekpoint.bind(this))}}return n.prototype.destroy=function(){this._worker?this._workerDestroying||(this._workerDestroying=!0,this._worker.postMessage({cmd:"destroy"}),s.default.removeListener(this.e.onLoggingConfigChanged),this.e=null):(this._controller.destroy(),this._controller=null),this._emitter.removeAllListeners(),this._emitter=null},n.prototype.on=function(i,r){this._emitter.addListener(i,r)},n.prototype.off=function(i,r){this._emitter.removeListener(i,r)},n.prototype.hasWorker=function(){return this._worker!=null},n.prototype.open=function(){this._worker?this._worker.postMessage({cmd:"start"}):this._controller.start()},n.prototype.close=function(){this._worker?this._worker.postMessage({cmd:"stop"}):this._controller.stop()},n.prototype.seek=function(i){this._worker?this._worker.postMessage({cmd:"seek",param:i}):this._controller.seek(i)},n.prototype.pause=function(){this._worker?this._worker.postMessage({cmd:"pause"}):this._controller.pause()},n.prototype.resume=function(){this._worker?this._worker.postMessage({cmd:"resume"}):this._controller.resume()},n.prototype._onInitSegment=function(i,r){var u=this;Promise.resolve().then(function(){u._emitter.emit(d.default.INIT_SEGMENT,i,r)})},n.prototype._onMediaSegment=function(i,r){var u=this;Promise.resolve().then(function(){u._emitter.emit(d.default.MEDIA_SEGMENT,i,r)})},n.prototype._onLoadingComplete=function(){var i=this;Promise.resolve().then(function(){i._emitter.emit(d.default.LOADING_COMPLETE)})},n.prototype._onRecoveredEarlyEof=function(){var i=this;Promise.resolve().then(function(){i._emitter.emit(d.default.RECOVERED_EARLY_EOF)})},n.prototype._onMediaInfo=function(i){var r=this;Promise.resolve().then(function(){r._emitter.emit(d.default.MEDIA_INFO,i)})},n.prototype._onMetaDataArrived=function(i){var r=this;Promise.resolve().then(function(){r._emitter.emit(d.default.METADATA_ARRIVED,i)})},n.prototype._onScriptDataArrived=function(i){var r=this;Promise.resolve().then(function(){r._emitter.emit(d.default.SCRIPTDATA_ARRIVED,i)})},n.prototype._onStatisticsInfo=function(i){var r=this;Promise.resolve().then(function(){r._emitter.emit(d.default.STATISTICS_INFO,i)})},n.prototype._onIOError=function(i,r){var u=this;Promise.resolve().then(function(){u._emitter.emit(d.default.IO_ERROR,i,r)})},n.prototype._onDemuxError=function(i,r){var u=this;Promise.resolve().then(function(){u._emitter.emit(d.default.DEMUX_ERROR,i,r)})},n.prototype._onRecommendSeekpoint=function(i){var r=this;Promise.resolve().then(function(){r._emitter.emit(d.default.RECOMMEND_SEEKPOINT,i)})},n.prototype._onLoggingConfigChanged=function(i){this._worker&&this._worker.postMessage({cmd:"logging_config",param:i})},n.prototype._onWorkerMessage=function(i){var r=i.data,u=r.data;if(r.msg==="destroyed"||this._workerDestroying){this._workerDestroying=!1,this._worker.terminate(),this._worker=null;return}switch(r.msg){case d.default.INIT_SEGMENT:case d.default.MEDIA_SEGMENT:this._emitter.emit(r.msg,u.type,u.data);break;case d.default.LOADING_COMPLETE:case d.default.RECOVERED_EARLY_EOF:this._emitter.emit(r.msg);break;case d.default.MEDIA_INFO:Object.setPrototypeOf(u,t.default.prototype),this._emitter.emit(r.msg,u);break;case d.default.METADATA_ARRIVED:case d.default.SCRIPTDATA_ARRIVED:case d.default.STATISTICS_INFO:this._emitter.emit(r.msg,u);break;case d.default.IO_ERROR:case d.default.DEMUX_ERROR:this._emitter.emit(r.msg,u.type,u.info);break;case d.default.RECOMMEND_SEEKPOINT:this._emitter.emit(r.msg,u);break;case"logcat_callback":f.default.emitter.emit("log",u.type,u.logcat);break}},n}();S.default=e},"./src/core/transmuxing-controller.js":function(T,S,m){m.r(S);var y=m("./node_modules/events/events.js"),c=m.n(y),l=m("./src/utils/logger.js"),a=m("./src/utils/browser.js"),f=m("./src/core/media-info.js"),s=m("./src/demux/flv-demuxer.js"),o=m("./src/remux/mp4-remuxer.js"),d=m("./src/demux/demux-errors.js"),t=m("./src/io/io-controller.js"),e=m("./src/core/transmuxing-events.js"),n=function(){function i(r,u){this.TAG="TransmuxingController",this._emitter=new(c()),this._config=u,r.segments||(r.segments=[{duration:r.duration,filesize:r.filesize,url:r.url}]),typeof r.cors!="boolean"&&(r.cors=!0),typeof r.withCredentials!="boolean"&&(r.withCredentials=!1),this._mediaDataSource=r,this._currentSegmentIndex=0;var _=0;this._mediaDataSource.segments.forEach(function(p){p.timestampBase=_,_+=p.duration,p.cors=r.cors,p.withCredentials=r.withCredentials,u.referrerPolicy&&(p.referrerPolicy=u.referrerPolicy)}),!isNaN(_)&&this._mediaDataSource.duration!==_&&(this._mediaDataSource.duration=_),this._mediaInfo=null,this._demuxer=null,this._remuxer=null,this._ioctl=null,this._pendingSeekTime=null,this._pendingResolveSeekPoint=null,this._statisticsReporter=null}return i.prototype.destroy=function(){this._mediaInfo=null,this._mediaDataSource=null,this._statisticsReporter&&this._disableStatisticsReporter(),this._ioctl&&(this._ioctl.destroy(),this._ioctl=null),this._demuxer&&(this._demuxer.destroy(),this._demuxer=null),this._remuxer&&(this._remuxer.destroy(),this._remuxer=null),this._emitter.removeAllListeners(),this._emitter=null},i.prototype.on=function(r,u){this._emitter.addListener(r,u)},i.prototype.off=function(r,u){this._emitter.removeListener(r,u)},i.prototype.start=function(){this._loadSegment(0),this._enableStatisticsReporter()},i.prototype._loadSegment=function(r,u){this._currentSegmentIndex=r;var _=this._mediaDataSource.segments[r],p=this._ioctl=new t.default(_,this._config,r);p.onError=this._onIOException.bind(this),p.onSeeked=this._onIOSeeked.bind(this),p.onComplete=this._onIOComplete.bind(this),p.onRedirect=this._onIORedirect.bind(this),p.onRecoveredEarlyEof=this._onIORecoveredEarlyEof.bind(this),u?this._demuxer.bindDataSource(this._ioctl):p.onDataArrival=this._onInitChunkArrival.bind(this),p.open(u)},i.prototype.stop=function(){this._internalAbort(),this._disableStatisticsReporter()},i.prototype._internalAbort=function(){this._ioctl&&(this._ioctl.destroy(),this._ioctl=null)},i.prototype.pause=function(){this._ioctl&&this._ioctl.isWorking()&&(this._ioctl.pause(),this._disableStatisticsReporter())},i.prototype.resume=function(){this._ioctl&&this._ioctl.isPaused()&&(this._ioctl.resume(),this._enableStatisticsReporter())},i.prototype.seek=function(r){if(!(this._mediaInfo==null||!this._mediaInfo.isSeekable())){var u=this._searchSegmentIndexContains(r);if(u===this._currentSegmentIndex){var _=this._mediaInfo.segments[u];if(_==null)this._pendingSeekTime=r;else{var p=_.getNearestKeyframe(r);this._remuxer.seek(p.milliseconds),this._ioctl.seek(p.fileposition),this._pendingResolveSeekPoint=p.milliseconds}}else{var g=this._mediaInfo.segments[u];if(g==null)this._pendingSeekTime=r,this._internalAbort(),this._remuxer.seek(),this._remuxer.insertDiscontinuity(),this._loadSegment(u);else{var p=g.getNearestKeyframe(r);this._internalAbort(),this._remuxer.seek(r),this._remuxer.insertDiscontinuity(),this._demuxer.resetMediaInfo(),this._demuxer.timestampBase=this._mediaDataSource.segments[u].timestampBase,this._loadSegment(u,p.fileposition),this._pendingResolveSeekPoint=p.milliseconds,this._reportSegmentMediaInfo(u)}}this._enableStatisticsReporter()}},i.prototype._searchSegmentIndexContains=function(r){for(var u=this._mediaDataSource.segments,_=u.length-1,p=0;p<u.length;p++)if(r<u[p].timestampBase){_=p-1;break}return _},i.prototype._onInitChunkArrival=function(r,u){var _=this,p=null,g=0;if(u>0)this._demuxer.bindDataSource(this._ioctl),this._demuxer.timestampBase=this._mediaDataSource.segments[this._currentSegmentIndex].timestampBase,g=this._demuxer.parseChunks(r,u);else if((p=s.default.probe(r)).match){this._demuxer=new s.default(p,this._config),this._remuxer||(this._remuxer=new o.default(this._config));var b=this._mediaDataSource;b.duration!=null&&!isNaN(b.duration)&&(this._demuxer.overridedDuration=b.duration),typeof b.hasAudio=="boolean"&&(this._demuxer.overridedHasAudio=b.hasAudio),typeof b.hasVideo=="boolean"&&(this._demuxer.overridedHasVideo=b.hasVideo),this._demuxer.timestampBase=b.segments[this._currentSegmentIndex].timestampBase,this._demuxer.onError=this._onDemuxException.bind(this),this._demuxer.onMediaInfo=this._onMediaInfo.bind(this),this._demuxer.onMetaDataArrived=this._onMetaDataArrived.bind(this),this._demuxer.onScriptDataArrived=this._onScriptDataArrived.bind(this),this._remuxer.bindDataSource(this._demuxer.bindDataSource(this._ioctl)),this._remuxer.onInitSegment=this._onRemuxerInitSegmentArrival.bind(this),this._remuxer.onMediaSegment=this._onRemuxerMediaSegmentArrival.bind(this),g=this._demuxer.parseChunks(r,u)}else p=null,l.default.e(this.TAG,"Non-FLV, Unsupported media type!"),Promise.resolve().then(function(){_._internalAbort()}),this._emitter.emit(e.default.DEMUX_ERROR,d.default.FORMAT_UNSUPPORTED,"Non-FLV, Unsupported media type"),g=0;return g},i.prototype._onMediaInfo=function(r){var u=this;this._mediaInfo==null&&(this._mediaInfo=Object.assign({},r),this._mediaInfo.keyframesIndex=null,this._mediaInfo.segments=[],this._mediaInfo.segmentCount=this._mediaDataSource.segments.length,Object.setPrototypeOf(this._mediaInfo,f.default.prototype));var _=Object.assign({},r);Object.setPrototypeOf(_,f.default.prototype),this._mediaInfo.segments[this._currentSegmentIndex]=_,this._reportSegmentMediaInfo(this._currentSegmentIndex),this._pendingSeekTime!=null&&Promise.resolve().then(function(){var p=u._pendingSeekTime;u._pendingSeekTime=null,u.seek(p)})},i.prototype._onMetaDataArrived=function(r){this._emitter.emit(e.default.METADATA_ARRIVED,r)},i.prototype._onScriptDataArrived=function(r){this._emitter.emit(e.default.SCRIPTDATA_ARRIVED,r)},i.prototype._onIOSeeked=function(){this._remuxer.insertDiscontinuity()},i.prototype._onIOComplete=function(r){var u=r,_=u+1;_<this._mediaDataSource.segments.length?(this._internalAbort(),this._remuxer.flushStashedSamples(),this._loadSegment(_)):(this._remuxer.flushStashedSamples(),this._emitter.emit(e.default.LOADING_COMPLETE),this._disableStatisticsReporter())},i.prototype._onIORedirect=function(r){var u=this._ioctl.extraData;this._mediaDataSource.segments[u].redirectedURL=r},i.prototype._onIORecoveredEarlyEof=function(){this._emitter.emit(e.default.RECOVERED_EARLY_EOF)},i.prototype._onIOException=function(r,u){l.default.e(this.TAG,"IOException: type = "+r+", code = "+u.code+", msg = "+u.msg),this._emitter.emit(e.default.IO_ERROR,r,u),this._disableStatisticsReporter()},i.prototype._onDemuxException=function(r,u){l.default.e(this.TAG,"DemuxException: type = "+r+", info = "+u),this._emitter.emit(e.default.DEMUX_ERROR,r,u)},i.prototype._onRemuxerInitSegmentArrival=function(r,u){this._emitter.emit(e.default.INIT_SEGMENT,r,u)},i.prototype._onRemuxerMediaSegmentArrival=function(r,u){if(this._pendingSeekTime==null&&(this._emitter.emit(e.default.MEDIA_SEGMENT,r,u),this._pendingResolveSeekPoint!=null&&r==="video")){var _=u.info.syncPoints,p=this._pendingResolveSeekPoint;this._pendingResolveSeekPoint=null,a.default.safari&&_.length>0&&_[0].originalDts===p&&(p=_[0].pts),this._emitter.emit(e.default.RECOMMEND_SEEKPOINT,p)}},i.prototype._enableStatisticsReporter=function(){this._statisticsReporter==null&&(this._statisticsReporter=self.setInterval(this._reportStatisticsInfo.bind(this),this._config.statisticsInfoReportInterval))},i.prototype._disableStatisticsReporter=function(){this._statisticsReporter&&(self.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},i.prototype._reportSegmentMediaInfo=function(r){var u=this._mediaInfo.segments[r],_=Object.assign({},u);_.duration=this._mediaInfo.duration,_.segmentCount=this._mediaInfo.segmentCount,delete _.segments,delete _.keyframesIndex,this._emitter.emit(e.default.MEDIA_INFO,_)},i.prototype._reportStatisticsInfo=function(){var r={};r.url=this._ioctl.currentURL,r.hasRedirect=this._ioctl.hasRedirect,r.hasRedirect&&(r.redirectedURL=this._ioctl.currentRedirectedURL),r.speed=this._ioctl.currentSpeed,r.loaderType=this._ioctl.loaderType,r.currentSegmentIndex=this._currentSegmentIndex,r.totalSegmentCount=this._mediaDataSource.segments.length,this._emitter.emit(e.default.STATISTICS_INFO,r)},i}();S.default=n},"./src/core/transmuxing-events.js":function(T,S,m){m.r(S);var y={IO_ERROR:"io_error",DEMUX_ERROR:"demux_error",INIT_SEGMENT:"init_segment",MEDIA_SEGMENT:"media_segment",LOADING_COMPLETE:"loading_complete",RECOVERED_EARLY_EOF:"recovered_early_eof",MEDIA_INFO:"media_info",METADATA_ARRIVED:"metadata_arrived",SCRIPTDATA_ARRIVED:"scriptdata_arrived",STATISTICS_INFO:"statistics_info",RECOMMEND_SEEKPOINT:"recommend_seekpoint"};S.default=y},"./src/core/transmuxing-worker.js":function(T,S,m){m.r(S);var y=m("./src/utils/logging-control.js"),c=m("./src/utils/polyfill.js"),l=m("./src/core/transmuxing-controller.js"),a=m("./src/core/transmuxing-events.js"),f=function(s){var o=null,d=v.bind(this);c.default.install(),s.addEventListener("message",function(x){switch(x.data.cmd){case"init":o=new l.default(x.data.param[0],x.data.param[1]),o.on(a.default.IO_ERROR,g.bind(this)),o.on(a.default.DEMUX_ERROR,b.bind(this)),o.on(a.default.INIT_SEGMENT,t.bind(this)),o.on(a.default.MEDIA_SEGMENT,e.bind(this)),o.on(a.default.LOADING_COMPLETE,n.bind(this)),o.on(a.default.RECOVERED_EARLY_EOF,i.bind(this)),o.on(a.default.MEDIA_INFO,r.bind(this)),o.on(a.default.METADATA_ARRIVED,u.bind(this)),o.on(a.default.SCRIPTDATA_ARRIVED,_.bind(this)),o.on(a.default.STATISTICS_INFO,p.bind(this)),o.on(a.default.RECOMMEND_SEEKPOINT,E.bind(this));break;case"destroy":o&&(o.destroy(),o=null),s.postMessage({msg:"destroyed"});break;case"start":o.start();break;case"stop":o.stop();break;case"seek":o.seek(x.data.param);break;case"pause":o.pause();break;case"resume":o.resume();break;case"logging_config":{var L=x.data.param;y.default.applyConfig(L),L.enableCallback===!0?y.default.addLogListener(d):y.default.removeLogListener(d);break}}});function t(x,L){var O={msg:a.default.INIT_SEGMENT,data:{type:x,data:L}};s.postMessage(O,[L.data])}function e(x,L){var O={msg:a.default.MEDIA_SEGMENT,data:{type:x,data:L}};s.postMessage(O,[L.data])}function n(){var x={msg:a.default.LOADING_COMPLETE};s.postMessage(x)}function i(){var x={msg:a.default.RECOVERED_EARLY_EOF};s.postMessage(x)}function r(x){var L={msg:a.default.MEDIA_INFO,data:x};s.postMessage(L)}function u(x){var L={msg:a.default.METADATA_ARRIVED,data:x};s.postMessage(L)}function _(x){var L={msg:a.default.SCRIPTDATA_ARRIVED,data:x};s.postMessage(L)}function p(x){var L={msg:a.default.STATISTICS_INFO,data:x};s.postMessage(L)}function g(x,L){s.postMessage({msg:a.default.IO_ERROR,data:{type:x,info:L}})}function b(x,L){s.postMessage({msg:a.default.DEMUX_ERROR,data:{type:x,info:L}})}function E(x){s.postMessage({msg:a.default.RECOMMEND_SEEKPOINT,data:x})}function v(x,L){s.postMessage({msg:"logcat_callback",data:{type:x,logcat:L}})}};S.default=f},"./src/demux/amf-parser.js":function(T,S,m){m.r(S);var y=m("./src/utils/logger.js"),c=m("./src/utils/utf8-conv.js"),l=m("./src/utils/exception.js"),a=function(){var s=new ArrayBuffer(2);return new DataView(s).setInt16(0,256,!0),new Int16Array(s)[0]===256}(),f=function(){function s(){}return s.parseScriptData=function(o,d,t){var e={};try{var n=s.parseValue(o,d,t),i=s.parseValue(o,d+n.size,t-n.size);e[n.data]=i.data}catch(r){y.default.e("AMF",r.toString())}return e},s.parseObject=function(o,d,t){if(t<3)throw new l.IllegalStateException("Data not enough when parse ScriptDataObject");var e=s.parseString(o,d,t),n=s.parseValue(o,d+e.size,t-e.size),i=n.objectEnd;return{data:{name:e.data,value:n.data},size:e.size+n.size,objectEnd:i}},s.parseVariable=function(o,d,t){return s.parseObject(o,d,t)},s.parseString=function(o,d,t){if(t<2)throw new l.IllegalStateException("Data not enough when parse String");var e=new DataView(o,d,t),n=e.getUint16(0,!a),i;return n>0?i=(0,c.default)(new Uint8Array(o,d+2,n)):i="",{data:i,size:2+n}},s.parseLongString=function(o,d,t){if(t<4)throw new l.IllegalStateException("Data not enough when parse LongString");var e=new DataView(o,d,t),n=e.getUint32(0,!a),i;return n>0?i=(0,c.default)(new Uint8Array(o,d+4,n)):i="",{data:i,size:4+n}},s.parseDate=function(o,d,t){if(t<10)throw new l.IllegalStateException("Data size invalid when parse Date");var e=new DataView(o,d,t),n=e.getFloat64(0,!a),i=e.getInt16(8,!a);return n+=i*60*1e3,{data:new Date(n),size:8+2}},s.parseValue=function(o,d,t){if(t<1)throw new l.IllegalStateException("Data not enough when parse Value");var e=new DataView(o,d,t),n=1,i=e.getUint8(0),r,u=!1;try{switch(i){case 0:r=e.getFloat64(1,!a),n+=8;break;case 1:{var _=e.getUint8(1);r=!!_,n+=1;break}case 2:{var p=s.parseString(o,d+1,t-1);r=p.data,n+=p.size;break}case 3:{r={};var g=0;for((e.getUint32(t-4,!a)&16777215)===9&&(g=3);n<t-4;){var b=s.parseObject(o,d+n,t-n-g);if(b.objectEnd)break;r[b.data.name]=b.data.value,n+=b.size}if(n<=t-3){var E=e.getUint32(n-1,!a)&16777215;E===9&&(n+=3)}break}case 8:{r={},n+=4;var g=0;for((e.getUint32(t-4,!a)&16777215)===9&&(g=3);n<t-8;){var v=s.parseVariable(o,d+n,t-n-g);if(v.objectEnd)break;r[v.data.name]=v.data.value,n+=v.size}if(n<=t-3){var E=e.getUint32(n-1,!a)&16777215;E===9&&(n+=3)}break}case 9:r=void 0,n=1,u=!0;break;case 10:{r=[];var x=e.getUint32(1,!a);n+=4;for(var L=0;L<x;L++){var O=s.parseValue(o,d+n,t-n);r.push(O.data),n+=O.size}break}case 11:{var R=s.parseDate(o,d+1,t-1);r=R.data,n+=R.size;break}case 12:{var I=s.parseString(o,d+1,t-1);r=I.data,n+=I.size;break}default:n=t,y.default.w("AMF","Unsupported AMF value type "+i)}}catch(B){y.default.e("AMF",B.toString())}return{data:r,size:n,objectEnd:u}},s}();S.default=f},"./src/demux/demux-errors.js":function(T,S,m){m.r(S);var y={OK:"OK",FORMAT_ERROR:"FormatError",FORMAT_UNSUPPORTED:"FormatUnsupported",CODEC_UNSUPPORTED:"CodecUnsupported"};S.default=y},"./src/demux/exp-golomb.js":function(T,S,m){m.r(S);var y=m("./src/utils/exception.js"),c=function(){function l(a){this.TAG="ExpGolomb",this._buffer=a,this._buffer_index=0,this._total_bytes=a.byteLength,this._total_bits=a.byteLength*8,this._current_word=0,this._current_word_bits_left=0}return l.prototype.destroy=function(){this._buffer=null},l.prototype._fillCurrentWord=function(){var a=this._total_bytes-this._buffer_index;if(a<=0)throw new y.IllegalStateException("ExpGolomb: _fillCurrentWord() but no bytes available");var f=Math.min(4,a),s=new Uint8Array(4);s.set(this._buffer.subarray(this._buffer_index,this._buffer_index+f)),this._current_word=new DataView(s.buffer).getUint32(0,!1),this._buffer_index+=f,this._current_word_bits_left=f*8},l.prototype.readBits=function(a){if(a>32)throw new y.InvalidArgumentException("ExpGolomb: readBits() bits exceeded max 32bits!");if(a<=this._current_word_bits_left){var f=this._current_word>>>32-a;return this._current_word<<=a,this._current_word_bits_left-=a,f}var s=this._current_word_bits_left?this._current_word:0;s=s>>>32-this._current_word_bits_left;var o=a-this._current_word_bits_left;this._fillCurrentWord();var d=Math.min(o,this._current_word_bits_left),t=this._current_word>>>32-d;return this._current_word<<=d,this._current_word_bits_left-=d,s=s<<d|t,s},l.prototype.readBool=function(){return this.readBits(1)===1},l.prototype.readByte=function(){return this.readBits(8)},l.prototype._skipLeadingZero=function(){var a;for(a=0;a<this._current_word_bits_left;a++)if((this._current_word&2147483648>>>a)!==0)return this._current_word<<=a,this._current_word_bits_left-=a,a;return this._fillCurrentWord(),a+this._skipLeadingZero()},l.prototype.readUEG=function(){var a=this._skipLeadingZero();return this.readBits(a+1)-1},l.prototype.readSEG=function(){var a=this.readUEG();return a&1?a+1>>>1:-1*(a>>>1)},l}();S.default=c},"./src/demux/flv-demuxer.js":function(T,S,m){m.r(S);var y=m("./src/utils/logger.js"),c=m("./src/demux/amf-parser.js"),l=m("./src/demux/sps-parser.js"),a=m("./src/demux/demux-errors.js"),f=m("./src/core/media-info.js"),s=m("./src/utils/exception.js");function o(t,e){return t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3]}var d=function(){function t(e,n){this.TAG="FLVDemuxer",this._config=n,this._onError=null,this._onMediaInfo=null,this._onMetaDataArrived=null,this._onScriptDataArrived=null,this._onTrackMetadata=null,this._onDataAvailable=null,this._dataOffset=e.dataOffset,this._firstParse=!0,this._dispatch=!1,this._hasAudio=e.hasAudioTrack,this._hasVideo=e.hasVideoTrack,this._hasAudioFlagOverrided=!1,this._hasVideoFlagOverrided=!1,this._audioInitialMetadataDispatched=!1,this._videoInitialMetadataDispatched=!1,this._mediaInfo=new f.default,this._mediaInfo.hasAudio=this._hasAudio,this._mediaInfo.hasVideo=this._hasVideo,this._metadata=null,this._audioMetadata=null,this._videoMetadata=null,this._naluLengthSize=4,this._timestampBase=0,this._timescale=1e3,this._duration=0,this._durationOverrided=!1,this._referenceFrameRate={fixed:!0,fps:23.976,fps_num:23976,fps_den:1e3},this._flvSoundRateTable=[5500,11025,22050,44100,48e3],this._mpegSamplingRates=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],this._mpegAudioV10SampleRateTable=[44100,48e3,32e3,0],this._mpegAudioV20SampleRateTable=[22050,24e3,16e3,0],this._mpegAudioV25SampleRateTable=[11025,12e3,8e3,0],this._mpegAudioL1BitRateTable=[0,32,64,96,128,160,192,224,256,288,320,352,384,416,448,-1],this._mpegAudioL2BitRateTable=[0,32,48,56,64,80,96,112,128,160,192,224,256,320,384,-1],this._mpegAudioL3BitRateTable=[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],this._videoTrack={type:"video",id:1,sequenceNumber:0,samples:[],length:0},this._audioTrack={type:"audio",id:2,sequenceNumber:0,samples:[],length:0},this._littleEndian=function(){var i=new ArrayBuffer(2);return new DataView(i).setInt16(0,256,!0),new Int16Array(i)[0]===256}()}return t.prototype.destroy=function(){this._mediaInfo=null,this._metadata=null,this._audioMetadata=null,this._videoMetadata=null,this._videoTrack=null,this._audioTrack=null,this._onError=null,this._onMediaInfo=null,this._onMetaDataArrived=null,this._onScriptDataArrived=null,this._onTrackMetadata=null,this._onDataAvailable=null},t.probe=function(e){var n=new Uint8Array(e),i={match:!1};if(n[0]!==70||n[1]!==76||n[2]!==86||n[3]!==1)return i;var r=(n[4]&4)>>>2!==0,u=(n[4]&1)!==0,_=o(n,5);return _<9?i:{match:!0,consumed:_,dataOffset:_,hasAudioTrack:r,hasVideoTrack:u}},t.prototype.bindDataSource=function(e){return e.onDataArrival=this.parseChunks.bind(this),this},Object.defineProperty(t.prototype,"onTrackMetadata",{get:function(){return this._onTrackMetadata},set:function(e){this._onTrackMetadata=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onMediaInfo",{get:function(){return this._onMediaInfo},set:function(e){this._onMediaInfo=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onMetaDataArrived",{get:function(){return this._onMetaDataArrived},set:function(e){this._onMetaDataArrived=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onScriptDataArrived",{get:function(){return this._onScriptDataArrived},set:function(e){this._onScriptDataArrived=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onError",{get:function(){return this._onError},set:function(e){this._onError=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onDataAvailable",{get:function(){return this._onDataAvailable},set:function(e){this._onDataAvailable=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"timestampBase",{get:function(){return this._timestampBase},set:function(e){this._timestampBase=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"overridedDuration",{get:function(){return this._duration},set:function(e){this._durationOverrided=!0,this._duration=e,this._mediaInfo.duration=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"overridedHasAudio",{set:function(e){this._hasAudioFlagOverrided=!0,this._hasAudio=e,this._mediaInfo.hasAudio=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"overridedHasVideo",{set:function(e){this._hasVideoFlagOverrided=!0,this._hasVideo=e,this._mediaInfo.hasVideo=e},enumerable:!1,configurable:!0}),t.prototype.resetMediaInfo=function(){this._mediaInfo=new f.default},t.prototype._isInitialMetadataDispatched=function(){return this._hasAudio&&this._hasVideo?this._audioInitialMetadataDispatched&&this._videoInitialMetadataDispatched:this._hasAudio&&!this._hasVideo?this._audioInitialMetadataDispatched:!this._hasAudio&&this._hasVideo?this._videoInitialMetadataDispatched:!1},t.prototype.parseChunks=function(e,n){if(!this._onError||!this._onMediaInfo||!this._onTrackMetadata||!this._onDataAvailable)throw new s.IllegalStateException("Flv: onError & onMediaInfo & onTrackMetadata & onDataAvailable callback must be specified");var i=0,r=this._littleEndian;if(n===0)if(e.byteLength>13){var u=t.probe(e);i=u.dataOffset}else return 0;if(this._firstParse){this._firstParse=!1,n+i!==this._dataOffset&&y.default.w(this.TAG,"First time parsing but chunk byteStart invalid!");var _=new DataView(e,i),p=_.getUint32(0,!r);p!==0&&y.default.w(this.TAG,"PrevTagSize0 !== 0 !!!"),i+=4}for(;i<e.byteLength;){this._dispatch=!0;var _=new DataView(e,i);if(i+11+4>e.byteLength)break;var g=_.getUint8(0),b=_.getUint32(0,!r)&16777215;if(i+11+b+4>e.byteLength)break;if(g!==8&&g!==9&&g!==18){y.default.w(this.TAG,"Unsupported tag type "+g+", skipped"),i+=11+b+4;continue}var E=_.getUint8(4),v=_.getUint8(5),x=_.getUint8(6),L=_.getUint8(7),O=x|v<<8|E<<16|L<<24,R=_.getUint32(7,!r)&16777215;R!==0&&y.default.w(this.TAG,"Meet tag which has StreamID != 0!");var I=i+11;switch(g){case 8:this._parseAudioData(e,I,b,O);break;case 9:this._parseVideoData(e,I,b,O,n+i);break;case 18:this._parseScriptData(e,I,b);break}var B=_.getUint32(11+b,!r);B!==11+b&&y.default.w(this.TAG,"Invalid PrevTagSize "+B),i+=11+b+4}return this._isInitialMetadataDispatched()&&this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack),i},t.prototype._parseScriptData=function(e,n,i){var r=c.default.parseScriptData(e,n,i);if(r.hasOwnProperty("onMetaData")){if(r.onMetaData==null||typeof r.onMetaData!="object"){y.default.w(this.TAG,"Invalid onMetaData structure!");return}this._metadata&&y.default.w(this.TAG,"Found another onMetaData tag!"),this._metadata=r;var u=this._metadata.onMetaData;if(this._onMetaDataArrived&&this._onMetaDataArrived(Object.assign({},u)),typeof u.hasAudio=="boolean"&&this._hasAudioFlagOverrided===!1&&(this._hasAudio=u.hasAudio,this._mediaInfo.hasAudio=this._hasAudio),typeof u.hasVideo=="boolean"&&this._hasVideoFlagOverrided===!1&&(this._hasVideo=u.hasVideo,this._mediaInfo.hasVideo=this._hasVideo),typeof u.audiodatarate=="number"&&(this._mediaInfo.audioDataRate=u.audiodatarate),typeof u.videodatarate=="number"&&(this._mediaInfo.videoDataRate=u.videodatarate),typeof u.width=="number"&&(this._mediaInfo.width=u.width),typeof u.height=="number"&&(this._mediaInfo.height=u.height),typeof u.duration=="number"){if(!this._durationOverrided){var _=Math.floor(u.duration*this._timescale);this._duration=_,this._mediaInfo.duration=_}}else this._mediaInfo.duration=0;if(typeof u.framerate=="number"){var p=Math.floor(u.framerate*1e3);if(p>0){var g=p/1e3;this._referenceFrameRate.fixed=!0,this._referenceFrameRate.fps=g,this._referenceFrameRate.fps_num=p,this._referenceFrameRate.fps_den=1e3,this._mediaInfo.fps=g}}if(typeof u.keyframes=="object"){this._mediaInfo.hasKeyframesIndex=!0;var b=u.keyframes;this._mediaInfo.keyframesIndex=this._parseKeyframesIndex(b),u.keyframes=null}else this._mediaInfo.hasKeyframesIndex=!1;this._dispatch=!1,this._mediaInfo.metadata=u,y.default.v(this.TAG,"Parsed onMetaData"),this._mediaInfo.isComplete()&&this._onMediaInfo(this._mediaInfo)}Object.keys(r).length>0&&this._onScriptDataArrived&&this._onScriptDataArrived(Object.assign({},r))},t.prototype._parseKeyframesIndex=function(e){for(var n=[],i=[],r=1;r<e.times.length;r++){var u=this._timestampBase+Math.floor(e.times[r]*1e3);n.push(u),i.push(e.filepositions[r])}return{times:n,filepositions:i}},t.prototype._parseAudioData=function(e,n,i,r){if(i<=1){y.default.w(this.TAG,"Flv: Invalid audio packet, missing SoundData payload!");return}if(!(this._hasAudioFlagOverrided===!0&&this._hasAudio===!1)){this._littleEndian;var u=new DataView(e,n,i),_=u.getUint8(0),p=_>>>4;if(p!==2&&p!==10){this._onError(a.default.CODEC_UNSUPPORTED,"Flv: Unsupported audio codec idx: "+p);return}var g=0,b=(_&12)>>>2;if(b>=0&&b<=4)g=this._flvSoundRateTable[b];else{this._onError(a.default.FORMAT_ERROR,"Flv: Invalid audio sample rate idx: "+b);return}var E=_&1,v=this._audioMetadata,x=this._audioTrack;if(v||(this._hasAudio===!1&&this._hasAudioFlagOverrided===!1&&(this._hasAudio=!0,this._mediaInfo.hasAudio=!0),v=this._audioMetadata={},v.type="audio",v.id=x.id,v.timescale=this._timescale,v.duration=this._duration,v.audioSampleRate=g,v.channelCount=E===0?1:2),p===10){var L=this._parseAACAudioData(e,n+1,i-1);if(L==null)return;if(L.packetType===0){v.config&&y.default.w(this.TAG,"Found another AudioSpecificConfig!");var O=L.data;v.audioSampleRate=O.samplingRate,v.channelCount=O.channelCount,v.codec=O.codec,v.originalCodec=O.originalCodec,v.config=O.config,v.refSampleDuration=1024/v.audioSampleRate*v.timescale,y.default.v(this.TAG,"Parsed AudioSpecificConfig"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._audioInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("audio",v);var R=this._mediaInfo;R.audioCodec=v.originalCodec,R.audioSampleRate=v.audioSampleRate,R.audioChannelCount=v.channelCount,R.hasVideo?R.videoCodec!=null&&(R.mimeType='video/x-flv; codecs="'+R.videoCodec+","+R.audioCodec+'"'):R.mimeType='video/x-flv; codecs="'+R.audioCodec+'"',R.isComplete()&&this._onMediaInfo(R)}else if(L.packetType===1){var I=this._timestampBase+r,B={unit:L.data,length:L.data.byteLength,dts:I,pts:I};x.samples.push(B),x.length+=L.data.length}else y.default.e(this.TAG,"Flv: Unsupported AAC data type "+L.packetType)}else if(p===2){if(!v.codec){var O=this._parseMP3AudioData(e,n+1,i-1,!0);if(O==null)return;v.audioSampleRate=O.samplingRate,v.channelCount=O.channelCount,v.codec=O.codec,v.originalCodec=O.originalCodec,v.refSampleDuration=1152/v.audioSampleRate*v.timescale,y.default.v(this.TAG,"Parsed MPEG Audio Frame Header"),this._audioInitialMetadataDispatched=!0,this._onTrackMetadata("audio",v);var R=this._mediaInfo;R.audioCodec=v.codec,R.audioSampleRate=v.audioSampleRate,R.audioChannelCount=v.channelCount,R.audioDataRate=O.bitRate,R.hasVideo?R.videoCodec!=null&&(R.mimeType='video/x-flv; codecs="'+R.videoCodec+","+R.audioCodec+'"'):R.mimeType='video/x-flv; codecs="'+R.audioCodec+'"',R.isComplete()&&this._onMediaInfo(R)}var U=this._parseMP3AudioData(e,n+1,i-1,!1);if(U==null)return;var I=this._timestampBase+r,F={unit:U,length:U.byteLength,dts:I,pts:I};x.samples.push(F),x.length+=U.length}}},t.prototype._parseAACAudioData=function(e,n,i){if(i<=1){y.default.w(this.TAG,"Flv: Invalid AAC packet, missing AACPacketType or/and Data!");return}var r={},u=new Uint8Array(e,n,i);return r.packetType=u[0],u[0]===0?r.data=this._parseAACAudioSpecificConfig(e,n+1,i-1):r.data=u.subarray(1),r},t.prototype._parseAACAudioSpecificConfig=function(e,n,i){var r=new Uint8Array(e,n,i),u=null,_=0,p=0,g=0,b=null;if(_=p=r[0]>>>3,g=(r[0]&7)<<1|r[1]>>>7,g<0||g>=this._mpegSamplingRates.length){this._onError(a.default.FORMAT_ERROR,"Flv: AAC invalid sampling frequency index!");return}var E=this._mpegSamplingRates[g],v=(r[1]&120)>>>3;if(v<0||v>=8){this._onError(a.default.FORMAT_ERROR,"Flv: AAC invalid channel configuration");return}_===5&&(b=(r[1]&7)<<1|r[2]>>>7,(r[2]&124)>>>2);var x=self.navigator.userAgent.toLowerCase();return x.indexOf("firefox")!==-1?g>=6?(_=5,u=new Array(4),b=g-3):(_=2,u=new Array(2),b=g):x.indexOf("android")!==-1?(_=2,u=new Array(2),b=g):(_=5,b=g,u=new Array(4),g>=6?b=g-3:v===1&&(_=2,u=new Array(2),b=g)),u[0]=_<<3,u[0]|=(g&15)>>>1,u[1]=(g&15)<<7,u[1]|=(v&15)<<3,_===5&&(u[1]|=(b&15)>>>1,u[2]=(b&1)<<7,u[2]|=2<<2,u[3]=0),{config:u,samplingRate:E,channelCount:v,codec:"mp4a.40."+_,originalCodec:"mp4a.40."+p}},t.prototype._parseMP3AudioData=function(e,n,i,r){if(i<4){y.default.w(this.TAG,"Flv: Invalid MP3 packet, header missing!");return}this._littleEndian;var u=new Uint8Array(e,n,i),_=null;if(r){if(u[0]!==255)return;var p=u[1]>>>3&3,g=(u[1]&6)>>1,b=(u[2]&240)>>>4,E=(u[2]&12)>>>2,v=u[3]>>>6&3,x=v!==3?2:1,L=0,O=0,R="mp3";switch(p){case 0:L=this._mpegAudioV25SampleRateTable[E];break;case 2:L=this._mpegAudioV20SampleRateTable[E];break;case 3:L=this._mpegAudioV10SampleRateTable[E];break}switch(g){case 1:b<this._mpegAudioL3BitRateTable.length&&(O=this._mpegAudioL3BitRateTable[b]);break;case 2:b<this._mpegAudioL2BitRateTable.length&&(O=this._mpegAudioL2BitRateTable[b]);break;case 3:b<this._mpegAudioL1BitRateTable.length&&(O=this._mpegAudioL1BitRateTable[b]);break}_={bitRate:O,samplingRate:L,channelCount:x,codec:R,originalCodec:R}}else _=u;return _},t.prototype._parseVideoData=function(e,n,i,r,u){if(i<=1){y.default.w(this.TAG,"Flv: Invalid video packet, missing VideoData payload!");return}if(!(this._hasVideoFlagOverrided===!0&&this._hasVideo===!1)){var _=new Uint8Array(e,n,i)[0],p=(_&240)>>>4,g=_&15;if(g!==7){this._onError(a.default.CODEC_UNSUPPORTED,"Flv: Unsupported codec in video frame: "+g);return}this._parseAVCVideoPacket(e,n+1,i-1,r,u,p)}},t.prototype._parseAVCVideoPacket=function(e,n,i,r,u,_){if(i<4){y.default.w(this.TAG,"Flv: Invalid AVC packet, missing AVCPacketType or/and CompositionTime");return}var p=this._littleEndian,g=new DataView(e,n,i),b=g.getUint8(0),E=g.getUint32(0,!p)&16777215,v=E<<8>>8;if(b===0)this._parseAVCDecoderConfigurationRecord(e,n+4,i-4);else if(b===1)this._parseAVCVideoData(e,n+4,i-4,r,u,_,v);else if(b!==2){this._onError(a.default.FORMAT_ERROR,"Flv: Invalid video packet type "+b);return}},t.prototype._parseAVCDecoderConfigurationRecord=function(e,n,i){if(i<7){y.default.w(this.TAG,"Flv: Invalid AVCDecoderConfigurationRecord, lack of data!");return}var r=this._videoMetadata,u=this._videoTrack,_=this._littleEndian,p=new DataView(e,n,i);r?typeof r.avcc<"u"&&y.default.w(this.TAG,"Found another AVCDecoderConfigurationRecord!"):(this._hasVideo===!1&&this._hasVideoFlagOverrided===!1&&(this._hasVideo=!0,this._mediaInfo.hasVideo=!0),r=this._videoMetadata={},r.type="video",r.id=u.id,r.timescale=this._timescale,r.duration=this._duration);var g=p.getUint8(0),b=p.getUint8(1);if(p.getUint8(2),p.getUint8(3),g!==1||b===0){this._onError(a.default.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord");return}if(this._naluLengthSize=(p.getUint8(4)&3)+1,this._naluLengthSize!==3&&this._naluLengthSize!==4){this._onError(a.default.FORMAT_ERROR,"Flv: Strange NaluLengthSizeMinusOne: "+(this._naluLengthSize-1));return}var E=p.getUint8(5)&31;if(E===0){this._onError(a.default.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord: No SPS");return}else E>1&&y.default.w(this.TAG,"Flv: Strange AVCDecoderConfigurationRecord: SPS Count = "+E);for(var v=6,x=0;x<E;x++){var L=p.getUint16(v,!_);if(v+=2,L!==0){var O=new Uint8Array(e,n+v,L);v+=L;var R=l.default.parseSPS(O);if(x===0){r.codecWidth=R.codec_size.width,r.codecHeight=R.codec_size.height,r.presentWidth=R.present_size.width,r.presentHeight=R.present_size.height,r.profile=R.profile_string,r.level=R.level_string,r.bitDepth=R.bit_depth,r.chromaFormat=R.chroma_format,r.sarRatio=R.sar_ratio,r.frameRate=R.frame_rate,(R.frame_rate.fixed===!1||R.frame_rate.fps_num===0||R.frame_rate.fps_den===0)&&(r.frameRate=this._referenceFrameRate);var I=r.frameRate.fps_den,B=r.frameRate.fps_num;r.refSampleDuration=r.timescale*(I/B);for(var U=O.subarray(1,4),F="avc1.",W=0;W<3;W++){var z=U[W].toString(16);z.length<2&&(z="0"+z),F+=z}r.codec=F;var P=this._mediaInfo;P.width=r.codecWidth,P.height=r.codecHeight,P.fps=r.frameRate.fps,P.profile=r.profile,P.level=r.level,P.refFrames=R.ref_frames,P.chromaFormat=R.chroma_format_string,P.sarNum=r.sarRatio.width,P.sarDen=r.sarRatio.height,P.videoCodec=F,P.hasAudio?P.audioCodec!=null&&(P.mimeType='video/x-flv; codecs="'+P.videoCodec+","+P.audioCodec+'"'):P.mimeType='video/x-flv; codecs="'+P.videoCodec+'"',P.isComplete()&&this._onMediaInfo(P)}}}var G=p.getUint8(v);if(G===0){this._onError(a.default.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord: No PPS");return}else G>1&&y.default.w(this.TAG,"Flv: Strange AVCDecoderConfigurationRecord: PPS Count = "+G);v++;for(var x=0;x<G;x++){var L=p.getUint16(v,!_);v+=2,L!==0&&(v+=L)}r.avcc=new Uint8Array(i),r.avcc.set(new Uint8Array(e,n,i),0),y.default.v(this.TAG,"Parsed AVCDecoderConfigurationRecord"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._videoInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("video",r)},t.prototype._parseAVCVideoData=function(e,n,i,r,u,_,p){for(var g=this._littleEndian,b=new DataView(e,n,i),E=[],v=0,x=0,L=this._naluLengthSize,O=this._timestampBase+r,R=_===1;x<i;){if(x+4>=i){y.default.w(this.TAG,"Malformed Nalu near timestamp "+O+", offset = "+x+", dataSize = "+i);break}var I=b.getUint32(x,!g);if(L===3&&(I>>>=8),I>i-L){y.default.w(this.TAG,"Malformed Nalus near timestamp "+O+", NaluSize > DataSize!");return}var B=b.getUint8(x+L)&31;B===5&&(R=!0);var U=new Uint8Array(e,n+x,L+I),F={type:B,data:U};E.push(F),v+=U.byteLength,x+=L+I}if(E.length){var W=this._videoTrack,z={units:E,length:v,isKeyframe:R,dts:O,cts:p,pts:O+p};R&&(z.fileposition=u),W.samples.push(z),W.length+=v}},t}();S.default=d},"./src/demux/sps-parser.js":function(T,S,m){m.r(S);var y=m("./src/demux/exp-golomb.js"),c=function(){function l(){}return l._ebsp2rbsp=function(a){for(var f=a,s=f.byteLength,o=new Uint8Array(s),d=0,t=0;t<s;t++)t>=2&&f[t]===3&&f[t-1]===0&&f[t-2]===0||(o[d]=f[t],d++);return new Uint8Array(o.buffer,0,d)},l.parseSPS=function(a){var f=l._ebsp2rbsp(a),s=new y.default(f);s.readByte();var o=s.readByte();s.readByte();var d=s.readByte();s.readUEG();var t=l.getProfileString(o),e=l.getLevelString(d),n=1,i=420,r=[0,420,422,444],u=8;if((o===100||o===110||o===122||o===244||o===44||o===83||o===86||o===118||o===128||o===138||o===144)&&(n=s.readUEG(),n===3&&s.readBits(1),n<=3&&(i=r[n]),u=s.readUEG()+8,s.readUEG(),s.readBits(1),s.readBool()))for(var _=n!==3?8:12,p=0;p<_;p++)s.readBool()&&(p<6?l._skipScalingList(s,16):l._skipScalingList(s,64));s.readUEG();var g=s.readUEG();if(g===0)s.readUEG();else if(g===1){s.readBits(1),s.readSEG(),s.readSEG();for(var b=s.readUEG(),p=0;p<b;p++)s.readSEG()}var E=s.readUEG();s.readBits(1);var v=s.readUEG(),x=s.readUEG(),L=s.readBits(1);L===0&&s.readBits(1),s.readBits(1);var O=0,R=0,I=0,B=0,U=s.readBool();U&&(O=s.readUEG(),R=s.readUEG(),I=s.readUEG(),B=s.readUEG());var F=1,W=1,z=0,P=!0,G=0,ie=0,V=s.readBool();if(V){if(s.readBool()){var H=s.readByte(),ee=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],Q=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];H>0&&H<16?(F=ee[H-1],W=Q[H-1]):H===255&&(F=s.readByte()<<8|s.readByte(),W=s.readByte()<<8|s.readByte())}if(s.readBool()&&s.readBool(),s.readBool()&&(s.readBits(4),s.readBool()&&s.readBits(24)),s.readBool()&&(s.readUEG(),s.readUEG()),s.readBool()){var $=s.readBits(32),ue=s.readBits(32);P=s.readBool(),G=ue,ie=$*2,z=G/ie}}var Y=1;(F!==1||W!==1)&&(Y=F/W);var D=0,q=0;if(n===0)D=1,q=2-L;else{var se=n===3?1:2,he=n===1?2:1;D=se,q=he*(2-L)}var le=(v+1)*16,de=(2-L)*((x+1)*16);le-=(O+R)*D,de-=(I+B)*q;var ce=Math.ceil(le*Y);return s.destroy(),s=null,{profile_string:t,level_string:e,bit_depth:u,ref_frames:E,chroma_format:i,chroma_format_string:l.getChromaFormatString(i),frame_rate:{fixed:P,fps:z,fps_den:ie,fps_num:G},sar_ratio:{width:F,height:W},codec_size:{width:le,height:de},present_size:{width:ce,height:de}}},l._skipScalingList=function(a,f){for(var s=8,o=8,d=0,t=0;t<f;t++)o!==0&&(d=a.readSEG(),o=(s+d+256)%256),s=o===0?s:o},l.getProfileString=function(a){switch(a){case 66:return"Baseline";case 77:return"Main";case 88:return"Extended";case 100:return"High";case 110:return"High10";case 122:return"High422";case 244:return"High444";default:return"Unknown"}},l.getLevelString=function(a){return(a/10).toFixed(1)},l.getChromaFormatString=function(a){switch(a){case 420:return"4:2:0";case 422:return"4:2:2";case 444:return"4:4:4";default:return"Unknown"}},l}();S.default=c},"./src/flv.js":function(T,S,m){m.r(S);var y=m("./src/utils/polyfill.js"),c=m("./src/core/features.js"),l=m("./src/io/loader.js"),a=m("./src/player/flv-player.js"),f=m("./src/player/native-player.js"),s=m("./src/player/player-events.js"),o=m("./src/player/player-errors.js"),d=m("./src/utils/logging-control.js"),t=m("./src/utils/exception.js");y.default.install();function e(u,_){var p=u;if(p==null||typeof p!="object")throw new t.InvalidArgumentException("MediaDataSource must be an javascript object!");if(!p.hasOwnProperty("type"))throw new t.InvalidArgumentException("MediaDataSource must has type field to indicate video file type!");switch(p.type){case"flv":return new a.default(p,_);default:return new f.default(p,_)}}function n(){return c.default.supportMSEH264Playback()}function i(){return c.default.getFeatureList()}var r={};r.createPlayer=e,r.isSupported=n,r.getFeatureList=i,r.BaseLoader=l.BaseLoader,r.LoaderStatus=l.LoaderStatus,r.LoaderErrors=l.LoaderErrors,r.Events=s.default,r.ErrorTypes=o.ErrorTypes,r.ErrorDetails=o.ErrorDetails,r.FlvPlayer=a.default,r.NativePlayer=f.default,r.LoggingControl=d.default,Object.defineProperty(r,"version",{enumerable:!0,get:function(){return"1.6.2"}}),S.default=r},"./src/index.js":function(T,S,m){T.exports=m("./src/flv.js").default},"./src/io/fetch-stream-loader.js":function(T,S,m){m.r(S);var y=m("./src/utils/browser.js"),c=m("./src/io/loader.js"),l=m("./src/utils/exception.js"),a=function(){var s=function(o,d){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},s(o,d)};return function(o,d){if(typeof d!="function"&&d!==null)throw new TypeError("Class extends value "+String(d)+" is not a constructor or null");s(o,d);function t(){this.constructor=o}o.prototype=d===null?Object.create(d):(t.prototype=d.prototype,new t)}}(),f=function(s){a(o,s);function o(d,t){var e=s.call(this,"fetch-stream-loader")||this;return e.TAG="FetchStreamLoader",e._seekHandler=d,e._config=t,e._needStash=!0,e._requestAbort=!1,e._contentLength=null,e._receivedLength=0,e}return o.isSupported=function(){try{var d=y.default.msedge&&y.default.version.minor>=15048,t=y.default.msedge?d:!0;return self.fetch&&self.ReadableStream&&t}catch{return!1}},o.prototype.destroy=function(){this.isWorking()&&this.abort(),s.prototype.destroy.call(this)},o.prototype.open=function(d,t){var e=this;this._dataSource=d,this._range=t;var n=d.url;this._config.reuseRedirectedURL&&d.redirectedURL!=null&&(n=d.redirectedURL);var i=this._seekHandler.getConfig(n,t),r=new self.Headers;if(typeof i.headers=="object"){var u=i.headers;for(var _ in u)u.hasOwnProperty(_)&&r.append(_,u[_])}var p={method:"GET",headers:r,mode:"cors",cache:"default",referrerPolicy:"no-referrer-when-downgrade"};if(typeof this._config.headers=="object")for(var _ in this._config.headers)r.append(_,this._config.headers[_]);d.cors===!1&&(p.mode="same-origin"),d.withCredentials&&(p.credentials="include"),d.referrerPolicy&&(p.referrerPolicy=d.referrerPolicy),self.AbortController&&(this._abortController=new self.AbortController,p.signal=this._abortController.signal),this._status=c.LoaderStatus.kConnecting,self.fetch(i.url,p).then(function(g){if(e._requestAbort){e._status=c.LoaderStatus.kIdle,g.body.cancel();return}if(g.ok&&g.status>=200&&g.status<=299){if(g.url!==i.url&&e._onURLRedirect){var b=e._seekHandler.removeURLParameters(g.url);e._onURLRedirect(b)}var E=g.headers.get("Content-Length");return E!=null&&(e._contentLength=parseInt(E),e._contentLength!==0&&e._onContentLengthKnown&&e._onContentLengthKnown(e._contentLength)),e._pump.call(e,g.body.getReader())}else if(e._status=c.LoaderStatus.kError,e._onError)e._onError(c.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:g.status,msg:g.statusText});else throw new l.RuntimeException("FetchStreamLoader: Http code invalid, "+g.status+" "+g.statusText)}).catch(function(g){if(!(e._abortController&&e._abortController.signal.aborted))if(e._status=c.LoaderStatus.kError,e._onError)e._onError(c.LoaderErrors.EXCEPTION,{code:-1,msg:g.message});else throw g})},o.prototype.abort=function(){if(this._requestAbort=!0,(this._status!==c.LoaderStatus.kBuffering||!y.default.chrome)&&this._abortController)try{this._abortController.abort()}catch{}},o.prototype._pump=function(d){var t=this;return d.read().then(function(e){if(e.done)if(t._contentLength!==null&&t._receivedLength<t._contentLength){t._status=c.LoaderStatus.kError;var n=c.LoaderErrors.EARLY_EOF,i={code:-1,msg:"Fetch stream meet Early-EOF"};if(t._onError)t._onError(n,i);else throw new l.RuntimeException(i.msg)}else t._status=c.LoaderStatus.kComplete,t._onComplete&&t._onComplete(t._range.from,t._range.from+t._receivedLength-1);else{if(t._abortController&&t._abortController.signal.aborted){t._status=c.LoaderStatus.kComplete;return}else if(t._requestAbort===!0)return t._status=c.LoaderStatus.kComplete,d.cancel();t._status=c.LoaderStatus.kBuffering;var r=e.value.buffer,u=t._range.from+t._receivedLength;t._receivedLength+=r.byteLength,t._onDataArrival&&t._onDataArrival(r,u,t._receivedLength),t._pump(d)}}).catch(function(e){if(t._abortController&&t._abortController.signal.aborted){t._status=c.LoaderStatus.kComplete;return}if(!(e.code===11&&y.default.msedge)){t._status=c.LoaderStatus.kError;var n=0,i=null;if((e.code===19||e.message==="network error")&&(t._contentLength===null||t._contentLength!==null&&t._receivedLength<t._contentLength)?(n=c.LoaderErrors.EARLY_EOF,i={code:e.code,msg:"Fetch stream meet Early-EOF"}):(n=c.LoaderErrors.EXCEPTION,i={code:e.code,msg:e.message}),t._onError)t._onError(n,i);else throw new l.RuntimeException(i.msg)}})},o}(c.BaseLoader);S.default=f},"./src/io/io-controller.js":function(T,S,m){m.r(S);var y=m("./src/utils/logger.js"),c=m("./src/io/speed-sampler.js"),l=m("./src/io/loader.js"),a=m("./src/io/fetch-stream-loader.js"),f=m("./src/io/xhr-moz-chunked-loader.js"),s=m("./src/io/xhr-range-loader.js"),o=m("./src/io/websocket-loader.js"),d=m("./src/io/range-seek-handler.js"),t=m("./src/io/param-seek-handler.js"),e=m("./src/utils/exception.js"),n=function(){function i(r,u,_){this.TAG="IOController",this._config=u,this._extraData=_,this._stashInitialSize=1024*384,u.stashInitialSize!=null&&u.stashInitialSize>0&&(this._stashInitialSize=u.stashInitialSize),this._stashUsed=0,this._stashSize=this._stashInitialSize,this._bufferSize=1024*1024*3,this._stashBuffer=new ArrayBuffer(this._bufferSize),this._stashByteStart=0,this._enableStash=!0,u.enableStashBuffer===!1&&(this._enableStash=!1),this._loader=null,this._loaderClass=null,this._seekHandler=null,this._dataSource=r,this._isWebSocketURL=/wss?:\/\/(.+?)/.test(r.url),this._refTotalLength=r.filesize?r.filesize:null,this._totalLength=this._refTotalLength,this._fullRequestFlag=!1,this._currentRange=null,this._redirectedURL=null,this._speedNormalized=0,this._speedSampler=new c.default,this._speedNormalizeList=[64,128,256,384,512,768,1024,1536,2048,3072,4096],this._isEarlyEofReconnecting=!1,this._paused=!1,this._resumeFrom=0,this._onDataArrival=null,this._onSeeked=null,this._onError=null,this._onComplete=null,this._onRedirect=null,this._onRecoveredEarlyEof=null,this._selectSeekHandler(),this._selectLoader(),this._createLoader()}return i.prototype.destroy=function(){this._loader.isWorking()&&this._loader.abort(),this._loader.destroy(),this._loader=null,this._loaderClass=null,this._dataSource=null,this._stashBuffer=null,this._stashUsed=this._stashSize=this._bufferSize=this._stashByteStart=0,this._currentRange=null,this._speedSampler=null,this._isEarlyEofReconnecting=!1,this._onDataArrival=null,this._onSeeked=null,this._onError=null,this._onComplete=null,this._onRedirect=null,this._onRecoveredEarlyEof=null,this._extraData=null},i.prototype.isWorking=function(){return this._loader&&this._loader.isWorking()&&!this._paused},i.prototype.isPaused=function(){return this._paused},Object.defineProperty(i.prototype,"status",{get:function(){return this._loader.status},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"extraData",{get:function(){return this._extraData},set:function(r){this._extraData=r},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"onDataArrival",{get:function(){return this._onDataArrival},set:function(r){this._onDataArrival=r},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"onSeeked",{get:function(){return this._onSeeked},set:function(r){this._onSeeked=r},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"onError",{get:function(){return this._onError},set:function(r){this._onError=r},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"onComplete",{get:function(){return this._onComplete},set:function(r){this._onComplete=r},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"onRedirect",{get:function(){return this._onRedirect},set:function(r){this._onRedirect=r},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"onRecoveredEarlyEof",{get:function(){return this._onRecoveredEarlyEof},set:function(r){this._onRecoveredEarlyEof=r},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"currentURL",{get:function(){return this._dataSource.url},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"hasRedirect",{get:function(){return this._redirectedURL!=null||this._dataSource.redirectedURL!=null},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"currentRedirectedURL",{get:function(){return this._redirectedURL||this._dataSource.redirectedURL},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"currentSpeed",{get:function(){return this._loaderClass===s.default?this._loader.currentSpeed:this._speedSampler.lastSecondKBps},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"loaderType",{get:function(){return this._loader.type},enumerable:!1,configurable:!0}),i.prototype._selectSeekHandler=function(){var r=this._config;if(r.seekType==="range")this._seekHandler=new d.default(this._config.rangeLoadZeroStart);else if(r.seekType==="param"){var u=r.seekParamStart||"bstart",_=r.seekParamEnd||"bend";this._seekHandler=new t.default(u,_)}else if(r.seekType==="custom"){if(typeof r.customSeekHandler!="function")throw new e.InvalidArgumentException("Custom seekType specified in config but invalid customSeekHandler!");this._seekHandler=new r.customSeekHandler}else throw new e.InvalidArgumentException("Invalid seekType in config: "+r.seekType)},i.prototype._selectLoader=function(){if(this._config.customLoader!=null)this._loaderClass=this._config.customLoader;else if(this._isWebSocketURL)this._loaderClass=o.default;else if(a.default.isSupported())this._loaderClass=a.default;else if(f.default.isSupported())this._loaderClass=f.default;else if(s.default.isSupported())this._loaderClass=s.default;else throw new e.RuntimeException("Your browser doesn't support xhr with arraybuffer responseType!")},i.prototype._createLoader=function(){this._loader=new this._loaderClass(this._seekHandler,this._config),this._loader.needStashBuffer===!1&&(this._enableStash=!1),this._loader.onContentLengthKnown=this._onContentLengthKnown.bind(this),this._loader.onURLRedirect=this._onURLRedirect.bind(this),this._loader.onDataArrival=this._onLoaderChunkArrival.bind(this),this._loader.onComplete=this._onLoaderComplete.bind(this),this._loader.onError=this._onLoaderError.bind(this)},i.prototype.open=function(r){this._currentRange={from:0,to:-1},r&&(this._currentRange.from=r),this._speedSampler.reset(),r||(this._fullRequestFlag=!0),this._loader.open(this._dataSource,Object.assign({},this._currentRange))},i.prototype.abort=function(){this._loader.abort(),this._paused&&(this._paused=!1,this._resumeFrom=0)},i.prototype.pause=function(){this.isWorking()&&(this._loader.abort(),this._stashUsed!==0?(this._resumeFrom=this._stashByteStart,this._currentRange.to=this._stashByteStart-1):this._resumeFrom=this._currentRange.to+1,this._stashUsed=0,this._stashByteStart=0,this._paused=!0)},i.prototype.resume=function(){if(this._paused){this._paused=!1;var r=this._resumeFrom;this._resumeFrom=0,this._internalSeek(r,!0)}},i.prototype.seek=function(r){this._paused=!1,this._stashUsed=0,this._stashByteStart=0,this._internalSeek(r,!0)},i.prototype._internalSeek=function(r,u){this._loader.isWorking()&&this._loader.abort(),this._flushStashBuffer(u),this._loader.destroy(),this._loader=null;var _={from:r,to:-1};this._currentRange={from:_.from,to:-1},this._speedSampler.reset(),this._stashSize=this._stashInitialSize,this._createLoader(),this._loader.open(this._dataSource,_),this._onSeeked&&this._onSeeked()},i.prototype.updateUrl=function(r){if(!r||typeof r!="string"||r.length===0)throw new e.InvalidArgumentException("Url must be a non-empty string!");this._dataSource.url=r},i.prototype._expandBuffer=function(r){for(var u=this._stashSize;u+1024*1024*1<r;)u*=2;if(u+=1024*1024*1,u!==this._bufferSize){var _=new ArrayBuffer(u);if(this._stashUsed>0){var p=new Uint8Array(this._stashBuffer,0,this._stashUsed),g=new Uint8Array(_,0,u);g.set(p,0)}this._stashBuffer=_,this._bufferSize=u}},i.prototype._normalizeSpeed=function(r){var u=this._speedNormalizeList,_=u.length-1,p=0,g=0,b=_;if(r<u[0])return u[0];for(;g<=b;){if(p=g+Math.floor((b-g)/2),p===_||r>=u[p]&&r<u[p+1])return u[p];u[p]<r?g=p+1:b=p-1}},i.prototype._adjustStashSize=function(r){var u=0;this._config.isLive||r<512?u=r:r>=512&&r<=1024?u=Math.floor(r*1.5):u=r*2,u>8192&&(u=8192);var _=u*1024+1024*1024*1;this._bufferSize<_&&this._expandBuffer(_),this._stashSize=u*1024},i.prototype._dispatchChunks=function(r,u){return this._currentRange.to=u+r.byteLength-1,this._onDataArrival(r,u)},i.prototype._onURLRedirect=function(r){this._redirectedURL=r,this._onRedirect&&this._onRedirect(r)},i.prototype._onContentLengthKnown=function(r){r&&this._fullRequestFlag&&(this._totalLength=r,this._fullRequestFlag=!1)},i.prototype._onLoaderChunkArrival=function(r,u,_){if(!this._onDataArrival)throw new e.IllegalStateException("IOController: No existing consumer (onDataArrival) callback!");if(!this._paused){this._isEarlyEofReconnecting&&(this._isEarlyEofReconnecting=!1,this._onRecoveredEarlyEof&&this._onRecoveredEarlyEof()),this._speedSampler.addBytes(r.byteLength);var p=this._speedSampler.lastSecondKBps;if(p!==0){var g=this._normalizeSpeed(p);this._speedNormalized!==g&&(this._speedNormalized=g,this._adjustStashSize(g))}if(this._enableStash)if(this._stashUsed===0&&this._stashByteStart===0&&(this._stashByteStart=u),this._stashUsed+r.byteLength<=this._stashSize){var v=new Uint8Array(this._stashBuffer,0,this._stashSize);v.set(new Uint8Array(r),this._stashUsed),this._stashUsed+=r.byteLength}else{var v=new Uint8Array(this._stashBuffer,0,this._bufferSize);if(this._stashUsed>0){var L=this._stashBuffer.slice(0,this._stashUsed),b=this._dispatchChunks(L,this._stashByteStart);if(b<L.byteLength){if(b>0){var x=new Uint8Array(L,b);v.set(x,0),this._stashUsed=x.byteLength,this._stashByteStart+=b}}else this._stashUsed=0,this._stashByteStart+=b;this._stashUsed+r.byteLength>this._bufferSize&&(this._expandBuffer(this._stashUsed+r.byteLength),v=new Uint8Array(this._stashBuffer,0,this._bufferSize)),v.set(new Uint8Array(r),this._stashUsed),this._stashUsed+=r.byteLength}else{var b=this._dispatchChunks(r,u);if(b<r.byteLength){var E=r.byteLength-b;E>this._bufferSize&&(this._expandBuffer(E),v=new Uint8Array(this._stashBuffer,0,this._bufferSize)),v.set(new Uint8Array(r,b),0),this._stashUsed+=E,this._stashByteStart=u+b}}}else if(this._stashUsed===0){var b=this._dispatchChunks(r,u);if(b<r.byteLength){var E=r.byteLength-b;E>this._bufferSize&&this._expandBuffer(E);var v=new Uint8Array(this._stashBuffer,0,this._bufferSize);v.set(new Uint8Array(r,b),0),this._stashUsed+=E,this._stashByteStart=u+b}}else{this._stashUsed+r.byteLength>this._bufferSize&&this._expandBuffer(this._stashUsed+r.byteLength);var v=new Uint8Array(this._stashBuffer,0,this._bufferSize);v.set(new Uint8Array(r),this._stashUsed),this._stashUsed+=r.byteLength;var b=this._dispatchChunks(this._stashBuffer.slice(0,this._stashUsed),this._stashByteStart);if(b<this._stashUsed&&b>0){var x=new Uint8Array(this._stashBuffer,b);v.set(x,0)}this._stashUsed-=b,this._stashByteStart+=b}}},i.prototype._flushStashBuffer=function(r){if(this._stashUsed>0){var u=this._stashBuffer.slice(0,this._stashUsed),_=this._dispatchChunks(u,this._stashByteStart),p=u.byteLength-_;if(_<u.byteLength)if(r)y.default.w(this.TAG,p+" bytes unconsumed data remain when flush buffer, dropped");else{if(_>0){var g=new Uint8Array(this._stashBuffer,0,this._bufferSize),b=new Uint8Array(u,_);g.set(b,0),this._stashUsed=b.byteLength,this._stashByteStart+=_}return 0}return this._stashUsed=0,this._stashByteStart=0,p}return 0},i.prototype._onLoaderComplete=function(r,u){this._flushStashBuffer(!0),this._onComplete&&this._onComplete(this._extraData)},i.prototype._onLoaderError=function(r,u){switch(y.default.e(this.TAG,"Loader error, code = "+u.code+", msg = "+u.msg),this._flushStashBuffer(!1),this._isEarlyEofReconnecting&&(this._isEarlyEofReconnecting=!1,r=l.LoaderErrors.UNRECOVERABLE_EARLY_EOF),r){case l.LoaderErrors.EARLY_EOF:{if(!this._config.isLive&&this._totalLength){var _=this._currentRange.to+1;_<this._totalLength&&(y.default.w(this.TAG,"Connection lost, trying reconnect..."),this._isEarlyEofReconnecting=!0,this._internalSeek(_,!1));return}r=l.LoaderErrors.UNRECOVERABLE_EARLY_EOF;break}case l.LoaderErrors.UNRECOVERABLE_EARLY_EOF:case l.LoaderErrors.CONNECTING_TIMEOUT:case l.LoaderErrors.HTTP_STATUS_CODE_INVALID:case l.LoaderErrors.EXCEPTION:break}if(this._onError)this._onError(r,u);else throw new e.RuntimeException("IOException: "+u.msg)},i}();S.default=n},"./src/io/loader.js":function(T,S,m){m.r(S),m.d(S,{LoaderStatus:function(){return c},LoaderErrors:function(){return l},BaseLoader:function(){return a}});var y=m("./src/utils/exception.js"),c={kIdle:0,kConnecting:1,kBuffering:2,kError:3,kComplete:4},l={OK:"OK",EXCEPTION:"Exception",HTTP_STATUS_CODE_INVALID:"HttpStatusCodeInvalid",CONNECTING_TIMEOUT:"ConnectingTimeout",EARLY_EOF:"EarlyEof",UNRECOVERABLE_EARLY_EOF:"UnrecoverableEarlyEof"},a=function(){function f(s){this._type=s||"undefined",this._status=c.kIdle,this._needStash=!1,this._onContentLengthKnown=null,this._onURLRedirect=null,this._onDataArrival=null,this._onError=null,this._onComplete=null}return f.prototype.destroy=function(){this._status=c.kIdle,this._onContentLengthKnown=null,this._onURLRedirect=null,this._onDataArrival=null,this._onError=null,this._onComplete=null},f.prototype.isWorking=function(){return this._status===c.kConnecting||this._status===c.kBuffering},Object.defineProperty(f.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"status",{get:function(){return this._status},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"needStashBuffer",{get:function(){return this._needStash},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"onContentLengthKnown",{get:function(){return this._onContentLengthKnown},set:function(s){this._onContentLengthKnown=s},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"onURLRedirect",{get:function(){return this._onURLRedirect},set:function(s){this._onURLRedirect=s},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"onDataArrival",{get:function(){return this._onDataArrival},set:function(s){this._onDataArrival=s},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"onError",{get:function(){return this._onError},set:function(s){this._onError=s},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"onComplete",{get:function(){return this._onComplete},set:function(s){this._onComplete=s},enumerable:!1,configurable:!0}),f.prototype.open=function(s,o){throw new y.NotImplementedException("Unimplemented abstract function!")},f.prototype.abort=function(){throw new y.NotImplementedException("Unimplemented abstract function!")},f}()},"./src/io/param-seek-handler.js":function(T,S,m){m.r(S);var y=function(){function c(l,a){this._startName=l,this._endName=a}return c.prototype.getConfig=function(l,a){var f=l;if(a.from!==0||a.to!==-1){var s=!0;f.indexOf("?")===-1&&(f+="?",s=!1),s&&(f+="&"),f+=this._startName+"="+a.from.toString(),a.to!==-1&&(f+="&"+this._endName+"="+a.to.toString())}return{url:f,headers:{}}},c.prototype.removeURLParameters=function(l){var a=l.split("?")[0],f=void 0,s=l.indexOf("?");s!==-1&&(f=l.substring(s+1));var o="";if(f!=null&&f.length>0)for(var d=f.split("&"),t=0;t<d.length;t++){var e=d[t].split("="),n=t>0;e[0]!==this._startName&&e[0]!==this._endName&&(n&&(o+="&"),o+=d[t])}return o.length===0?a:a+"?"+o},c}();S.default=y},"./src/io/range-seek-handler.js":function(T,S,m){m.r(S);var y=function(){function c(l){this._zeroStart=l||!1}return c.prototype.getConfig=function(l,a){var f={};if(a.from!==0||a.to!==-1){var s=void 0;a.to!==-1?s="bytes="+a.from.toString()+"-"+a.to.toString():s="bytes="+a.from.toString()+"-",f.Range=s}else this._zeroStart&&(f.Range="bytes=0-");return{url:l,headers:f}},c.prototype.removeURLParameters=function(l){return l},c}();S.default=y},"./src/io/speed-sampler.js":function(T,S,m){m.r(S);var y=function(){function c(){this._firstCheckpoint=0,this._lastCheckpoint=0,this._intervalBytes=0,this._totalBytes=0,this._lastSecondBytes=0,self.performance&&self.performance.now?this._now=self.performance.now.bind(self.performance):this._now=Date.now}return c.prototype.reset=function(){this._firstCheckpoint=this._lastCheckpoint=0,this._totalBytes=this._intervalBytes=0,this._lastSecondBytes=0},c.prototype.addBytes=function(l){this._firstCheckpoint===0?(this._firstCheckpoint=this._now(),this._lastCheckpoint=this._firstCheckpoint,this._intervalBytes+=l,this._totalBytes+=l):this._now()-this._lastCheckpoint<1e3?(this._intervalBytes+=l,this._totalBytes+=l):(this._lastSecondBytes=this._intervalBytes,this._intervalBytes=l,this._totalBytes+=l,this._lastCheckpoint=this._now())},Object.defineProperty(c.prototype,"currentKBps",{get:function(){this.addBytes(0);var l=(this._now()-this._lastCheckpoint)/1e3;return l==0&&(l=1),this._intervalBytes/l/1024},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"lastSecondKBps",{get:function(){return this.addBytes(0),this._lastSecondBytes!==0?this._lastSecondBytes/1024:this._now()-this._lastCheckpoint>=500?this.currentKBps:0},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"averageKBps",{get:function(){var l=(this._now()-this._firstCheckpoint)/1e3;return this._totalBytes/l/1024},enumerable:!1,configurable:!0}),c}();S.default=y},"./src/io/websocket-loader.js":function(T,S,m){m.r(S);var y=m("./src/io/loader.js"),c=m("./src/utils/exception.js"),l=function(){var f=function(s,o){return f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,t){d.__proto__=t}||function(d,t){for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&(d[e]=t[e])},f(s,o)};return function(s,o){if(typeof o!="function"&&o!==null)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");f(s,o);function d(){this.constructor=s}s.prototype=o===null?Object.create(o):(d.prototype=o.prototype,new d)}}(),a=function(f){l(s,f);function s(){var o=f.call(this,"websocket-loader")||this;return o.TAG="WebSocketLoader",o._needStash=!0,o._ws=null,o._requestAbort=!1,o._receivedLength=0,o}return s.isSupported=function(){try{return typeof self.WebSocket<"u"}catch{return!1}},s.prototype.destroy=function(){this._ws&&this.abort(),f.prototype.destroy.call(this)},s.prototype.open=function(o){try{var d=this._ws=new self.WebSocket(o.url);d.binaryType="arraybuffer",d.onopen=this._onWebSocketOpen.bind(this),d.onclose=this._onWebSocketClose.bind(this),d.onmessage=this._onWebSocketMessage.bind(this),d.onerror=this._onWebSocketError.bind(this),this._status=y.LoaderStatus.kConnecting}catch(e){this._status=y.LoaderStatus.kError;var t={code:e.code,msg:e.message};if(this._onError)this._onError(y.LoaderErrors.EXCEPTION,t);else throw new c.RuntimeException(t.msg)}},s.prototype.abort=function(){var o=this._ws;o&&(o.readyState===0||o.readyState===1)&&(this._requestAbort=!0,o.close()),this._ws=null,this._status=y.LoaderStatus.kComplete},s.prototype._onWebSocketOpen=function(o){this._status=y.LoaderStatus.kBuffering},s.prototype._onWebSocketClose=function(o){if(this._requestAbort===!0){this._requestAbort=!1;return}this._status=y.LoaderStatus.kComplete,this._onComplete&&this._onComplete(0,this._receivedLength-1)},s.prototype._onWebSocketMessage=function(o){var d=this;if(o.data instanceof ArrayBuffer)this._dispatchArrayBuffer(o.data);else if(o.data instanceof Blob){var t=new FileReader;t.onload=function(){d._dispatchArrayBuffer(t.result)},t.readAsArrayBuffer(o.data)}else{this._status=y.LoaderStatus.kError;var e={code:-1,msg:"Unsupported WebSocket message type: "+o.data.constructor.name};if(this._onError)this._onError(y.LoaderErrors.EXCEPTION,e);else throw new c.RuntimeException(e.msg)}},s.prototype._dispatchArrayBuffer=function(o){var d=o,t=this._receivedLength;this._receivedLength+=d.byteLength,this._onDataArrival&&this._onDataArrival(d,t,this._receivedLength)},s.prototype._onWebSocketError=function(o){this._status=y.LoaderStatus.kError;var d={code:o.code,msg:o.message};if(this._onError)this._onError(y.LoaderErrors.EXCEPTION,d);else throw new c.RuntimeException(d.msg)},s}(y.BaseLoader);S.default=a},"./src/io/xhr-moz-chunked-loader.js":function(T,S,m){m.r(S);var y=m("./src/utils/logger.js"),c=m("./src/io/loader.js"),l=m("./src/utils/exception.js"),a=function(){var s=function(o,d){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},s(o,d)};return function(o,d){if(typeof d!="function"&&d!==null)throw new TypeError("Class extends value "+String(d)+" is not a constructor or null");s(o,d);function t(){this.constructor=o}o.prototype=d===null?Object.create(d):(t.prototype=d.prototype,new t)}}(),f=function(s){a(o,s);function o(d,t){var e=s.call(this,"xhr-moz-chunked-loader")||this;return e.TAG="MozChunkedLoader",e._seekHandler=d,e._config=t,e._needStash=!0,e._xhr=null,e._requestAbort=!1,e._contentLength=null,e._receivedLength=0,e}return o.isSupported=function(){try{var d=new XMLHttpRequest;return d.open("GET","https://example.com",!0),d.responseType="moz-chunked-arraybuffer",d.responseType==="moz-chunked-arraybuffer"}catch(t){return y.default.w("MozChunkedLoader",t.message),!1}},o.prototype.destroy=function(){this.isWorking()&&this.abort(),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onloadend=null,this._xhr.onerror=null,this._xhr=null),s.prototype.destroy.call(this)},o.prototype.open=function(d,t){this._dataSource=d,this._range=t;var e=d.url;this._config.reuseRedirectedURL&&d.redirectedURL!=null&&(e=d.redirectedURL);var n=this._seekHandler.getConfig(e,t);this._requestURL=n.url;var i=this._xhr=new XMLHttpRequest;if(i.open("GET",n.url,!0),i.responseType="moz-chunked-arraybuffer",i.onreadystatechange=this._onReadyStateChange.bind(this),i.onprogress=this._onProgress.bind(this),i.onloadend=this._onLoadEnd.bind(this),i.onerror=this._onXhrError.bind(this),d.withCredentials&&(i.withCredentials=!0),typeof n.headers=="object"){var r=n.headers;for(var u in r)r.hasOwnProperty(u)&&i.setRequestHeader(u,r[u])}if(typeof this._config.headers=="object"){var r=this._config.headers;for(var u in r)r.hasOwnProperty(u)&&i.setRequestHeader(u,r[u])}this._status=c.LoaderStatus.kConnecting,i.send()},o.prototype.abort=function(){this._requestAbort=!0,this._xhr&&this._xhr.abort(),this._status=c.LoaderStatus.kComplete},o.prototype._onReadyStateChange=function(d){var t=d.target;if(t.readyState===2){if(t.responseURL!=null&&t.responseURL!==this._requestURL&&this._onURLRedirect){var e=this._seekHandler.removeURLParameters(t.responseURL);this._onURLRedirect(e)}if(t.status!==0&&(t.status<200||t.status>299))if(this._status=c.LoaderStatus.kError,this._onError)this._onError(c.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:t.status,msg:t.statusText});else throw new l.RuntimeException("MozChunkedLoader: Http code invalid, "+t.status+" "+t.statusText);else this._status=c.LoaderStatus.kBuffering}},o.prototype._onProgress=function(d){if(this._status!==c.LoaderStatus.kError){this._contentLength===null&&d.total!==null&&d.total!==0&&(this._contentLength=d.total,this._onContentLengthKnown&&this._onContentLengthKnown(this._contentLength));var t=d.target.response,e=this._range.from+this._receivedLength;this._receivedLength+=t.byteLength,this._onDataArrival&&this._onDataArrival(t,e,this._receivedLength)}},o.prototype._onLoadEnd=function(d){if(this._requestAbort===!0){this._requestAbort=!1;return}else if(this._status===c.LoaderStatus.kError)return;this._status=c.LoaderStatus.kComplete,this._onComplete&&this._onComplete(this._range.from,this._range.from+this._receivedLength-1)},o.prototype._onXhrError=function(d){this._status=c.LoaderStatus.kError;var t=0,e=null;if(this._contentLength&&d.loaded<this._contentLength?(t=c.LoaderErrors.EARLY_EOF,e={code:-1,msg:"Moz-Chunked stream meet Early-Eof"}):(t=c.LoaderErrors.EXCEPTION,e={code:-1,msg:d.constructor.name+" "+d.type}),this._onError)this._onError(t,e);else throw new l.RuntimeException(e.msg)},o}(c.BaseLoader);S.default=f},"./src/io/xhr-range-loader.js":function(T,S,m){m.r(S);var y=m("./src/utils/logger.js"),c=m("./src/io/speed-sampler.js"),l=m("./src/io/loader.js"),a=m("./src/utils/exception.js"),f=function(){var o=function(d,t){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])},o(d,t)};return function(d,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");o(d,t);function e(){this.constructor=d}d.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),s=function(o){f(d,o);function d(t,e){var n=o.call(this,"xhr-range-loader")||this;return n.TAG="RangeLoader",n._seekHandler=t,n._config=e,n._needStash=!1,n._chunkSizeKBList=[128,256,384,512,768,1024,1536,2048,3072,4096,5120,6144,7168,8192],n._currentChunkSizeKB=384,n._currentSpeedNormalized=0,n._zeroSpeedChunkCount=0,n._xhr=null,n._speedSampler=new c.default,n._requestAbort=!1,n._waitForTotalLength=!1,n._totalLengthReceived=!1,n._currentRequestURL=null,n._currentRedirectedURL=null,n._currentRequestRange=null,n._totalLength=null,n._contentLength=null,n._receivedLength=0,n._lastTimeLoaded=0,n}return d.isSupported=function(){try{var t=new XMLHttpRequest;return t.open("GET","https://example.com",!0),t.responseType="arraybuffer",t.responseType==="arraybuffer"}catch(e){return y.default.w("RangeLoader",e.message),!1}},d.prototype.destroy=function(){this.isWorking()&&this.abort(),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr=null),o.prototype.destroy.call(this)},Object.defineProperty(d.prototype,"currentSpeed",{get:function(){return this._speedSampler.lastSecondKBps},enumerable:!1,configurable:!0}),d.prototype.open=function(t,e){this._dataSource=t,this._range=e,this._status=l.LoaderStatus.kConnecting;var n=!1;this._dataSource.filesize!=null&&this._dataSource.filesize!==0&&(n=!0,this._totalLength=this._dataSource.filesize),!this._totalLengthReceived&&!n?(this._waitForTotalLength=!0,this._internalOpen(this._dataSource,{from:0,to:-1})):this._openSubRange()},d.prototype._openSubRange=function(){var t=this._currentChunkSizeKB*1024,e=this._range.from+this._receivedLength,n=e+t;this._contentLength!=null&&n-this._range.from>=this._contentLength&&(n=this._range.from+this._contentLength-1),this._currentRequestRange={from:e,to:n},this._internalOpen(this._dataSource,this._currentRequestRange)},d.prototype._internalOpen=function(t,e){this._lastTimeLoaded=0;var n=t.url;this._config.reuseRedirectedURL&&(this._currentRedirectedURL!=null?n=this._currentRedirectedURL:t.redirectedURL!=null&&(n=t.redirectedURL));var i=this._seekHandler.getConfig(n,e);this._currentRequestURL=i.url;var r=this._xhr=new XMLHttpRequest;if(r.open("GET",i.url,!0),r.responseType="arraybuffer",r.onreadystatechange=this._onReadyStateChange.bind(this),r.onprogress=this._onProgress.bind(this),r.onload=this._onLoad.bind(this),r.onerror=this._onXhrError.bind(this),t.withCredentials&&(r.withCredentials=!0),typeof i.headers=="object"){var u=i.headers;for(var _ in u)u.hasOwnProperty(_)&&r.setRequestHeader(_,u[_])}if(typeof this._config.headers=="object"){var u=this._config.headers;for(var _ in u)u.hasOwnProperty(_)&&r.setRequestHeader(_,u[_])}r.send()},d.prototype.abort=function(){this._requestAbort=!0,this._internalAbort(),this._status=l.LoaderStatus.kComplete},d.prototype._internalAbort=function(){this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr.abort(),this._xhr=null)},d.prototype._onReadyStateChange=function(t){var e=t.target;if(e.readyState===2){if(e.responseURL!=null){var n=this._seekHandler.removeURLParameters(e.responseURL);e.responseURL!==this._currentRequestURL&&n!==this._currentRedirectedURL&&(this._currentRedirectedURL=n,this._onURLRedirect&&this._onURLRedirect(n))}if(e.status>=200&&e.status<=299){if(this._waitForTotalLength)return;this._status=l.LoaderStatus.kBuffering}else if(this._status=l.LoaderStatus.kError,this._onError)this._onError(l.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:e.status,msg:e.statusText});else throw new a.RuntimeException("RangeLoader: Http code invalid, "+e.status+" "+e.statusText)}},d.prototype._onProgress=function(t){if(this._status!==l.LoaderStatus.kError){if(this._contentLength===null){var e=!1;if(this._waitForTotalLength){this._waitForTotalLength=!1,this._totalLengthReceived=!0,e=!0;var n=t.total;this._internalAbort(),n!=null&n!==0&&(this._totalLength=n)}if(this._range.to===-1?this._contentLength=this._totalLength-this._range.from:this._contentLength=this._range.to-this._range.from+1,e){this._openSubRange();return}this._onContentLengthKnown&&this._onContentLengthKnown(this._contentLength)}var i=t.loaded-this._lastTimeLoaded;this._lastTimeLoaded=t.loaded,this._speedSampler.addBytes(i)}},d.prototype._normalizeSpeed=function(t){var e=this._chunkSizeKBList,n=e.length-1,i=0,r=0,u=n;if(t<e[0])return e[0];for(;r<=u;){if(i=r+Math.floor((u-r)/2),i===n||t>=e[i]&&t<e[i+1])return e[i];e[i]<t?r=i+1:u=i-1}},d.prototype._onLoad=function(t){if(this._status!==l.LoaderStatus.kError){if(this._waitForTotalLength){this._waitForTotalLength=!1;return}this._lastTimeLoaded=0;var e=this._speedSampler.lastSecondKBps;if(e===0&&(this._zeroSpeedChunkCount++,this._zeroSpeedChunkCount>=3&&(e=this._speedSampler.currentKBps)),e!==0){var n=this._normalizeSpeed(e);this._currentSpeedNormalized!==n&&(this._currentSpeedNormalized=n,this._currentChunkSizeKB=n)}var i=t.target.response,r=this._range.from+this._receivedLength;this._receivedLength+=i.byteLength;var u=!1;this._contentLength!=null&&this._receivedLength<this._contentLength?this._openSubRange():u=!0,this._onDataArrival&&this._onDataArrival(i,r,this._receivedLength),u&&(this._status=l.LoaderStatus.kComplete,this._onComplete&&this._onComplete(this._range.from,this._range.from+this._receivedLength-1))}},d.prototype._onXhrError=function(t){this._status=l.LoaderStatus.kError;var e=0,n=null;if(this._contentLength&&this._receivedLength>0&&this._receivedLength<this._contentLength?(e=l.LoaderErrors.EARLY_EOF,n={code:-1,msg:"RangeLoader meet Early-Eof"}):(e=l.LoaderErrors.EXCEPTION,n={code:-1,msg:t.constructor.name+" "+t.type}),this._onError)this._onError(e,n);else throw new a.RuntimeException(n.msg)},d}(l.BaseLoader);S.default=s},"./src/player/flv-player.js":function(T,S,m){m.r(S);var y=m("./node_modules/events/events.js"),c=m.n(y),l=m("./src/utils/logger.js"),a=m("./src/utils/browser.js"),f=m("./src/player/player-events.js"),s=m("./src/core/transmuxer.js"),o=m("./src/core/transmuxing-events.js"),d=m("./src/core/mse-controller.js"),t=m("./src/core/mse-events.js"),e=m("./src/player/player-errors.js"),n=m("./src/config.js"),i=m("./src/utils/exception.js"),r=function(){function u(_,p){if(this.TAG="FlvPlayer",this._type="FlvPlayer",this._emitter=new(c()),this._config=(0,n.createDefaultConfig)(),typeof p=="object"&&Object.assign(this._config,p),_.type.toLowerCase()!=="flv")throw new i.InvalidArgumentException("FlvPlayer requires an flv MediaDataSource input!");_.isLive===!0&&(this._config.isLive=!0),this.e={onvLoadedMetadata:this._onvLoadedMetadata.bind(this),onvSeeking:this._onvSeeking.bind(this),onvCanPlay:this._onvCanPlay.bind(this),onvStalled:this._onvStalled.bind(this),onvProgress:this._onvProgress.bind(this)},self.performance&&self.performance.now?this._now=self.performance.now.bind(self.performance):this._now=Date.now,this._pendingSeekTime=null,this._requestSetTime=!1,this._seekpointRecord=null,this._progressChecker=null,this._mediaDataSource=_,this._mediaElement=null,this._msectl=null,this._transmuxer=null,this._mseSourceOpened=!1,this._hasPendingLoad=!1,this._receivedCanPlay=!1,this._mediaInfo=null,this._statisticsInfo=null;var g=a.default.chrome&&(a.default.version.major<50||a.default.version.major===50&&a.default.version.build<2661);this._alwaysSeekKeyframe=!!(g||a.default.msedge||a.default.msie),this._alwaysSeekKeyframe&&(this._config.accurateSeek=!1)}return u.prototype.destroy=function(){this._progressChecker!=null&&(window.clearInterval(this._progressChecker),this._progressChecker=null),this._transmuxer&&this.unload(),this._mediaElement&&this.detachMediaElement(),this.e=null,this._mediaDataSource=null,this._emitter.removeAllListeners(),this._emitter=null},u.prototype.on=function(_,p){var g=this;_===f.default.MEDIA_INFO?this._mediaInfo!=null&&Promise.resolve().then(function(){g._emitter.emit(f.default.MEDIA_INFO,g.mediaInfo)}):_===f.default.STATISTICS_INFO&&this._statisticsInfo!=null&&Promise.resolve().then(function(){g._emitter.emit(f.default.STATISTICS_INFO,g.statisticsInfo)}),this._emitter.addListener(_,p)},u.prototype.off=function(_,p){this._emitter.removeListener(_,p)},u.prototype.attachMediaElement=function(_){var p=this;if(this._mediaElement=_,_.addEventListener("loadedmetadata",this.e.onvLoadedMetadata),_.addEventListener("seeking",this.e.onvSeeking),_.addEventListener("canplay",this.e.onvCanPlay),_.addEventListener("stalled",this.e.onvStalled),_.addEventListener("progress",this.e.onvProgress),this._msectl=new d.default(this._config),this._msectl.on(t.default.UPDATE_END,this._onmseUpdateEnd.bind(this)),this._msectl.on(t.default.BUFFER_FULL,this._onmseBufferFull.bind(this)),this._msectl.on(t.default.SOURCE_OPEN,function(){p._mseSourceOpened=!0,p._hasPendingLoad&&(p._hasPendingLoad=!1,p.load())}),this._msectl.on(t.default.ERROR,function(g){p._emitter.emit(f.default.ERROR,e.ErrorTypes.MEDIA_ERROR,e.ErrorDetails.MEDIA_MSE_ERROR,g)}),this._msectl.attachMediaElement(_),this._pendingSeekTime!=null)try{_.currentTime=this._pendingSeekTime,this._pendingSeekTime=null}catch{}},u.prototype.detachMediaElement=function(){this._mediaElement&&(this._msectl.detachMediaElement(),this._mediaElement.removeEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._mediaElement.removeEventListener("seeking",this.e.onvSeeking),this._mediaElement.removeEventListener("canplay",this.e.onvCanPlay),this._mediaElement.removeEventListener("stalled",this.e.onvStalled),this._mediaElement.removeEventListener("progress",this.e.onvProgress),this._mediaElement=null),this._msectl&&(this._msectl.destroy(),this._msectl=null)},u.prototype.load=function(){var _=this;if(!this._mediaElement)throw new i.IllegalStateException("HTMLMediaElement must be attached before load()!");if(this._transmuxer)throw new i.IllegalStateException("FlvPlayer.load() has been called, please call unload() first!");if(!this._hasPendingLoad){if(this._config.deferLoadAfterSourceOpen&&this._mseSourceOpened===!1){this._hasPendingLoad=!0;return}this._mediaElement.readyState>0&&(this._requestSetTime=!0,this._mediaElement.currentTime=0),this._transmuxer=new s.default(this._mediaDataSource,this._config),this._transmuxer.on(o.default.INIT_SEGMENT,function(p,g){_._msectl.appendInitSegment(g)}),this._transmuxer.on(o.default.MEDIA_SEGMENT,function(p,g){if(_._msectl.appendMediaSegment(g),_._config.lazyLoad&&!_._config.isLive){var b=_._mediaElement.currentTime;g.info.endDts>=(b+_._config.lazyLoadMaxDuration)*1e3&&_._progressChecker==null&&(l.default.v(_.TAG,"Maximum buffering duration exceeded, suspend transmuxing task"),_._suspendTransmuxer())}}),this._transmuxer.on(o.default.LOADING_COMPLETE,function(){_._msectl.endOfStream(),_._emitter.emit(f.default.LOADING_COMPLETE)}),this._transmuxer.on(o.default.RECOVERED_EARLY_EOF,function(){_._emitter.emit(f.default.RECOVERED_EARLY_EOF)}),this._transmuxer.on(o.default.IO_ERROR,function(p,g){_._emitter.emit(f.default.ERROR,e.ErrorTypes.NETWORK_ERROR,p,g)}),this._transmuxer.on(o.default.DEMUX_ERROR,function(p,g){_._emitter.emit(f.default.ERROR,e.ErrorTypes.MEDIA_ERROR,p,{code:-1,msg:g})}),this._transmuxer.on(o.default.MEDIA_INFO,function(p){_._mediaInfo=p,_._emitter.emit(f.default.MEDIA_INFO,Object.assign({},p))}),this._transmuxer.on(o.default.METADATA_ARRIVED,function(p){_._emitter.emit(f.default.METADATA_ARRIVED,p)}),this._transmuxer.on(o.default.SCRIPTDATA_ARRIVED,function(p){_._emitter.emit(f.default.SCRIPTDATA_ARRIVED,p)}),this._transmuxer.on(o.default.STATISTICS_INFO,function(p){_._statisticsInfo=_._fillStatisticsInfo(p),_._emitter.emit(f.default.STATISTICS_INFO,Object.assign({},_._statisticsInfo))}),this._transmuxer.on(o.default.RECOMMEND_SEEKPOINT,function(p){_._mediaElement&&!_._config.accurateSeek&&(_._requestSetTime=!0,_._mediaElement.currentTime=p/1e3)}),this._transmuxer.open()}},u.prototype.unload=function(){this._mediaElement&&this._mediaElement.pause(),this._msectl&&this._msectl.seek(0),this._transmuxer&&(this._transmuxer.close(),this._transmuxer.destroy(),this._transmuxer=null)},u.prototype.play=function(){return this._mediaElement.play()},u.prototype.pause=function(){this._mediaElement.pause()},Object.defineProperty(u.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"buffered",{get:function(){return this._mediaElement.buffered},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"duration",{get:function(){return this._mediaElement.duration},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"volume",{get:function(){return this._mediaElement.volume},set:function(_){this._mediaElement.volume=_},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"muted",{get:function(){return this._mediaElement.muted},set:function(_){this._mediaElement.muted=_},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"currentTime",{get:function(){return this._mediaElement?this._mediaElement.currentTime:0},set:function(_){this._mediaElement?this._internalSeek(_):this._pendingSeekTime=_},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"mediaInfo",{get:function(){return Object.assign({},this._mediaInfo)},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"statisticsInfo",{get:function(){return this._statisticsInfo==null&&(this._statisticsInfo={}),this._statisticsInfo=this._fillStatisticsInfo(this._statisticsInfo),Object.assign({},this._statisticsInfo)},enumerable:!1,configurable:!0}),u.prototype._fillStatisticsInfo=function(_){if(_.playerType=this._type,!(this._mediaElement instanceof HTMLVideoElement))return _;var p=!0,g=0,b=0;if(this._mediaElement.getVideoPlaybackQuality){var E=this._mediaElement.getVideoPlaybackQuality();g=E.totalVideoFrames,b=E.droppedVideoFrames}else this._mediaElement.webkitDecodedFrameCount!=null?(g=this._mediaElement.webkitDecodedFrameCount,b=this._mediaElement.webkitDroppedFrameCount):p=!1;return p&&(_.decodedFrames=g,_.droppedFrames=b),_},u.prototype._onmseUpdateEnd=function(){if(!(!this._config.lazyLoad||this._config.isLive)){for(var _=this._mediaElement.buffered,p=this._mediaElement.currentTime,g=0,b=0;b<_.length;b++){var E=_.start(b),v=_.end(b);if(E<=p&&p<v){g=v;break}}g>=p+this._config.lazyLoadMaxDuration&&this._progressChecker==null&&(l.default.v(this.TAG,"Maximum buffering duration exceeded, suspend transmuxing task"),this._suspendTransmuxer())}},u.prototype._onmseBufferFull=function(){l.default.v(this.TAG,"MSE SourceBuffer is full, suspend transmuxing task"),this._progressChecker==null&&this._suspendTransmuxer()},u.prototype._suspendTransmuxer=function(){this._transmuxer&&(this._transmuxer.pause(),this._progressChecker==null&&(this._progressChecker=window.setInterval(this._checkProgressAndResume.bind(this),1e3)))},u.prototype._checkProgressAndResume=function(){for(var _=this._mediaElement.currentTime,p=this._mediaElement.buffered,g=!1,b=0;b<p.length;b++){var E=p.start(b),v=p.end(b);if(_>=E&&_<v){_>=v-this._config.lazyLoadRecoverDuration&&(g=!0);break}}g&&(window.clearInterval(this._progressChecker),this._progressChecker=null,g&&(l.default.v(this.TAG,"Continue loading from paused position"),this._transmuxer.resume()))},u.prototype._isTimepointBuffered=function(_){for(var p=this._mediaElement.buffered,g=0;g<p.length;g++){var b=p.start(g),E=p.end(g);if(_>=b&&_<E)return!0}return!1},u.prototype._internalSeek=function(_){var p=this._isTimepointBuffered(_),g=!1,b=0;if(_<1&&this._mediaElement.buffered.length>0){var E=this._mediaElement.buffered.start(0);(E<1&&_<E||a.default.safari)&&(g=!0,b=a.default.safari?.1:E)}if(g)this._requestSetTime=!0,this._mediaElement.currentTime=b;else if(p){if(!this._alwaysSeekKeyframe)this._requestSetTime=!0,this._mediaElement.currentTime=_;else{var v=this._msectl.getNearestKeyframe(Math.floor(_*1e3));this._requestSetTime=!0,v!=null?this._mediaElement.currentTime=v.dts/1e3:this._mediaElement.currentTime=_}this._progressChecker!=null&&this._checkProgressAndResume()}else this._progressChecker!=null&&(window.clearInterval(this._progressChecker),this._progressChecker=null),this._msectl.seek(_),this._transmuxer.seek(Math.floor(_*1e3)),this._config.accurateSeek&&(this._requestSetTime=!0,this._mediaElement.currentTime=_)},u.prototype._checkAndApplyUnbufferedSeekpoint=function(){if(this._seekpointRecord)if(this._seekpointRecord.recordTime<=this._now()-100){var _=this._mediaElement.currentTime;this._seekpointRecord=null,this._isTimepointBuffered(_)||(this._progressChecker!=null&&(window.clearTimeout(this._progressChecker),this._progressChecker=null),this._msectl.seek(_),this._transmuxer.seek(Math.floor(_*1e3)),this._config.accurateSeek&&(this._requestSetTime=!0,this._mediaElement.currentTime=_))}else window.setTimeout(this._checkAndApplyUnbufferedSeekpoint.bind(this),50)},u.prototype._checkAndResumeStuckPlayback=function(_){var p=this._mediaElement;if(_||!this._receivedCanPlay||p.readyState<2){var g=p.buffered;g.length>0&&p.currentTime<g.start(0)&&(l.default.w(this.TAG,"Playback seems stuck at "+p.currentTime+", seek to "+g.start(0)),this._requestSetTime=!0,this._mediaElement.currentTime=g.start(0),this._mediaElement.removeEventListener("progress",this.e.onvProgress))}else this._mediaElement.removeEventListener("progress",this.e.onvProgress)},u.prototype._onvLoadedMetadata=function(_){this._pendingSeekTime!=null&&(this._mediaElement.currentTime=this._pendingSeekTime,this._pendingSeekTime=null)},u.prototype._onvSeeking=function(_){var p=this._mediaElement.currentTime,g=this._mediaElement.buffered;if(this._requestSetTime){this._requestSetTime=!1;return}if(p<1&&g.length>0){var b=g.start(0);if(b<1&&p<b||a.default.safari){this._requestSetTime=!0,this._mediaElement.currentTime=a.default.safari?.1:b;return}}if(this._isTimepointBuffered(p)){if(this._alwaysSeekKeyframe){var E=this._msectl.getNearestKeyframe(Math.floor(p*1e3));E!=null&&(this._requestSetTime=!0,this._mediaElement.currentTime=E.dts/1e3)}this._progressChecker!=null&&this._checkProgressAndResume();return}this._seekpointRecord={seekPoint:p,recordTime:this._now()},window.setTimeout(this._checkAndApplyUnbufferedSeekpoint.bind(this),50)},u.prototype._onvCanPlay=function(_){this._receivedCanPlay=!0,this._mediaElement.removeEventListener("canplay",this.e.onvCanPlay)},u.prototype._onvStalled=function(_){this._checkAndResumeStuckPlayback(!0)},u.prototype._onvProgress=function(_){this._checkAndResumeStuckPlayback()},u}();S.default=r},"./src/player/native-player.js":function(T,S,m){m.r(S);var y=m("./node_modules/events/events.js"),c=m.n(y),l=m("./src/player/player-events.js"),a=m("./src/config.js"),f=m("./src/utils/exception.js"),s=function(){function o(d,t){if(this.TAG="NativePlayer",this._type="NativePlayer",this._emitter=new(c()),this._config=(0,a.createDefaultConfig)(),typeof t=="object"&&Object.assign(this._config,t),d.type.toLowerCase()==="flv")throw new f.InvalidArgumentException("NativePlayer does't support flv MediaDataSource input!");if(d.hasOwnProperty("segments"))throw new f.InvalidArgumentException("NativePlayer("+d.type+") doesn't support multipart playback!");this.e={onvLoadedMetadata:this._onvLoadedMetadata.bind(this)},this._pendingSeekTime=null,this._statisticsReporter=null,this._mediaDataSource=d,this._mediaElement=null}return o.prototype.destroy=function(){this._mediaElement&&(this.unload(),this.detachMediaElement()),this.e=null,this._mediaDataSource=null,this._emitter.removeAllListeners(),this._emitter=null},o.prototype.on=function(d,t){var e=this;d===l.default.MEDIA_INFO?this._mediaElement!=null&&this._mediaElement.readyState!==0&&Promise.resolve().then(function(){e._emitter.emit(l.default.MEDIA_INFO,e.mediaInfo)}):d===l.default.STATISTICS_INFO&&this._mediaElement!=null&&this._mediaElement.readyState!==0&&Promise.resolve().then(function(){e._emitter.emit(l.default.STATISTICS_INFO,e.statisticsInfo)}),this._emitter.addListener(d,t)},o.prototype.off=function(d,t){this._emitter.removeListener(d,t)},o.prototype.attachMediaElement=function(d){if(this._mediaElement=d,d.addEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._pendingSeekTime!=null)try{d.currentTime=this._pendingSeekTime,this._pendingSeekTime=null}catch{}},o.prototype.detachMediaElement=function(){this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src"),this._mediaElement.removeEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._mediaElement=null),this._statisticsReporter!=null&&(window.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},o.prototype.load=function(){if(!this._mediaElement)throw new f.IllegalStateException("HTMLMediaElement must be attached before load()!");this._mediaElement.src=this._mediaDataSource.url,this._mediaElement.readyState>0&&(this._mediaElement.currentTime=0),this._mediaElement.preload="auto",this._mediaElement.load(),this._statisticsReporter=window.setInterval(this._reportStatisticsInfo.bind(this),this._config.statisticsInfoReportInterval)},o.prototype.unload=function(){this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src")),this._statisticsReporter!=null&&(window.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},o.prototype.play=function(){return this._mediaElement.play()},o.prototype.pause=function(){this._mediaElement.pause()},Object.defineProperty(o.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"buffered",{get:function(){return this._mediaElement.buffered},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"duration",{get:function(){return this._mediaElement.duration},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"volume",{get:function(){return this._mediaElement.volume},set:function(d){this._mediaElement.volume=d},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"muted",{get:function(){return this._mediaElement.muted},set:function(d){this._mediaElement.muted=d},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"currentTime",{get:function(){return this._mediaElement?this._mediaElement.currentTime:0},set:function(d){this._mediaElement?this._mediaElement.currentTime=d:this._pendingSeekTime=d},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"mediaInfo",{get:function(){var d=this._mediaElement instanceof HTMLAudioElement?"audio/":"video/",t={mimeType:d+this._mediaDataSource.type};return this._mediaElement&&(t.duration=Math.floor(this._mediaElement.duration*1e3),this._mediaElement instanceof HTMLVideoElement&&(t.width=this._mediaElement.videoWidth,t.height=this._mediaElement.videoHeight)),t},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"statisticsInfo",{get:function(){var d={playerType:this._type,url:this._mediaDataSource.url};if(!(this._mediaElement instanceof HTMLVideoElement))return d;var t=!0,e=0,n=0;if(this._mediaElement.getVideoPlaybackQuality){var i=this._mediaElement.getVideoPlaybackQuality();e=i.totalVideoFrames,n=i.droppedVideoFrames}else this._mediaElement.webkitDecodedFrameCount!=null?(e=this._mediaElement.webkitDecodedFrameCount,n=this._mediaElement.webkitDroppedFrameCount):t=!1;return t&&(d.decodedFrames=e,d.droppedFrames=n),d},enumerable:!1,configurable:!0}),o.prototype._onvLoadedMetadata=function(d){this._pendingSeekTime!=null&&(this._mediaElement.currentTime=this._pendingSeekTime,this._pendingSeekTime=null),this._emitter.emit(l.default.MEDIA_INFO,this.mediaInfo)},o.prototype._reportStatisticsInfo=function(){this._emitter.emit(l.default.STATISTICS_INFO,this.statisticsInfo)},o}();S.default=s},"./src/player/player-errors.js":function(T,S,m){m.r(S),m.d(S,{ErrorTypes:function(){return l},ErrorDetails:function(){return a}});var y=m("./src/io/loader.js"),c=m("./src/demux/demux-errors.js"),l={NETWORK_ERROR:"NetworkError",MEDIA_ERROR:"MediaError",OTHER_ERROR:"OtherError"},a={NETWORK_EXCEPTION:y.LoaderErrors.EXCEPTION,NETWORK_STATUS_CODE_INVALID:y.LoaderErrors.HTTP_STATUS_CODE_INVALID,NETWORK_TIMEOUT:y.LoaderErrors.CONNECTING_TIMEOUT,NETWORK_UNRECOVERABLE_EARLY_EOF:y.LoaderErrors.UNRECOVERABLE_EARLY_EOF,MEDIA_MSE_ERROR:"MediaMSEError",MEDIA_FORMAT_ERROR:c.default.FORMAT_ERROR,MEDIA_FORMAT_UNSUPPORTED:c.default.FORMAT_UNSUPPORTED,MEDIA_CODEC_UNSUPPORTED:c.default.CODEC_UNSUPPORTED}},"./src/player/player-events.js":function(T,S,m){m.r(S);var y={ERROR:"error",LOADING_COMPLETE:"loading_complete",RECOVERED_EARLY_EOF:"recovered_early_eof",MEDIA_INFO:"media_info",METADATA_ARRIVED:"metadata_arrived",SCRIPTDATA_ARRIVED:"scriptdata_arrived",STATISTICS_INFO:"statistics_info"};S.default=y},"./src/remux/aac-silent.js":function(T,S,m){m.r(S);var y=function(){function c(){}return c.getSilentFrame=function(l,a){if(l==="mp4a.40.2"){if(a===1)return new Uint8Array([0,200,0,128,35,128]);if(a===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(a===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(a===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(a===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(a===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(a===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(a===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(a===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null},c}();S.default=y},"./src/remux/mp4-generator.js":function(T,S,m){m.r(S);var y=function(){function c(){}return c.init=function(){c.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[],".mp3":[]};for(var l in c.types)c.types.hasOwnProperty(l)&&(c.types[l]=[l.charCodeAt(0),l.charCodeAt(1),l.charCodeAt(2),l.charCodeAt(3)]);var a=c.constants={};a.FTYP=new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49]),a.STSD_PREFIX=new Uint8Array([0,0,0,0,0,0,0,1]),a.STTS=new Uint8Array([0,0,0,0,0,0,0,0]),a.STSC=a.STCO=a.STTS,a.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),a.HDLR_VIDEO=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),a.HDLR_AUDIO=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),a.DREF=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),a.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),a.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])},c.box=function(l){for(var a=8,f=null,s=Array.prototype.slice.call(arguments,1),o=s.length,d=0;d<o;d++)a+=s[d].byteLength;f=new Uint8Array(a),f[0]=a>>>24&255,f[1]=a>>>16&255,f[2]=a>>>8&255,f[3]=a&255,f.set(l,4);for(var t=8,d=0;d<o;d++)f.set(s[d],t),t+=s[d].byteLength;return f},c.generateInitSegment=function(l){var a=c.box(c.types.ftyp,c.constants.FTYP),f=c.moov(l),s=new Uint8Array(a.byteLength+f.byteLength);return s.set(a,0),s.set(f,a.byteLength),s},c.moov=function(l){var a=c.mvhd(l.timescale,l.duration),f=c.trak(l),s=c.mvex(l);return c.box(c.types.moov,a,f,s)},c.mvhd=function(l,a){return c.box(c.types.mvhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,l>>>24&255,l>>>16&255,l>>>8&255,l&255,a>>>24&255,a>>>16&255,a>>>8&255,a&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]))},c.trak=function(l){return c.box(c.types.trak,c.tkhd(l),c.mdia(l))},c.tkhd=function(l){var a=l.id,f=l.duration,s=l.presentWidth,o=l.presentHeight;return c.box(c.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,a>>>24&255,a>>>16&255,a>>>8&255,a&255,0,0,0,0,f>>>24&255,f>>>16&255,f>>>8&255,f&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,s>>>8&255,s&255,0,0,o>>>8&255,o&255,0,0]))},c.mdia=function(l){return c.box(c.types.mdia,c.mdhd(l),c.hdlr(l),c.minf(l))},c.mdhd=function(l){var a=l.timescale,f=l.duration;return c.box(c.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,a>>>24&255,a>>>16&255,a>>>8&255,a&255,f>>>24&255,f>>>16&255,f>>>8&255,f&255,85,196,0,0]))},c.hdlr=function(l){var a=null;return l.type==="audio"?a=c.constants.HDLR_AUDIO:a=c.constants.HDLR_VIDEO,c.box(c.types.hdlr,a)},c.minf=function(l){var a=null;return l.type==="audio"?a=c.box(c.types.smhd,c.constants.SMHD):a=c.box(c.types.vmhd,c.constants.VMHD),c.box(c.types.minf,a,c.dinf(),c.stbl(l))},c.dinf=function(){var l=c.box(c.types.dinf,c.box(c.types.dref,c.constants.DREF));return l},c.stbl=function(l){var a=c.box(c.types.stbl,c.stsd(l),c.box(c.types.stts,c.constants.STTS),c.box(c.types.stsc,c.constants.STSC),c.box(c.types.stsz,c.constants.STSZ),c.box(c.types.stco,c.constants.STCO));return a},c.stsd=function(l){return l.type==="audio"?l.codec==="mp3"?c.box(c.types.stsd,c.constants.STSD_PREFIX,c.mp3(l)):c.box(c.types.stsd,c.constants.STSD_PREFIX,c.mp4a(l)):c.box(c.types.stsd,c.constants.STSD_PREFIX,c.avc1(l))},c.mp3=function(l){var a=l.channelCount,f=l.audioSampleRate,s=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,a,0,16,0,0,0,0,f>>>8&255,f&255,0,0]);return c.box(c.types[".mp3"],s)},c.mp4a=function(l){var a=l.channelCount,f=l.audioSampleRate,s=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,a,0,16,0,0,0,0,f>>>8&255,f&255,0,0]);return c.box(c.types.mp4a,s,c.esds(l))},c.esds=function(l){var a=l.config||[],f=a.length,s=new Uint8Array([0,0,0,0,3,23+f,0,1,0,4,15+f,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([f]).concat(a).concat([6,1,2]));return c.box(c.types.esds,s)},c.avc1=function(l){var a=l.avcc,f=l.codecWidth,s=l.codecHeight,o=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,f>>>8&255,f&255,s>>>8&255,s&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,10,120,113,113,47,102,108,118,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]);return c.box(c.types.avc1,o,c.box(c.types.avcC,a))},c.mvex=function(l){return c.box(c.types.mvex,c.trex(l))},c.trex=function(l){var a=l.id,f=new Uint8Array([0,0,0,0,a>>>24&255,a>>>16&255,a>>>8&255,a&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return c.box(c.types.trex,f)},c.moof=function(l,a){return c.box(c.types.moof,c.mfhd(l.sequenceNumber),c.traf(l,a))},c.mfhd=function(l){var a=new Uint8Array([0,0,0,0,l>>>24&255,l>>>16&255,l>>>8&255,l&255]);return c.box(c.types.mfhd,a)},c.traf=function(l,a){var f=l.id,s=c.box(c.types.tfhd,new Uint8Array([0,0,0,0,f>>>24&255,f>>>16&255,f>>>8&255,f&255])),o=c.box(c.types.tfdt,new Uint8Array([0,0,0,0,a>>>24&255,a>>>16&255,a>>>8&255,a&255])),d=c.sdtp(l),t=c.trun(l,d.byteLength+16+16+8+16+8+8);return c.box(c.types.traf,s,o,t,d)},c.sdtp=function(l){for(var a=l.samples||[],f=a.length,s=new Uint8Array(4+f),o=0;o<f;o++){var d=a[o].flags;s[o+4]=d.isLeading<<6|d.dependsOn<<4|d.isDependedOn<<2|d.hasRedundancy}return c.box(c.types.sdtp,s)},c.trun=function(l,a){var f=l.samples||[],s=f.length,o=12+16*s,d=new Uint8Array(o);a+=8+o,d.set([0,0,15,1,s>>>24&255,s>>>16&255,s>>>8&255,s&255,a>>>24&255,a>>>16&255,a>>>8&255,a&255],0);for(var t=0;t<s;t++){var e=f[t].duration,n=f[t].size,i=f[t].flags,r=f[t].cts;d.set([e>>>24&255,e>>>16&255,e>>>8&255,e&255,n>>>24&255,n>>>16&255,n>>>8&255,n&255,i.isLeading<<2|i.dependsOn,i.isDependedOn<<6|i.hasRedundancy<<4|i.isNonSync,0,0,r>>>24&255,r>>>16&255,r>>>8&255,r&255],12+16*t)}return c.box(c.types.trun,d)},c.mdat=function(l){return c.box(c.types.mdat,l)},c}();y.init(),S.default=y},"./src/remux/mp4-remuxer.js":function(T,S,m){m.r(S);var y=m("./src/utils/logger.js"),c=m("./src/remux/mp4-generator.js"),l=m("./src/remux/aac-silent.js"),a=m("./src/utils/browser.js"),f=m("./src/core/media-segment-info.js"),s=m("./src/utils/exception.js"),o=function(){function d(t){this.TAG="MP4Remuxer",this._config=t,this._isLive=t.isLive===!0,this._dtsBase=-1,this._dtsBaseInited=!1,this._audioDtsBase=1/0,this._videoDtsBase=1/0,this._audioNextDts=void 0,this._videoNextDts=void 0,this._audioStashedLastSample=null,this._videoStashedLastSample=null,this._audioMeta=null,this._videoMeta=null,this._audioSegmentInfoList=new f.MediaSegmentInfoList("audio"),this._videoSegmentInfoList=new f.MediaSegmentInfoList("video"),this._onInitSegment=null,this._onMediaSegment=null,this._forceFirstIDR=!!(a.default.chrome&&(a.default.version.major<50||a.default.version.major===50&&a.default.version.build<2661)),this._fillSilentAfterSeek=a.default.msedge||a.default.msie,this._mp3UseMpegAudio=!a.default.firefox,this._fillAudioTimestampGap=this._config.fixAudioTimestampGap}return d.prototype.destroy=function(){this._dtsBase=-1,this._dtsBaseInited=!1,this._audioMeta=null,this._videoMeta=null,this._audioSegmentInfoList.clear(),this._audioSegmentInfoList=null,this._videoSegmentInfoList.clear(),this._videoSegmentInfoList=null,this._onInitSegment=null,this._onMediaSegment=null},d.prototype.bindDataSource=function(t){return t.onDataAvailable=this.remux.bind(this),t.onTrackMetadata=this._onTrackMetadataReceived.bind(this),this},Object.defineProperty(d.prototype,"onInitSegment",{get:function(){return this._onInitSegment},set:function(t){this._onInitSegment=t},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"onMediaSegment",{get:function(){return this._onMediaSegment},set:function(t){this._onMediaSegment=t},enumerable:!1,configurable:!0}),d.prototype.insertDiscontinuity=function(){this._audioNextDts=this._videoNextDts=void 0},d.prototype.seek=function(t){this._audioStashedLastSample=null,this._videoStashedLastSample=null,this._videoSegmentInfoList.clear(),this._audioSegmentInfoList.clear()},d.prototype.remux=function(t,e){if(!this._onMediaSegment)throw new s.IllegalStateException("MP4Remuxer: onMediaSegment callback must be specificed!");this._dtsBaseInited||this._calculateDtsBase(t,e),this._remuxVideo(e),this._remuxAudio(t)},d.prototype._onTrackMetadataReceived=function(t,e){var n=null,i="mp4",r=e.codec;if(t==="audio")this._audioMeta=e,e.codec==="mp3"&&this._mp3UseMpegAudio?(i="mpeg",r="",n=new Uint8Array):n=c.default.generateInitSegment(e);else if(t==="video")this._videoMeta=e,n=c.default.generateInitSegment(e);else return;if(!this._onInitSegment)throw new s.IllegalStateException("MP4Remuxer: onInitSegment callback must be specified!");this._onInitSegment(t,{type:t,data:n.buffer,codec:r,container:t+"/"+i,mediaDuration:e.duration})},d.prototype._calculateDtsBase=function(t,e){this._dtsBaseInited||(t.samples&&t.samples.length&&(this._audioDtsBase=t.samples[0].dts),e.samples&&e.samples.length&&(this._videoDtsBase=e.samples[0].dts),this._dtsBase=Math.min(this._audioDtsBase,this._videoDtsBase),this._dtsBaseInited=!0)},d.prototype.flushStashedSamples=function(){var t=this._videoStashedLastSample,e=this._audioStashedLastSample,n={type:"video",id:1,sequenceNumber:0,samples:[],length:0};t!=null&&(n.samples.push(t),n.length=t.length);var i={type:"audio",id:2,sequenceNumber:0,samples:[],length:0};e!=null&&(i.samples.push(e),i.length=e.length),this._videoStashedLastSample=null,this._audioStashedLastSample=null,this._remuxVideo(n,!0),this._remuxAudio(i,!0)},d.prototype._remuxAudio=function(t,e){if(this._audioMeta!=null){var n=t,i=n.samples,r=void 0,u=-1,_=-1,p=this._audioMeta.refSampleDuration,g=this._audioMeta.codec==="mp3"&&this._mp3UseMpegAudio,b=this._dtsBaseInited&&this._audioNextDts===void 0,E=!1;if(!(!i||i.length===0)&&!(i.length===1&&!e)){var v=0,x=null,L=0;g?(v=0,L=n.length):(v=8,L=8+n.length);var O=null;if(i.length>1&&(O=i.pop(),L-=O.length),this._audioStashedLastSample!=null){var R=this._audioStashedLastSample;this._audioStashedLastSample=null,i.unshift(R),L+=R.length}O!=null&&(this._audioStashedLastSample=O);var I=i[0].dts-this._dtsBase;if(this._audioNextDts)r=I-this._audioNextDts;else if(this._audioSegmentInfoList.isEmpty())r=0,this._fillSilentAfterSeek&&!this._videoSegmentInfoList.isEmpty()&&this._audioMeta.originalCodec!=="mp3"&&(E=!0);else{var B=this._audioSegmentInfoList.getLastSampleBefore(I);if(B!=null){var U=I-(B.originalDts+B.duration);U<=3&&(U=0);var F=B.dts+B.duration+U;r=I-F}else r=0}if(E){var W=I-r,z=this._videoSegmentInfoList.getLastSegmentBefore(I);if(z!=null&&z.beginDts<W){var P=l.default.getSilentFrame(this._audioMeta.originalCodec,this._audioMeta.channelCount);if(P){var G=z.beginDts,ie=W-z.beginDts;y.default.v(this.TAG,"InsertPrefixSilentAudio: dts: "+G+", duration: "+ie),i.unshift({unit:P,dts:G,pts:G}),L+=P.byteLength}}else E=!1}for(var V=[],H=0;H<i.length;H++){var R=i[H],ee=R.unit,Q=R.dts-this._dtsBase,G=Q,$=!1,ue=null,Y=0;if(!(Q<-.001)){if(this._audioMeta.codec!=="mp3"){var D=Q,q=3;if(this._audioNextDts&&(D=this._audioNextDts),r=Q-D,r<=-q*p){y.default.w(this.TAG,"Dropping 1 audio frame (originalDts: "+Q+" ms ,curRefDts: "+D+" ms)  due to dtsCorrection: "+r+" ms overlap.");continue}else if(r>=q*p&&this._fillAudioTimestampGap&&!a.default.safari){$=!0;var se=Math.floor(r/p);y.default.w(this.TAG,`Large audio timestamp gap detected, may cause AV sync to drift. Silent frames will be generated to avoid unsync.
`+("originalDts: "+Q+" ms, curRefDts: "+D+" ms, ")+("dtsCorrection: "+Math.round(r)+" ms, generate: "+se+" frames")),G=Math.floor(D),Y=Math.floor(D+p)-G;var P=l.default.getSilentFrame(this._audioMeta.originalCodec,this._audioMeta.channelCount);P==null&&(y.default.w(this.TAG,"Unable to generate silent frame for "+(this._audioMeta.originalCodec+" with "+this._audioMeta.channelCount+" channels, repeat last frame")),P=ee),ue=[];for(var he=0;he<se;he++){D=D+p;var le=Math.floor(D),de=Math.floor(D+p)-le,ce={dts:le,pts:le,cts:0,unit:P,size:P.byteLength,duration:de,originalDts:Q,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}};ue.push(ce),L+=ce.size}this._audioNextDts=D+p}else G=Math.floor(D),Y=Math.floor(D+p)-G,this._audioNextDts=D+p}else{if(G=Q-r,H!==i.length-1){var _e=i[H+1].dts-this._dtsBase-r;Y=_e-G}else if(O!=null){var _e=O.dts-this._dtsBase-r;Y=_e-G}else V.length>=1?Y=V[V.length-1].duration:Y=Math.floor(p);this._audioNextDts=G+Y}u===-1&&(u=G),V.push({dts:G,pts:G,cts:0,unit:R.unit,size:R.unit.byteLength,duration:Y,originalDts:Q,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}}),$&&V.push.apply(V,ue)}}if(V.length===0){n.samples=[],n.length=0;return}g?x=new Uint8Array(L):(x=new Uint8Array(L),x[0]=L>>>24&255,x[1]=L>>>16&255,x[2]=L>>>8&255,x[3]=L&255,x.set(c.default.types.mdat,4));for(var H=0;H<V.length;H++){var ee=V[H].unit;x.set(ee,v),v+=ee.byteLength}var ae=V[V.length-1];_=ae.dts+ae.duration;var te=new f.MediaSegmentInfo;te.beginDts=u,te.endDts=_,te.beginPts=u,te.endPts=_,te.originalBeginDts=V[0].originalDts,te.originalEndDts=ae.originalDts+ae.duration,te.firstSample=new f.SampleInfo(V[0].dts,V[0].pts,V[0].duration,V[0].originalDts,!1),te.lastSample=new f.SampleInfo(ae.dts,ae.pts,ae.duration,ae.originalDts,!1),this._isLive||this._audioSegmentInfoList.append(te),n.samples=V,n.sequenceNumber++;var me=null;g?me=new Uint8Array:me=c.default.moof(n,u),n.samples=[],n.length=0;var ve={type:"audio",data:this._mergeBoxes(me,x).buffer,sampleCount:V.length,info:te};g&&b&&(ve.timestampOffset=u),this._onMediaSegment("audio",ve)}}},d.prototype._remuxVideo=function(t,e){if(this._videoMeta!=null){var n=t,i=n.samples,r=void 0,u=-1,_=-1,p=-1,g=-1;if(!(!i||i.length===0)&&!(i.length===1&&!e)){var b=8,E=null,v=8+t.length,x=null;if(i.length>1&&(x=i.pop(),v-=x.length),this._videoStashedLastSample!=null){var L=this._videoStashedLastSample;this._videoStashedLastSample=null,i.unshift(L),v+=L.length}x!=null&&(this._videoStashedLastSample=x);var O=i[0].dts-this._dtsBase;if(this._videoNextDts)r=O-this._videoNextDts;else if(this._videoSegmentInfoList.isEmpty())r=0;else{var R=this._videoSegmentInfoList.getLastSampleBefore(O);if(R!=null){var I=O-(R.originalDts+R.duration);I<=3&&(I=0);var B=R.dts+R.duration+I;r=O-B}else r=0}for(var U=new f.MediaSegmentInfo,F=[],W=0;W<i.length;W++){var L=i[W],z=L.dts-this._dtsBase,P=L.isKeyframe,G=z-r,ie=L.cts,V=G+ie;u===-1&&(u=G,p=V);var H=0;if(W!==i.length-1){var ee=i[W+1].dts-this._dtsBase-r;H=ee-G}else if(x!=null){var ee=x.dts-this._dtsBase-r;H=ee-G}else F.length>=1?H=F[F.length-1].duration:H=Math.floor(this._videoMeta.refSampleDuration);if(P){var Q=new f.SampleInfo(G,V,H,L.dts,!0);Q.fileposition=L.fileposition,U.appendSyncPoint(Q)}F.push({dts:G,pts:V,cts:ie,units:L.units,size:L.length,isKeyframe:P,duration:H,originalDts:z,flags:{isLeading:0,dependsOn:P?2:1,isDependedOn:P?1:0,hasRedundancy:0,isNonSync:P?0:1}})}E=new Uint8Array(v),E[0]=v>>>24&255,E[1]=v>>>16&255,E[2]=v>>>8&255,E[3]=v&255,E.set(c.default.types.mdat,4);for(var W=0;W<F.length;W++)for(var $=F[W].units;$.length;){var ue=$.shift(),Y=ue.data;E.set(Y,b),b+=Y.byteLength}var D=F[F.length-1];if(_=D.dts+D.duration,g=D.pts+D.duration,this._videoNextDts=_,U.beginDts=u,U.endDts=_,U.beginPts=p,U.endPts=g,U.originalBeginDts=F[0].originalDts,U.originalEndDts=D.originalDts+D.duration,U.firstSample=new f.SampleInfo(F[0].dts,F[0].pts,F[0].duration,F[0].originalDts,F[0].isKeyframe),U.lastSample=new f.SampleInfo(D.dts,D.pts,D.duration,D.originalDts,D.isKeyframe),this._isLive||this._videoSegmentInfoList.append(U),n.samples=F,n.sequenceNumber++,this._forceFirstIDR){var q=F[0].flags;q.dependsOn=2,q.isNonSync=0}var se=c.default.moof(n,u);n.samples=[],n.length=0,this._onMediaSegment("video",{type:"video",data:this._mergeBoxes(se,E).buffer,sampleCount:F.length,info:U})}}},d.prototype._mergeBoxes=function(t,e){var n=new Uint8Array(t.byteLength+e.byteLength);return n.set(t,0),n.set(e,t.byteLength),n},d}();S.default=o},"./src/utils/browser.js":function(T,S,m){m.r(S);var y={};function c(){var l=self.navigator.userAgent.toLowerCase(),a=/(edge)\/([\w.]+)/.exec(l)||/(opr)[\/]([\w.]+)/.exec(l)||/(chrome)[ \/]([\w.]+)/.exec(l)||/(iemobile)[\/]([\w.]+)/.exec(l)||/(version)(applewebkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(l)||/(webkit)[ \/]([\w.]+).*(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(l)||/(webkit)[ \/]([\w.]+)/.exec(l)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(l)||/(msie) ([\w.]+)/.exec(l)||l.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(l)||l.indexOf("compatible")<0&&/(firefox)[ \/]([\w.]+)/.exec(l)||[],f=/(ipad)/.exec(l)||/(ipod)/.exec(l)||/(windows phone)/.exec(l)||/(iphone)/.exec(l)||/(kindle)/.exec(l)||/(android)/.exec(l)||/(windows)/.exec(l)||/(mac)/.exec(l)||/(linux)/.exec(l)||/(cros)/.exec(l)||[],s={browser:a[5]||a[3]||a[1]||"",version:a[2]||a[4]||"0",majorVersion:a[4]||a[2]||"0",platform:f[0]||""},o={};if(s.browser){o[s.browser]=!0;var d=s.majorVersion.split(".");o.version={major:parseInt(s.majorVersion,10),string:s.version},d.length>1&&(o.version.minor=parseInt(d[1],10)),d.length>2&&(o.version.build=parseInt(d[2],10))}if(s.platform&&(o[s.platform]=!0),(o.chrome||o.opr||o.safari)&&(o.webkit=!0),o.rv||o.iemobile){o.rv&&delete o.rv;var t="msie";s.browser=t,o[t]=!0}if(o.edge){delete o.edge;var e="msedge";s.browser=e,o[e]=!0}if(o.opr){var n="opera";s.browser=n,o[n]=!0}if(o.safari&&o.android){var i="android";s.browser=i,o[i]=!0}o.name=s.browser,o.platform=s.platform;for(var r in y)y.hasOwnProperty(r)&&delete y[r];Object.assign(y,o)}c(),S.default=y},"./src/utils/exception.js":function(T,S,m){m.r(S),m.d(S,{RuntimeException:function(){return c},IllegalStateException:function(){return l},InvalidArgumentException:function(){return a},NotImplementedException:function(){return f}});var y=function(){var s=function(o,d){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},s(o,d)};return function(o,d){if(typeof d!="function"&&d!==null)throw new TypeError("Class extends value "+String(d)+" is not a constructor or null");s(o,d);function t(){this.constructor=o}o.prototype=d===null?Object.create(d):(t.prototype=d.prototype,new t)}}(),c=function(){function s(o){this._message=o}return Object.defineProperty(s.prototype,"name",{get:function(){return"RuntimeException"},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"message",{get:function(){return this._message},enumerable:!1,configurable:!0}),s.prototype.toString=function(){return this.name+": "+this.message},s}(),l=function(s){y(o,s);function o(d){return s.call(this,d)||this}return Object.defineProperty(o.prototype,"name",{get:function(){return"IllegalStateException"},enumerable:!1,configurable:!0}),o}(c),a=function(s){y(o,s);function o(d){return s.call(this,d)||this}return Object.defineProperty(o.prototype,"name",{get:function(){return"InvalidArgumentException"},enumerable:!1,configurable:!0}),o}(c),f=function(s){y(o,s);function o(d){return s.call(this,d)||this}return Object.defineProperty(o.prototype,"name",{get:function(){return"NotImplementedException"},enumerable:!1,configurable:!0}),o}(c)},"./src/utils/logger.js":function(T,S,m){m.r(S);var y=m("./node_modules/events/events.js"),c=m.n(y),l=function(){function a(){}return a.e=function(f,s){(!f||a.FORCE_GLOBAL_TAG)&&(f=a.GLOBAL_TAG);var o="["+f+"] > "+s;a.ENABLE_CALLBACK&&a.emitter.emit("log","error",o),a.ENABLE_ERROR&&(console.error?console.error(o):console.warn?console.warn(o):console.log(o))},a.i=function(f,s){(!f||a.FORCE_GLOBAL_TAG)&&(f=a.GLOBAL_TAG);var o="["+f+"] > "+s;a.ENABLE_CALLBACK&&a.emitter.emit("log","info",o),a.ENABLE_INFO&&(console.info?console.info(o):console.log(o))},a.w=function(f,s){(!f||a.FORCE_GLOBAL_TAG)&&(f=a.GLOBAL_TAG);var o="["+f+"] > "+s;a.ENABLE_CALLBACK&&a.emitter.emit("log","warn",o),a.ENABLE_WARN&&(console.warn?console.warn(o):console.log(o))},a.d=function(f,s){(!f||a.FORCE_GLOBAL_TAG)&&(f=a.GLOBAL_TAG);var o="["+f+"] > "+s;a.ENABLE_CALLBACK&&a.emitter.emit("log","debug",o),a.ENABLE_DEBUG&&(console.debug?console.debug(o):console.log(o))},a.v=function(f,s){(!f||a.FORCE_GLOBAL_TAG)&&(f=a.GLOBAL_TAG);var o="["+f+"] > "+s;a.ENABLE_CALLBACK&&a.emitter.emit("log","verbose",o),a.ENABLE_VERBOSE&&console.log(o)},a}();l.GLOBAL_TAG="flv.js",l.FORCE_GLOBAL_TAG=!1,l.ENABLE_ERROR=!0,l.ENABLE_INFO=!0,l.ENABLE_WARN=!0,l.ENABLE_DEBUG=!0,l.ENABLE_VERBOSE=!0,l.ENABLE_CALLBACK=!1,l.emitter=new(c()),S.default=l},"./src/utils/logging-control.js":function(T,S,m){m.r(S);var y=m("./node_modules/events/events.js"),c=m.n(y),l=m("./src/utils/logger.js"),a=function(){function f(){}return Object.defineProperty(f,"forceGlobalTag",{get:function(){return l.default.FORCE_GLOBAL_TAG},set:function(s){l.default.FORCE_GLOBAL_TAG=s,f._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(f,"globalTag",{get:function(){return l.default.GLOBAL_TAG},set:function(s){l.default.GLOBAL_TAG=s,f._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(f,"enableAll",{get:function(){return l.default.ENABLE_VERBOSE&&l.default.ENABLE_DEBUG&&l.default.ENABLE_INFO&&l.default.ENABLE_WARN&&l.default.ENABLE_ERROR},set:function(s){l.default.ENABLE_VERBOSE=s,l.default.ENABLE_DEBUG=s,l.default.ENABLE_INFO=s,l.default.ENABLE_WARN=s,l.default.ENABLE_ERROR=s,f._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(f,"enableDebug",{get:function(){return l.default.ENABLE_DEBUG},set:function(s){l.default.ENABLE_DEBUG=s,f._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(f,"enableVerbose",{get:function(){return l.default.ENABLE_VERBOSE},set:function(s){l.default.ENABLE_VERBOSE=s,f._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(f,"enableInfo",{get:function(){return l.default.ENABLE_INFO},set:function(s){l.default.ENABLE_INFO=s,f._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(f,"enableWarn",{get:function(){return l.default.ENABLE_WARN},set:function(s){l.default.ENABLE_WARN=s,f._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(f,"enableError",{get:function(){return l.default.ENABLE_ERROR},set:function(s){l.default.ENABLE_ERROR=s,f._notifyChange()},enumerable:!1,configurable:!0}),f.getConfig=function(){return{globalTag:l.default.GLOBAL_TAG,forceGlobalTag:l.default.FORCE_GLOBAL_TAG,enableVerbose:l.default.ENABLE_VERBOSE,enableDebug:l.default.ENABLE_DEBUG,enableInfo:l.default.ENABLE_INFO,enableWarn:l.default.ENABLE_WARN,enableError:l.default.ENABLE_ERROR,enableCallback:l.default.ENABLE_CALLBACK}},f.applyConfig=function(s){l.default.GLOBAL_TAG=s.globalTag,l.default.FORCE_GLOBAL_TAG=s.forceGlobalTag,l.default.ENABLE_VERBOSE=s.enableVerbose,l.default.ENABLE_DEBUG=s.enableDebug,l.default.ENABLE_INFO=s.enableInfo,l.default.ENABLE_WARN=s.enableWarn,l.default.ENABLE_ERROR=s.enableError,l.default.ENABLE_CALLBACK=s.enableCallback},f._notifyChange=function(){var s=f.emitter;if(s.listenerCount("change")>0){var o=f.getConfig();s.emit("change",o)}},f.registerListener=function(s){f.emitter.addListener("change",s)},f.removeListener=function(s){f.emitter.removeListener("change",s)},f.addLogListener=function(s){l.default.emitter.addListener("log",s),l.default.emitter.listenerCount("log")>0&&(l.default.ENABLE_CALLBACK=!0,f._notifyChange())},f.removeLogListener=function(s){l.default.emitter.removeListener("log",s),l.default.emitter.listenerCount("log")===0&&(l.default.ENABLE_CALLBACK=!1,f._notifyChange())},f}();a.emitter=new(c()),S.default=a},"./src/utils/polyfill.js":function(T,S,m){m.r(S);var y=function(){function c(){}return c.install=function(){Object.setPrototypeOf=Object.setPrototypeOf||function(l,a){return l.__proto__=a,l},Object.assign=Object.assign||function(l){if(l==null)throw new TypeError("Cannot convert undefined or null to object");for(var a=Object(l),f=1;f<arguments.length;f++){var s=arguments[f];if(s!=null)for(var o in s)s.hasOwnProperty(o)&&(a[o]=s[o])}return a},typeof self.Promise!="function"&&m("./node_modules/es6-promise/dist/es6-promise.js").polyfill()},c}();y.install(),S.default=y},"./src/utils/utf8-conv.js":function(T,S,m){m.r(S);function y(l,a,f){var s=l;if(a+f<s.length){for(;f--;)if((s[++a]&192)!==128)return!1;return!0}else return!1}function c(l){for(var a=[],f=l,s=0,o=l.length;s<o;){if(f[s]<128){a.push(String.fromCharCode(f[s])),++s;continue}else if(!(f[s]<192)){if(f[s]<224){if(y(f,s,1)){var d=(f[s]&31)<<6|f[s+1]&63;if(d>=128){a.push(String.fromCharCode(d&65535)),s+=2;continue}}}else if(f[s]<240){if(y(f,s,2)){var d=(f[s]&15)<<12|(f[s+1]&63)<<6|f[s+2]&63;if(d>=2048&&(d&63488)!==55296){a.push(String.fromCharCode(d&65535)),s+=3;continue}}}else if(f[s]<248&&y(f,s,3)){var d=(f[s]&7)<<18|(f[s+1]&63)<<12|(f[s+2]&63)<<6|f[s+3]&63;if(d>65536&&d<1114112){d-=65536,a.push(String.fromCharCode(d>>>10|55296)),a.push(String.fromCharCode(d&1023|56320)),s+=4;continue}}}a.push(String.fromCharCode(65533)),++s}return a.join("")}S.default=c}},N={};function K(T){var S=N[T];if(S!==void 0)return S.exports;var m=N[T]={exports:{}};return X[T].call(m.exports,m,m.exports,K),m.exports}K.m=X,function(){K.n=function(T){var S=T&&T.__esModule?function(){return T.default}:function(){return T};return K.d(S,{a:S}),S}}(),function(){K.d=function(T,S){for(var m in S)K.o(S,m)&&!K.o(T,m)&&Object.defineProperty(T,m,{enumerable:!0,get:S[m]})}}(),function(){K.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}}()}(),function(){K.o=function(T,S){return Object.prototype.hasOwnProperty.call(T,S)}}(),function(){K.r=function(T){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(T,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(T,"__esModule",{value:!0})}}();var h=K("./src/index.js");return h}()})})(Re);const tt=Ie(Re.exports),rt=Ge("<span></span>"),ht=()=>{var c,l,a;const{replace:re,pathname:ne}=Me(),{proxyLink:X}=De();let N=fe.objs.filter(f=>f.type===Ke.VIDEO);N.length===0&&(N=[fe.obj]);let K,h={id:ne(),container:"#video-player",url:fe.raw_url,title:fe.obj.name,volume:.5,autoplay:Pe("video_autoplay"),autoSize:!1,autoMini:!0,loop:!1,flip:!0,playbackRate:!0,aspectRatio:!0,setting:!0,hotkey:!0,pip:!0,mutex:!0,fullscreen:!0,fullscreenWeb:!0,subtitleOffset:!0,miniProgressBar:!1,playsInline:!0,quality:[],plugins:[],whitelist:[],settings:[],moreVideoAttr:{"webkit-playsinline":!0,playsInline:!0},type:xe(fe.obj.name),customType:{flv:function(f,s){const o=tt.createPlayer({type:"flv",url:s},{referrerPolicy:"same-origin"});o.attachMediaElement(f),o.load()},m3u8:function(f,s){const o=new Ye;o.loadSource(s),o.attachMedia(f),f.src||(f.src=s)}},lang:["en","zh-cn","zh-tw"].includes(Le().toLowerCase())?Le().toLowerCase():"en",lock:!0,fastForward:!0,autoPlayback:!0,autoOrientation:!0,airplay:!0};const T=fe.related.filter(f=>{for(const s of[".srt",".ass",".vtt"])if(f.name.endsWith(s))return!0;return!1}),S=fe.related.find(f=>{for(const s of[".xml"])if(f.name.endsWith(s))return!0;return!1});if(T.length!=0){let d=function(t){switch(f?"ass":"webvtt"){case"ass":K.subtitle.show=!1,K.emit("artplayer-plugin-ass:visible",t);break;case"webvtt":default:K.subtitle.show=t,K.emit("artplayer-plugin-ass:visible",!1);break}},f=!1;const s=T[0];xe(s.name).toLowerCase()==="ass"?(f=!0,(c=h.plugins)==null||c.push(et({subUrl:X(s,!0)}))):h.subtitle={url:X(s,!0),type:xe(s.name)};const o=[{id:"setting_subtitle_display",html:"Display",tooltip:"Show",switch:!0,onSwitch:function(t){var n;t.tooltip=t.switch?"Hide":"Show",d(!t.switch);const e=(n=h.settings)==null?void 0:n.find(i=>i.id==="setting_subtitle");return e&&(e.tooltip=t.tooltip),!t.switch}}];T.forEach((t,e)=>{o.push({default:e===0,html:(()=>{const n=rt.cloneNode(!0);return n.style.setProperty("display","inline-block"),n.style.setProperty("max-width","15em"),n.style.setProperty("text-overflow","ellipsis"),n.style.setProperty("overflow","hidden"),Fe(n,()=>t.name),ke(()=>Be(n,"title",t.name)),n})(),name:t.name,url:X(t,!0)})}),(l=h.settings)==null||l.push({id:"setting_subtitle",html:"Subtitle",tooltip:"Show",icon:Ve({size:24}),selector:o,onSelect:function(t){var n,i;xe(t.name).toLowerCase()==="ass"?(f=!0,this.emit("artplayer-plugin-ass:switch",t.url),d(!0)):(f=!1,this.subtitle.switch(t.url,{name:t.name}),this.once("subtitleLoad",d.bind(this,!0)));const e=o.find(r=>r.id==="setting_subtitle_display");return e&&!e.switch&&((i=(n=e.$html)==null?void 0:n.click)==null||i.call(n)),e==null?void 0:e.tooltip}})}S&&((a=h.plugins)==null||a.push(Xe({danmuku:X(S,!0),speed:5,opacity:1,fontSize:25,color:"#FFFFFF",mode:0,margin:[0,"0%"],antiOverlap:!1,useWorker:!0,synchronousPlayback:!1,lockTime:5,maxLength:100,minWidth:200,maxWidth:400,theme:"dark"}))),Ue(()=>{K=new ze(h),K.on("video:ended",()=>{if(!m())return;const f=N.findIndex(s=>s.name===fe.obj.name);f<N.length-1&&re(N[f+1].name)})}),je(()=>{K==null||K.destroy()});const[m,y]=Ne();return Se(He,{onAutoNextChange:y,get children(){return Se(We,{w:"$full",h:"60vh",id:"video-player"})}})};export{ht as default};
