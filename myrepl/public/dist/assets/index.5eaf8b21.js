import{bC as ee,aq as B,bg as F,bD as x,a5 as M,N as O,j as e,Z as G,as as N,H as T,u as U,i as te,ai as A,by as C,bE as _,bo as v,bu as ne,bF as oe,bG as re,bH as se,d as ae,w as ie,e as f,bI as le,a as R,X as ce,bt as E,af as ue,bs as ge,r as b,I as P,bJ as de,aP as pe,a1 as he,B as L,a_ as fe,a$ as me,bK as we,al as be,h as z,n as $,bq as $e}from"./index.fef1c441.js";import{p as Ce,c as _e}from"./index.69e47ed4.js";import{s as ve,g as xe,a as Se}from"./webauthn-json.browser-ponyfill.1c672167.js";const ye="https://github.com/alist-org/alist";function ke(a){return ee(`${a}-${ye}`)}const Ie=M('<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" height="896" width="967.8852157128662"><defs><path id="path-2" opacity="1" fill-rule="evenodd" d="M896,448 C1142.6325445712241,465.5747656464056 695.2579309733121,896 448,896 C200.74206902668806,896 5.684341886080802e-14,695.2579309733121 0,448.0000000000001 C0,200.74206902668806 200.74206902668791,5.684341886080802e-14 447.99999999999994,0 C695.2579309733121,0 475,418 896,448Z"></path><linearGradient id="linearGradient-3" x1="0.5" y1="0" x2="0.5" y2="1"><stop offset="0" stop-opacity="1"></stop><stop offset="1" stop-opacity="1"></stop></linearGradient></defs><g opacity="1"><use xlink:href="#path-2" fill="url(#linearGradient-3)" fill-opacity="1"></use></g></svg>'),Ge=a=>{const i=B({startColor:"#28aff0",endColor:"#120fc4"},a);return(()=>{const t=Ie.cloneNode(!0),c=t.firstChild,u=c.firstChild,r=u.nextSibling,n=r.firstChild,l=n.nextSibling;return F(s=>{const g=i.startColor,d=i.endColor;return g!==s._v$&&x(n,"stop-color",s._v$=g),d!==s._v$2&&x(l,"stop-color",s._v$2=d),s},{_v$:void 0,_v$2:void 0}),t})()},Re=M('<svg height="1337" width="1337"><defs><path id="path-1" opacity="1" fill-rule="evenodd" d="M1337,668.5 C1337,1037.455193874239 1037.455193874239,1337 668.5,1337 C523.6725684305388,1337 337,1236 370.50000000000006,1094 C434.03835568300906,824.6732385973953 6.906089672974592e-14,892.6277623047779 0,668.5000000000001 C0,299.5448061257611 299.5448061257609,1.1368683772161603e-13 668.4999999999999,0 C1037.455193874239,0 1337,299.544806125761 1337,668.5Z"></path><linearGradient id="linearGradient-2" x1="0.79" y1="0.62" x2="0.21" y2="0.86"><stop offset="0" stop-opacity="1"></stop><stop offset="1" stop-opacity="1"></stop></linearGradient></defs><g opacity="1"><use xlink:href="#path-1" fill="url(#linearGradient-2)" fill-opacity="1"></use></g></svg>'),Ee=a=>{const i=B({startColor:"#28aff0",endColor:"#120fc4"},a);return(()=>{const t=Re.cloneNode(!0),c=t.firstChild,u=c.firstChild,r=u.nextSibling,n=r.firstChild,l=n.nextSibling;return F(s=>{const g=i.startColor,d=i.endColor;return g!==s._v$&&x(n,"stop-color",s._v$=g),d!==s._v$2&&x(l,"stop-color",s._v$2=d),s},{_v$:void 0,_v$2:void 0}),t})()},Pe=()=>{const a=O("#a9c6ff","#062b74");return e(G,{get bgColor(){return a()},pos:"fixed",top:"0",left:"0",overflow:"hidden",zIndex:"-1",w:"100vw",h:"100vh",get children(){return[e(G,{pos:"absolute",right:{"@initial":"-100px","@sm":"-300px"},top:{"@initial":"-1170px","@sm":"-900px"},get children(){return e(Ee,{})}}),e(G,{pos:"absolute",left:{"@initial":"-100px","@sm":"-200px"},bottom:{"@initial":"-760px","@sm":"-400px"},get children(){return e(Ge,{})}})]}})},Le=()=>{const a=N("sso_login_enabled"),i=T("sso_login_platform"),{searchParams:t,to:c}=U();function u(r){const n=r.data;n.token&&(C(n.token),c(decodeURIComponent(t.redirect||_||"/"),!0))}if(window.addEventListener("message",u),te(()=>{window.removeEventListener("message",u)}),a){const r=()=>{const l=v.getUri()+"/auth/sso?method=sso_get_token";window.open(l,"authPopup","width=500,height=600")};let n;switch(i){case"Github":n=se;break;case"Microsoft":n=Ce;break;case"Google":n=re;break;case"Dingtalk":n=oe;break;default:n=ne}return e(A,{cursor:"pointer",boxSize:"$8",as:n,p:"$0_5",onclick:r})}},Be=()=>{const a=T("logo").split(`
`),i=O(a[0],a.pop()),t=ae(),c=ie(()=>`${t("login.login_to")} ${T("site_title")}`);_e(c);const u=O("white","$neutral1"),[r,n]=f(localStorage.getItem("username")||""),[l,s]=f(localStorage.getItem("password")||""),[g,d]=f(""),[m,D]=f(!1),[w,j]=le("remember-pwd","false"),[H,q]=R(async()=>v.post("/auth/login/hash",{username:r(),password:ke(l()),otp_code:g()})),[,J]=R((o,p,h)=>v.post("/authn/webauthn_finish_login?username="+h,JSON.stringify(p),{headers:{session:o}})),[,K]=R(o=>v.get("/authn/webauthn_begin_login?username="+o)),{searchParams:S,to:y}=U(),Z=N("webauthn_login_enabled"),V=async()=>{D(!m())},k=async()=>{if(m()){if(!ve()){$.error(t("users.webauthn_not_supported"));return}w()==="true"?localStorage.setItem("username",r()):localStorage.removeItem("username");const o=await K(r());$e(o,async p=>{const h=xe(p.options),X=await Se(h),Q=await J(p.session,X,r());z(Q,Y=>{$.success(t("login.success")),C(Y.token),y(decodeURIComponent(S.redirect||_||"/"),!0)})})}else{w()==="true"?(localStorage.setItem("username",r()),localStorage.setItem("password",l())):(localStorage.removeItem("username"),localStorage.removeItem("password"));const o=await q();z(o,p=>{$.success(t("login.success")),C(p.token),y(decodeURIComponent(S.redirect||_||"/"),!0)},(p,h)=>{!I()&&h===402?W(!0):$.error(p)})}},[I,W]=f(!1);return e(be,{zIndex:"1",w:"$full",h:"100vh",get children(){return[e(ce,{get bgColor(){return u()},rounded:"$xl",p:"24px",w:{"@initial":"90%","@sm":"364px"},spacing:"$4",get children(){return[e(E,{alignItems:"center",justifyContent:"space-around",get children(){return[e(ue,{mr:"$2",boxSize:"$12",get src(){return i()}}),e(ge,{color:"$info9",fontSize:"$2xl",get children(){return c()}})]}}),e(b,{get when(){return!I()},get fallback(){return e(P,{id:"totp",name:"otp",get placeholder(){return t("login.otp-tips")},get value(){return g()},onInput:o=>d(o.currentTarget.value),onKeyDown:o=>{o.key==="Enter"&&k()}})},get children(){return[e(P,{name:"username",get placeholder(){return t("login.username-tips")},get value(){return r()},onInput:o=>n(o.currentTarget.value)}),e(b,{get when(){return!m()},get children(){return e(P,{name:"password",get placeholder(){return t("login.password-tips")},type:"password",get value(){return l()},onInput:o=>s(o.currentTarget.value),onKeyDown:o=>{o.key==="Enter"&&k()}})}}),e(E,{px:"$1",w:"$full",fontSize:"$sm",color:"$neutral10",justifyContent:"space-between",alignItems:"center",get children(){return[e(de,{get checked(){return w()==="true"},onChange:()=>j(w()==="true"?"false":"true"),get children(){return t("login.remember")}}),e(pe,{as:"a",target:"_blank",get href(){return t("login.forget_url")},get children(){return t("login.forget")}})]}})]}}),e(he,{w:"$full",spacing:"$2",get children(){return[e(b,{get when(){return!m()},get children(){return e(L,{colorScheme:"primary",w:"$full",onClick:()=>{I()?d(""):(n(""),s(""))},get children(){return t("login.clear")}})}}),e(L,{w:"$full",get loading(){return H()},onClick:k,get children(){return t("login.login")}})]}}),e(L,{w:"$full",colorScheme:"accent",onClick:()=>{C(),y(decodeURIComponent(S.redirect||_||"/"),!0)},get children(){return t("login.use_guest")}}),e(E,{mt:"$2",justifyContent:"space-evenly",alignItems:"center",color:"$neutral10",w:"$full",get children(){return[e(fe,{}),e(me,{}),e(Le,{}),e(b,{when:Z,get children(){return e(A,{cursor:"pointer",boxSize:"$8",as:we,p:"$0_5",onclick:V})}})]}})]}}),e(Pe,{})]}})};export{Be as default};
